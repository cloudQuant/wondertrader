<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WonderTrader: src/WtCore/WtEngine.cpp 源文件</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">WonderTrader<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">高性能量化交易平台</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('WtEngine_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">WtEngine.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="WtEngine_8cpp.html">浏览该文件的文档.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="WtEngine_8h.html">WtEngine.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="WtDtMgr_8h.html">WtDtMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="WtUftCore_2WtHelper_8h.html">WtHelper.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;../Share/TimeUtils.hpp&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;../Share/StrUtil.hpp&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;../Share/decimal.h&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;../Share/CodeHelper.hpp&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;../Includes/IBaseDataMgr.h&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;../Includes/IHotMgr.h&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;../Includes/WTSContractInfo.hpp&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;../Includes/WTSSessionInfo.hpp&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;../Includes/WTSVariant.hpp&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;../Includes/WTSDataDef.hpp&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;../Includes/WTSRiskDef.hpp&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;../WTSTools/WTSLogger.h&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;../WTSUtils/WTSCfgLoader.h&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;rapidjson/document.h&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;rapidjson/prettywriter.h&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="keyword">namespace </span>rj = rapidjson;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno"><a class="line" href="WtEngine_8cpp.html#a17226795848decb565e90624584e5c0f">   41</a></span><a class="code hl_variable" href="WtEngine_8cpp.html#a17226795848decb565e90624584e5c0f">USING_NS_WTP</a>;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="foldopen" id="foldopen00048" data-start="{" data-end="}">
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno"><a class="line" href="classWtEngine.html#acde4886b0c399bd811eec59f3bb5cc9c">   48</a></span><a class="code hl_function" href="classWtEngine.html#acde4886b0c399bd811eec59f3bb5cc9c">WtEngine::WtEngine</a>()</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    : _port_fund(<a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)        <span class="comment">// 资金对象指针初始化为空</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    , _risk_volscale(1.0)     <span class="comment">// 风控仓位比例初始化为1.0（即100%）</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    , _risk_date(0)           <span class="comment">// 风控日期初始化为0</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    , _terminated(false)      <span class="comment">// 终止标志初始化为false</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    , _evt_listener(<a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)     <span class="comment">// 事件监听器初始化为空</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    , _adapter_mgr(<a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)      <span class="comment">// 适配器管理器初始化为空</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    , _notifier(<a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)         <span class="comment">// 通知器初始化为空</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    , _fund_udt_span(0)       <span class="comment">// 资金更新时间间隔初始化为0</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    , _ready(false)           <span class="comment">// 就绪标志初始化为false</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>{</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="comment">// 获取当前系统日期和时间</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <a class="code hl_function" href="classTimeUtils.html#ac04a739040d6a0d39400c2a74b96583b">TimeUtils::getDateTime</a>(<a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a>, <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a>);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment">// 提取当前时间中的秒数部分</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <a class="code hl_variable" href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">_cur_secs</a> = <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a> % 100000;</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <span class="comment">// 将当前时间转换为HHMM格式（去掉秒数）</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a> /= 100000;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="comment">// 保存原始时间格式</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <a class="code hl_variable" href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">_cur_raw_time</a> = <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a>;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="comment">// 初始化交易日期为当前日期</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a> = <a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a>;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="comment">// 设置全局时间，供其他模块使用</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <a class="code hl_function" href="classWtHelper.html#ac290c0e80d469a0f09f7e37c568a11ab">WtHelper::setTime</a>(<a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a>, <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a>, <a class="code hl_variable" href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">_cur_secs</a>);</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>}</div>
</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="foldopen" id="foldopen00085" data-start="{" data-end="}">
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno"><a class="line" href="classWtEngine.html#a1a83817fd43cdf080c6f5428c798b419">   85</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a1a83817fd43cdf080c6f5428c798b419">WtEngine::set_date_time</a>(uint32_t curDate, uint32_t curTime, uint32_t curSecs <span class="comment">/* = 0 */</span>, uint32_t rawTime <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>{</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="comment">// 设置当前日期</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a> = curDate;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <span class="comment">// 设置当前时间</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a> = curTime;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="comment">// 设置当前秒数</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <a class="code hl_variable" href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">_cur_secs</a> = curSecs;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="comment">// 如果原始时间为0，则使用当前时间</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="keywordflow">if</span> (rawTime == 0)</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>        rawTime = curTime;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="comment">// 设置原始时间</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <a class="code hl_variable" href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">_cur_raw_time</a> = rawTime;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="comment">// 将时间信息设置到全局的WtHelper中</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <a class="code hl_function" href="classWtHelper.html#ac290c0e80d469a0f09f7e37c568a11ab">WtHelper::setTime</a>(<a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a>, <a class="code hl_variable" href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">_cur_raw_time</a>, <a class="code hl_variable" href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">_cur_secs</a>);</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>}</div>
</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span> </div>
<div class="foldopen" id="foldopen00113" data-start="{" data-end="}">
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno"><a class="line" href="classWtEngine.html#a12c3726337001fb1f6058c97ee637c09">  113</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a12c3726337001fb1f6058c97ee637c09">WtEngine::set_trading_date</a>(uint32_t curTDate)</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>{</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="comment">// 设置当前交易日期</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a> = curTDate; </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="comment">// 将交易日期设置到全局的WtHelper中</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <a class="code hl_function" href="classWtHelper.html#aa1041d638b2c3c271177dd2f9c153c4a">WtHelper::setTDate</a>(curTDate);</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>}</div>
</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="foldopen" id="foldopen00131" data-start="{" data-end="}">
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno"><a class="line" href="classWtEngine.html#a048845994584287eec212d39539ba645">  131</a></span><a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* <a class="code hl_function" href="classWtEngine.html#a048845994584287eec212d39539ba645">WtEngine::get_commodity_info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>{</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="comment">// 解析标准化合约代码，获取交易所和品种信息</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> codeInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(stdCode, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="comment">// 从基础数据管理器中获取对应的商品信息</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a435a180d8497a49cd6468fd34579b7ff">getCommodity</a>(codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">_exchg</a>, codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#a1d4f7a6320d180db879340b763224bbf">_product</a>);</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>}</div>
</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="foldopen" id="foldopen00148" data-start="{" data-end="}">
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="classWtEngine.html#a472556a49dd1f59645f7acc634ae272c">  148</a></span><a class="code hl_class" href="classWTSContractInfo.html">WTSContractInfo</a>* <a class="code hl_function" href="classWtEngine.html#a472556a49dd1f59645f7acc634ae272c">WtEngine::get_contract_info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>{</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="comment">// 解析标准化合约代码，获取合约代码和交易所信息</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> cInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(stdCode, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">// 从基础数据管理器中获取对应的合约信息</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a7902cf7c19636ee381ba9fa7a6e3f065">getContract</a>(cInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#a15662a84163642bec01647acd73456c4">_code</a>, cInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">_exchg</a>);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>}</div>
</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="foldopen" id="foldopen00165" data-start="{" data-end="}">
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno"><a class="line" href="classWtEngine.html#a8f7155ed8cd8b0f89243276b21052cd5">  165</a></span>std::string <a class="code hl_function" href="classWtEngine.html#a8f7155ed8cd8b0f89243276b21052cd5">WtEngine::get_rawcode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>{</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="comment">// 解析标准化合约代码</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> cInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(stdCode, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">// 如果合约有规则标签（如主力合约、次主力合约等）</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="keywordflow">if</span> (cInfo.<a class="code hl_function" href="structCodeHelper_1_1__CodeInfo.html#a18eb7decf582a282082809a7d26b460d">hasRule</a>())</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    {</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        <span class="comment">// 从主力合约管理器中获取自定义原始代码</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        std::string code = <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>-&gt;<a class="code hl_function" href="classIHotMgr.html#a0eeb3b1944544abdcd6bcbfccadfc356">getCustomRawCode</a>(cInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#a0cad1c91fd711a8217a024eb8b538d9d">_ruletag</a>, cInfo.<a class="code hl_function" href="structCodeHelper_1_1__CodeInfo.html#aa13a243f0cd0f40c859242b5c524a9a4">stdCommID</a>(), <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        <span class="comment">// 将原始月份代码转换为标准化合约代码</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classCodeHelper.html#ad05f109a3cdaca9068d19d41fc288643">CodeHelper::rawMonthCodeToStdCode</a>(code.c_str(), cInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">_exchg</a>);</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    }</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span> </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <span class="comment">// 如果没有规则标签或无法转换，返回空字符串</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>}</div>
</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="foldopen" id="foldopen00192" data-start="{" data-end="}">
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno"><a class="line" href="classWtEngine.html#a6c51ead2f0c35c0ae075bc55e91ea828">  192</a></span><a class="code hl_class" href="classWTSSessionInfo.html">WTSSessionInfo</a>* <a class="code hl_function" href="classWtEngine.html#a6c51ead2f0c35c0ae075bc55e91ea828">WtEngine::get_session_info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* sid, <span class="keywordtype">bool</span> isCode <span class="comment">/* = false */</span>)</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>{</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="comment">// 如果传入的不是合约代码，直接从基础数据管理器中获取交易时段信息</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <span class="keywordflow">if</span> (!isCode)</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a4c98c31963a32a6c91e0df4316f06ad7">getSession</a>(sid);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="comment">// 解析标准化合约代码</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> codeInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(sid, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="comment">// 获取对应的商品信息</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* cInfo = <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a435a180d8497a49cd6468fd34579b7ff">getCommodity</a>(codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">_exchg</a>, codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#a1d4f7a6320d180db879340b763224bbf">_product</a>);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="comment">// 如果找不到商品信息，返回NULL</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="keywordflow">if</span> (cInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="comment">// 从基础数据管理器中获取商品对应的交易时段信息</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a4c98c31963a32a6c91e0df4316f06ad7">getSession</a>(cInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#afaa5c2a84bef03ffe717f244c340fcd2">getSession</a>());</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>}</div>
</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="foldopen" id="foldopen00217" data-start="{" data-end="}">
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno"><a class="line" href="classWtEngine.html#a13559b13d0400d1a71e9eb71dcf8e84f">  217</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a13559b13d0400d1a71e9eb71dcf8e84f">WtEngine::on_tick</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* curTick)</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>{</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="comment">// 更新合约的当前价格缓存</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <a class="code hl_variable" href="classWtEngine.html#a04c2ea36fe63e6d3d92bac9d3000a5ac">_price_map</a>[stdCode] = curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>();</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="comment">// 检查是否有待触发的交易信号</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    {</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>        <span class="keywordtype">bool</span> bTriggered = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        <span class="comment">// 在信号映射表中查找当前合约的信号</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        <span class="keyword">auto</span> it = <a class="code hl_variable" href="classWtEngine.html#a2a2a7c974cbdc00810a0451552c5e271">_sig_map</a>.find(stdCode);</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        <span class="keywordflow">if</span> (it != <a class="code hl_variable" href="classWtEngine.html#a2a2a7c974cbdc00810a0451552c5e271">_sig_map</a>.end())</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>        {</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            <span class="comment">// 获取合约的交易时段信息</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            <a class="code hl_class" href="classWTSSessionInfo.html">WTSSessionInfo</a>* sInfo = <a class="code hl_function" href="classWtEngine.html#a6c51ead2f0c35c0ae075bc55e91ea828">get_session_info</a>(stdCode, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            <span class="comment">// 检查当前时间是否在交易时段内</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            <span class="keywordflow">if</span> (sInfo-&gt;<a class="code hl_function" href="classWTSSessionInfo.html#ac80489cf435cb91c5305c201a5a7072c">isInTradingTime</a>(<a class="code hl_variable" href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">_cur_raw_time</a>, <span class="keyword">true</span>))</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                <span class="comment">// 获取信号信息</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                <span class="keyword">const</span> <a class="code hl_struct" href="structWtEngine_1_1__SigInfo.html">SigInfo</a>&amp; sInfo = it-&gt;second;</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                <span class="keywordtype">double</span> pos = sInfo.<a class="code hl_variable" href="structWtEngine_1_1__SigInfo.html#a2c8fd5df10de9b10311327dbf0878167">_volume</a>;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>                std::string code = stdCode;</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>                <span class="comment">// 执行持仓调整，使用当前的Tick价格</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>                <a class="code hl_function" href="classWtEngine.html#a7c136cba5e314c5f4dbb1f13838e849c">do_set_position</a>(code.c_str(), pos, curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>());</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                <span class="comment">// 从信号映射表中移除已触发的信号</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                <a class="code hl_variable" href="classWtEngine.html#a2a2a7c974cbdc00810a0451552c5e271">_sig_map</a>.erase(it);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                bTriggered = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>            }</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        }</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        <span class="comment">// 如果触发了信号，则保存数据</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        <span class="keywordflow">if</span>(bTriggered)</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>            <a class="code hl_function" href="classWtEngine.html#ab03870fa91659e930c925422a05beee2">save_datas</a>();</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    }</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    <span class="comment">// 如果成交量为0，表示价格没有变动，直接返回</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="keywordflow">if</span> (curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a097548155cfbbf9a0a36e1ee1ce3ad38">volume</a>() == 0)</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="comment">// 将合约代码和价格信息复制到本地变量，以便在任务中使用</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    std::string code = stdCode;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> = curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>();</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="comment">// 添加任务更新指定合约的浮动盈亏</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <a class="code hl_function" href="classWtEngine.html#a578422f505b1a6270edfc91bbf3db0ee">push_task</a>([<span class="keyword">this</span>, code, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>]{</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        <span class="comment">// 查找合约的持仓信息</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        <span class="keyword">auto</span> it = <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>.find(code);</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        <span class="keywordflow">if</span> (it == <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>.end())</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <span class="comment">// 获取持仓信息并加锁</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>        <a class="code hl_typedef" href="classWtEngine.html#a95d70b06ff982397dcc4ff218f5789d8">PosInfoPtr</a>&amp; pInfo = it-&gt;second;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>        <a class="code hl_class" href="classSpinLock.html">SpinLock</a> lock(pInfo-&gt;_mtx);</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>        <span class="comment">// 如果持仓量为0，则浮动盈亏也为0</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        <span class="keywordflow">if</span> (pInfo-&gt;_volume == 0)</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        {</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            pInfo-&gt;_dynprofit = 0;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        }</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        {</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>            <span class="comment">// 获取商品信息</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_function" href="classWtEngine.html#a048845994584287eec212d39539ba645">get_commodity_info</a>(code.c_str());</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>            <span class="keywordtype">double</span> dynprofit = 0;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            <span class="comment">// 遍历所有持仓明细，计算每笔持仓的浮动盈亏</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> pit = pInfo-&gt;_details.begin(); pit != pInfo-&gt;_details.end(); pit++)</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>            {</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                <a class="code hl_struct" href="structWtEngine_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo = *pit;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                <span class="comment">// 计算浮动盈亏 = 持仓量 * (当前价格 - 开仓价格) * 合约乘数 * 方向系数(多头为1，空头为-1)</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>                dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a70a4ac93cfa1a2abd30d1d7920327c19">_profit</a> = dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a>*(<a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> - dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">_price</a>)*commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">getVolScale</a>()*(dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a> ? 1 : -1);</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                dynprofit += dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a70a4ac93cfa1a2abd30d1d7920327c19">_profit</a>;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>            }</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            <span class="comment">// 更新总浮动盈亏</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            pInfo-&gt;_dynprofit = dynprofit;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    });</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="comment">// 添加任务更新资金的浮动盈亏</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <a class="code hl_function" href="classWtEngine.html#a578422f505b1a6270edfc91bbf3db0ee">push_task</a>([<span class="keyword">this</span>]() {</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        <a class="code hl_function" href="classWtEngine.html#a33ad98d7ca50f3fea285ffba0c090f08">update_fund_dynprofit</a>();</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    });</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>}</div>
</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="foldopen" id="foldopen00305" data-start="{" data-end="}">
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno"><a class="line" href="classWtEngine.html#a33ad98d7ca50f3fea285ffba0c090f08">  305</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a33ad98d7ca50f3fea285ffba0c090f08">WtEngine::update_fund_dynprofit</a>()</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>{</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="comment">// 获取资金账户信息</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    <a class="code hl_struct" href="struct__WTSFundStruct.html">WTSFundStruct</a>&amp; fundInfo = <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a>-&gt;<a class="code hl_function" href="classWTSPortFundInfo.html#ae1618a5871a2fedb5e24c1ef435c5c8e">fundInfo</a>();</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    <span class="comment">// 如果上次结算日期等于当前交易日，说明今天已经结算过，不再更新</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="keywordflow">if</span> (fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#af31ce96ef3973ddb049d1717978c219e">_last_date</a> == <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>)</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    {</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        <span class="comment">//上次结算日期等于当前交易日,说明已经结算,不再更新了</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    }</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> </div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="comment">// 获取当前时间戳</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    int64_t now = <a class="code hl_function" href="classTimeUtils.html#a48644704dd42fbb708a3e8b88b9611a8">TimeUtils::getLocalTimeNow</a>();</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <span class="comment">// 如果设置了更新时间间隔，并且距离上次更新时间未超过间隔，则不更新</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classWtEngine.html#a95ff15fed1bd22e8c23be0e99553cc0c">_fund_udt_span</a> != 0)</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    {</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        <span class="keywordflow">if</span> (now - fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a8d898e75e1ecf3be5c1ed9776c3b9b1b">_update_time</a> &lt; <a class="code hl_variable" href="classWtEngine.html#a95ff15fed1bd22e8c23be0e99553cc0c">_fund_udt_span</a> * 1000)</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    }</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="comment">// 计算所有持仓的浮动盈亏总和</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <span class="keywordtype">double</span> profit = 0.0;</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; v : <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>)</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    {</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="classWtEngine.html#a95d70b06ff982397dcc4ff218f5789d8">PosInfoPtr</a>&amp; pItem = v.second;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        profit += pItem-&gt;_dynprofit;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span> </div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <span class="comment">// 更新资金账户的浮动盈亏</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#ab0b87a191365ccb2e793f14b44866975">_dynprofit</a> = profit;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>    <span class="comment">// 计算动态权益 = 静态权益 + 浮动盈亏</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <span class="keywordtype">double</span> dynbal = fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> + profit;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <span class="comment">// 更新当日最大动态权益及其对应时间</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <span class="keywordflow">if</span> (fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_max_dyn_bal</a> == <a class="code hl_define" href="WTSMarcos_8h.html#af78670ee54c1203d613f8fb0e022d214">DBL_MAX</a> || <a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(dynbal, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_max_dyn_bal</a>))</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    {</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_max_dyn_bal</a> = dynbal;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a353c06ccf3e55f35cd44f47a389facb2">_max_time</a> = <a class="code hl_variable" href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">_cur_raw_time</a> * 100000 + <a class="code hl_variable" href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">_cur_secs</a>;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    }</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="comment">// 更新当日最小动态权益及其对应时间</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="keywordflow">if</span> (fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_min_dyn_bal</a> == <a class="code hl_define" href="WTSMarcos_8h.html#af78670ee54c1203d613f8fb0e022d214">DBL_MAX</a> || <a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(dynbal, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_min_dyn_bal</a>))</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    {</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_min_dyn_bal</a> = dynbal;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#adcdb4d61e8d3fbc43dc32a8957fdac91">_min_time</a> = <a class="code hl_variable" href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">_cur_raw_time</a> * 100000 + <a class="code hl_variable" href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">_cur_secs</a>;;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    }</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    <span class="comment">// 再次计算动态权益（与上面的dynbal相同，可能是代码冗余）</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="keywordtype">double</span> dynbalance = fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> + profit;</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="comment">// 更新多日最大动态权益及其对应日期</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="keywordflow">if</span> (fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a> == 0 || <a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(dynbalance, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a>))</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    {</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a> = dynbalance;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a> = <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    }</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="comment">// 更新多日最小动态权益及其对应日期</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <span class="keywordflow">if</span> (fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a> == 0 || <a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(dynbalance, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a>))</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    {</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a> = dynbalance;</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a> = <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    }</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <span class="comment">// 更新最后更新时间</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a8d898e75e1ecf3be5c1ed9776c3b9b1b">_update_time</a> = now;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>}</div>
</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="foldopen" id="foldopen00378" data-start="{" data-end="}">
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno"><a class="line" href="classWtEngine.html#ad85990540ce319bfea09f435f537bd1a">  378</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#ad85990540ce319bfea09f435f537bd1a">WtEngine::writeRiskLog</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* message)</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>{</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="comment">// 使用线程本地存储的日志缓冲区</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="keyword">static</span> <span class="keyword">thread_local</span> <span class="keywordtype">char</span> szBuf[2048] = { 0 };</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    <span class="comment">// 先写入风控标识前缀</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="keyword">auto</span> len = <a class="code hl_function" href="WTSMarcos_8h.html#ae3e2cd00c20ce8b9ae0ae37a089d7d5e">wt_strcpy</a>(szBuf, <span class="stringliteral">&quot;[RiskControl] &quot;</span>);</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="comment">// 再写入实际的日志消息</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <a class="code hl_function" href="WTSMarcos_8h.html#ae3e2cd00c20ce8b9ae0ae37a089d7d5e">wt_strcpy</a>(szBuf + len, message);</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="comment">// 使用日志器将消息写入风控类别的日志</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <a class="code hl_function" href="classWTSLogger.html#a01fb1b92bf14e993751ce211b00e7dd2">WTSLogger::log_raw_by_cat</a>(<span class="stringliteral">&quot;risk&quot;</span>, <a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba3d0aabc1a000a1668922ab44aeca5771">LL_INFO</a>, szBuf);</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>}</div>
</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="foldopen" id="foldopen00397" data-start="{" data-end="}">
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno"><a class="line" href="classWtEngine.html#ac3bb192a7d478dda732accd72f7499e5">  397</a></span>uint32_t <a class="code hl_function" href="classWtEngine.html#ac3bb192a7d478dda732accd72f7499e5">WtEngine::getCurDate</a>()</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>{</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <span class="comment">// 返回当前日期</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a>;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>}</div>
</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="foldopen" id="foldopen00410" data-start="{" data-end="}">
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno"><a class="line" href="classWtEngine.html#a05c37fcb997b75b4b83336d56e8c82f8">  410</a></span>uint32_t <a class="code hl_function" href="classWtEngine.html#a05c37fcb997b75b4b83336d56e8c82f8">WtEngine::getCurTime</a>()</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>{</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="comment">// 返回当前时间</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a>;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>}</div>
</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="foldopen" id="foldopen00424" data-start="{" data-end="}">
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno"><a class="line" href="classWtEngine.html#a4796a8db9c86d12ac396503a33a2d5f2">  424</a></span>uint32_t <a class="code hl_function" href="classWtEngine.html#a4796a8db9c86d12ac396503a33a2d5f2">WtEngine::getTradingDate</a>()</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>{</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="comment">// 返回当前交易日期</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>}</div>
</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="foldopen" id="foldopen00437" data-start="{" data-end="}">
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno"><a class="line" href="classWtEngine.html#a6006b1b612a0a56214ad8e532bb083bf">  437</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classWtEngine.html#a6006b1b612a0a56214ad8e532bb083bf">WtEngine::isInTrading</a>()</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>{</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>}</div>
</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="foldopen" id="foldopen00450" data-start="{" data-end="}">
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno"><a class="line" href="classWtEngine.html#ab6f78977ebba071a101535a5c547c0cc">  450</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#ab6f78977ebba071a101535a5c547c0cc">WtEngine::setVolScale</a>(<span class="keywordtype">double</span> scale)</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>{</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <span class="comment">// 保存旧的风控比例以便记录日志</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordtype">double</span> oldScale = <a class="code hl_variable" href="classWtEngine.html#a949c7b173c6799080d27e6b79e76297e">_risk_volscale</a>;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    <span class="comment">// 设置新的风控比例</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <a class="code hl_variable" href="classWtEngine.html#a949c7b173c6799080d27e6b79e76297e">_risk_volscale</a> = scale;</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <span class="comment">// 更新风控日期为当前交易日期</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <a class="code hl_variable" href="classWtEngine.html#ae061bcec5d0092f7758bddb6c10ef5d5">_risk_date</a> = <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>;</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="comment">// 记录风控比例更新日志</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    <a class="code hl_function" href="classWTSLogger.html#a50df3d38d311e4792f52f0a7b0fa205e">WTSLogger::log_by_cat</a>(<span class="stringliteral">&quot;risk&quot;</span>, <a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba3d0aabc1a000a1668922ab44aeca5771">LL_INFO</a>, <span class="stringliteral">&quot;Position risk scale updated: {} - &gt; {}&quot;</span>, oldScale, scale);</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    <span class="comment">// 保存数据到持久化存储</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    <a class="code hl_function" href="classWtEngine.html#ab03870fa91659e930c925422a05beee2">save_datas</a>();</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>}</div>
</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="foldopen" id="foldopen00472" data-start="{" data-end="}">
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno"><a class="line" href="classWtEngine.html#a6909bea9afa5f3ddbc06f6d57bf11b53">  472</a></span><a class="code hl_class" href="classWTSPortFundInfo.html">WTSPortFundInfo</a>* <a class="code hl_function" href="classWtEngine.html#a6909bea9afa5f3ddbc06f6d57bf11b53">WtEngine::getFundInfo</a>()</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>{</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <span class="comment">// 更新资金账户的浮动盈亏信息</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <a class="code hl_function" href="classWtEngine.html#a33ad98d7ca50f3fea285ffba0c090f08">update_fund_dynprofit</a>();</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <span class="comment">// 保存交易数据</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    <a class="code hl_function" href="classWtEngine.html#ab03870fa91659e930c925422a05beee2">save_datas</a>();</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <span class="comment">// 返回资金账户信息对象</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a>;</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>}</div>
</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="foldopen" id="foldopen00495" data-start="{" data-end="}">
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno"><a class="line" href="classWtEngine.html#a8500acd28ad8cecf813fa3dc9d64b19b">  495</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a8500acd28ad8cecf813fa3dc9d64b19b">WtEngine::init</a>(<a class="code hl_class" href="classWTSVariant.html">WTSVariant</a>* cfg, <a class="code hl_class" href="classIBaseDataMgr.html">IBaseDataMgr</a>* bdMgr, <a class="code hl_class" href="classWtDtMgr.html">WtDtMgr</a>* dataMgr, <a class="code hl_class" href="classIHotMgr.html">IHotMgr</a>* hotMgr, <a class="code hl_class" href="classEventNotifier.html">EventNotifier</a>* notifier)</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>{</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <span class="comment">// 设置基础数据管理器</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a> = bdMgr;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    <span class="comment">// 设置数据管理器</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a> = dataMgr;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <span class="comment">// 设置主力合约管理器</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a> = hotMgr;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <span class="comment">// 设置事件通知器</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    <a class="code hl_variable" href="classWtEngine.html#aa306db82dde1e9259005ce44ae233f01">_notifier</a> = notifier;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <span class="comment">// 记录运行模式为生产模式</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    <a class="code hl_function" href="classWTSLogger.html#a20d65255542e3ed5d694b529892a0f57">WTSLogger::info</a>(<span class="stringliteral">&quot;Running mode: Production&quot;</span>);</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <span class="comment">// 为过滤器管理器设置通知器</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <a class="code hl_variable" href="classWtEngine.html#a973c4477c266e36612edcee2d363081c">_filter_mgr</a>.<a class="code hl_function" href="classWtFilterMgr.html#a5825155c6fb417d388fa2c3d5cb5e465">set_notifier</a>(notifier);</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <span class="comment">// 加载过滤器配置</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <a class="code hl_variable" href="classWtEngine.html#a973c4477c266e36612edcee2d363081c">_filter_mgr</a>.<a class="code hl_function" href="classWtFilterMgr.html#a9a56b4340fb952158f647453b2e9bc99">load_filters</a>(cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a830db11fc8daceff409fdbebaa7bea8a">getCString</a>(<span class="stringliteral">&quot;filters&quot;</span>));</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <span class="comment">// 加载手续费配置</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <a class="code hl_function" href="classWtEngine.html#a18bf11787444741d15a4c1993c16f9dd">load_fees</a>(cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a830db11fc8daceff409fdbebaa7bea8a">getCString</a>(<span class="stringliteral">&quot;fees&quot;</span>));</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="comment">// 加载交易数据</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    <a class="code hl_function" href="classWtEngine.html#aa21948337706337dd9377e86b16ff7a9">load_datas</a>();</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="comment">// 初始化输出文件</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    <a class="code hl_function" href="classWtEngine.html#a78e78faf98d93a32c6b0bee6f81edb7b">init_outputs</a>();</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="comment">// 获取风控配置</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <a class="code hl_class" href="classWTSVariant.html">WTSVariant</a>* cfgRisk = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a4dacb2b4afd195d05dedb5323d7982f3">get</a>(<span class="stringliteral">&quot;riskmon&quot;</span>);</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    <span class="comment">// 如果配置了风控模块</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    <span class="keywordflow">if</span>(cfgRisk)</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    {</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>        <span class="comment">// 初始化风控线程</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        <a class="code hl_function" href="classWtEngine.html#a9759242686c911952bf87cb72f8cc306">init_riskmon</a>(cfgRisk);</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    }</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    {</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        <span class="comment">// 如果没有配置风控线程，则需要自己更新浮动盈亏</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>        <span class="comment">// 把更新时间间隔设置为5s</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        <a class="code hl_variable" href="classWtEngine.html#a95ff15fed1bd22e8c23be0e99553cc0c">_fund_udt_span</a> = 5;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>        <a class="code hl_function" href="classWTSLogger.html#aa3257bbd8e5b1db25f65cd936f50025c">WTSLogger::log_raw</a>(<a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba7413c537cbbee6447b4d2a2fd90bd1c9">LL_WARN</a>, <span class="stringliteral">&quot;RiskMon is not configured, portfilio fund will be updated every 5s&quot;</span>);</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    }</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>}</div>
</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="foldopen" id="foldopen00546" data-start="{" data-end="}">
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno"><a class="line" href="classWtEngine.html#aa4d4751e75b542e177dc6203314b6ba5">  546</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#aa4d4751e75b542e177dc6203314b6ba5">WtEngine::on_session_end</a>()</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>{</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="comment">// 获取资金账户信息</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>    <a class="code hl_struct" href="struct__WTSFundStruct.html">WTSFundStruct</a>&amp; fundInfo = <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a>-&gt;<a class="code hl_function" href="classWTSPortFundInfo.html#ae1618a5871a2fedb5e24c1ef435c5c8e">fundInfo</a>();</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    <span class="comment">// 如果上次结算日期小于当前交易日，说明需要进行结算</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <span class="keywordflow">if</span> (fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#af31ce96ef3973ddb049d1717978c219e">_last_date</a> &lt; <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>)</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    {</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        <span class="comment">// 构造资金记录文件路径</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        std::string filename = <a class="code hl_function" href="classWtHelper.html#abb1e5b65775cc630a9fcabe71a3da098">WtHelper::getPortifolioDir</a>();</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>        filename += <span class="stringliteral">&quot;funds.csv&quot;</span>;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        <span class="comment">// 创建文件操作对象</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        <a class="code hl_typedef" href="BoostFile_8hpp.html#a596e60eb12117122d44c36f261d58a04">BoostFilePtr</a> fund_log(<span class="keyword">new</span> <a class="code hl_class" href="classBoostFile.html">BoostFile</a>());</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        {</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>            <span class="comment">// 检查文件是否存在</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>            <span class="keywordtype">bool</span> isNewFile = !<a class="code hl_function" href="classBoostFile.html#aab642b9bcdfa02c81c2530110eb8a61e">BoostFile::exists</a>(filename.c_str());</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>            <span class="comment">// 创建或打开文件</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>            fund_log-&gt;create_or_open_file(filename.c_str());</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>            <span class="comment">// 如果是新文件，则写入CSV头部</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>            <span class="keywordflow">if</span> (isNewFile)</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>            {</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>                fund_log-&gt;write_file(<span class="stringliteral">&quot;date,predynbalance,prebalance,balance,closeprofit,dynprofit,fee,maxdynbalance,maxtime,mindynbalance,mintime,mdmaxbalance,mdmaxdate,mdminbalance,mdmindate\n&quot;</span>);</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>            }</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>            {</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>                <span class="comment">// 如果文件已存在，则将文件指针移动到文件末尾</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>                fund_log-&gt;seek_to_end();</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>            }</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        }</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>        <span class="comment">// 写入当日资金记录</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        <span class="comment">// 各字段含义：日期、前一日动态权益、前一日静态权益、当前静态权益、平仓盈亏、浮动盈亏、手续费、</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>        <span class="comment">// 最大动态权益、最大权益时间、最小动态权益、最小权益时间、多日最大动态权益、多日最大权益日期、多日最小动态权益、多日最小权益日期</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>        fund_log-&gt;write_file(fmt::format(<span class="stringliteral">&quot;{},{},{},{},{},{},{},{},{},{},{},{},{},{},{}\n&quot;</span>, </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>            <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a588c43df3e1818b0048b84588854d7d4">_predynbal</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a4cb52624d7cece31e756bc8b41348ea3">_prebalance</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a>, </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a90def687e499e865a61b42e8b3d43794">_profit</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#ab0b87a191365ccb2e793f14b44866975">_dynprofit</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_fees</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_max_dyn_bal</a>,</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a353c06ccf3e55f35cd44f47a389facb2">_max_time</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_min_dyn_bal</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#adcdb4d61e8d3fbc43dc32a8957fdac91">_min_time</a>,</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a>,</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a>));</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span> </div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        <span class="comment">// 更新资金信息，为下一交易日做准备</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        <span class="comment">// 记录最后结算日期</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#af31ce96ef3973ddb049d1717978c219e">_last_date</a> = <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>;</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>        <span class="comment">// 设置前一日动态权益 = 当前静态权益 + 当前浮动盈亏</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a588c43df3e1818b0048b84588854d7d4">_predynbal</a> = fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> + fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#ab0b87a191365ccb2e793f14b44866975">_dynprofit</a>;</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <span class="comment">// 设置前一日静态权益 = 当前静态权益</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a4cb52624d7cece31e756bc8b41348ea3">_prebalance</a> = fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a>;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        <span class="comment">// 重置平仓盈亏</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a90def687e499e865a61b42e8b3d43794">_profit</a> = 0;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <span class="comment">// 重置手续费</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_fees</a> = 0;</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>        <span class="comment">// 重置最大动态权益</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_max_dyn_bal</a> = <a class="code hl_define" href="WTSMarcos_8h.html#af78670ee54c1203d613f8fb0e022d214">DBL_MAX</a>;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        <span class="comment">// 重置最小动态权益</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_min_dyn_bal</a> = <a class="code hl_define" href="WTSMarcos_8h.html#af78670ee54c1203d613f8fb0e022d214">DBL_MAX</a>;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>        <span class="comment">// 重置最大权益时间</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a353c06ccf3e55f35cd44f47a389facb2">_max_time</a> = 0;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>        <span class="comment">// 重置最小权益时间</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#adcdb4d61e8d3fbc43dc32a8957fdac91">_min_time</a> = 0;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    }</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <span class="comment">// 保存所有数据</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    <a class="code hl_function" href="classWtEngine.html#ab03870fa91659e930c925422a05beee2">save_datas</a>();</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>}</div>
</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span> </div>
<div class="foldopen" id="foldopen00614" data-start="{" data-end="}">
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno"><a class="line" href="classWtEngine.html#aa4bf95915f60e8f7b588c44e151aec56">  614</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#aa4bf95915f60e8f7b588c44e151aec56">WtEngine::on_session_begin</a>()</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>{</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>    <span class="comment">// 当前实现为空，可由子类重写</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>}</div>
</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span> </div>
<div class="foldopen" id="foldopen00624" data-start="{" data-end="}">
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno"><a class="line" href="classWtEngine.html#ab03870fa91659e930c925422a05beee2">  624</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#ab03870fa91659e930c925422a05beee2">WtEngine::save_datas</a>()</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>{</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <span class="comment">// 创建JSON文档对象</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    rj::Document root(rj::kObjectType);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    rj::Document::AllocatorType &amp;allocator = root.GetAllocator();</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="comment">// 如果资金对象存在，则保存资金数据</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a> != <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    {<span class="comment">//保存资金数据</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="comment">// 获取资金结构信息</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <span class="keyword">const</span> <a class="code hl_struct" href="struct__WTSFundStruct.html">WTSFundStruct</a>&amp; fundInfo = <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a>-&gt;<a class="code hl_function" href="classWTSPortFundInfo.html#ae1618a5871a2fedb5e24c1ef435c5c8e">fundInfo</a>();</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        <span class="comment">// 创建资金JSON对象</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        rj::Value jFund(rj::kObjectType);</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        <span class="comment">// 添加前一日动态权益</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        jFund.AddMember(<span class="stringliteral">&quot;predynbal&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a588c43df3e1818b0048b84588854d7d4">_predynbal</a>, allocator);</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        <span class="comment">// 添加当前静态权益</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        jFund.AddMember(<span class="stringliteral">&quot;balance&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a>, allocator);</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>        <span class="comment">// 添加前一日静态权益</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>        jFund.AddMember(<span class="stringliteral">&quot;prebalance&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a4cb52624d7cece31e756bc8b41348ea3">_prebalance</a>, allocator);</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        <span class="comment">// 添加平仓盈亏</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        jFund.AddMember(<span class="stringliteral">&quot;profit&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a90def687e499e865a61b42e8b3d43794">_profit</a>, allocator);</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>        <span class="comment">// 添加浮动盈亏</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>        jFund.AddMember(<span class="stringliteral">&quot;dynprofit&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#ab0b87a191365ccb2e793f14b44866975">_dynprofit</a>, allocator);</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="comment">// 添加手续费</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        jFund.AddMember(<span class="stringliteral">&quot;fees&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_fees</a>, allocator);</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span> </div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <span class="comment">// 添加当日最大动态权益</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        jFund.AddMember(<span class="stringliteral">&quot;max_dyn_bal&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_max_dyn_bal</a>, allocator);</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <span class="comment">// 添加最大权益时间</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>        jFund.AddMember(<span class="stringliteral">&quot;max_time&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a353c06ccf3e55f35cd44f47a389facb2">_max_time</a>, allocator);</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="comment">// 添加当日最小动态权益</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        jFund.AddMember(<span class="stringliteral">&quot;min_dyn_bal&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_min_dyn_bal</a>, allocator);</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        <span class="comment">// 添加最小权益时间</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        jFund.AddMember(<span class="stringliteral">&quot;min_time&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#adcdb4d61e8d3fbc43dc32a8957fdac91">_min_time</a>, allocator);</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        <span class="comment">// 添加最后结算日期</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>        jFund.AddMember(<span class="stringliteral">&quot;last_date&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#af31ce96ef3973ddb049d1717978c219e">_last_date</a>, allocator);</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        <span class="comment">// 添加当前交易日</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        jFund.AddMember(<span class="stringliteral">&quot;date&quot;</span>, <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>, allocator);</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>        <span class="comment">// 创建多日最大动态权益对象</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        rj::Value jMaxMD(rj::kObjectType);</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>        jMaxMD.AddMember(<span class="stringliteral">&quot;date&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a>, allocator);</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        jMaxMD.AddMember(<span class="stringliteral">&quot;dyn_balance&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a>, allocator);</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span> </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <span class="comment">// 创建多日最小动态权益对象</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        rj::Value jMinMD(rj::kObjectType);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>        jMinMD.AddMember(<span class="stringliteral">&quot;date&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a>, allocator);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>        jMinMD.AddMember(<span class="stringliteral">&quot;dyn_balance&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a>, allocator);</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>        <span class="comment">// 将多日最大/最小动态权益对象添加到资金对象中</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>        jFund.AddMember(<span class="stringliteral">&quot;maxmd&quot;</span>, jMaxMD, allocator);</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>        jFund.AddMember(<span class="stringliteral">&quot;minmd&quot;</span>, jMinMD, allocator);</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span> </div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>        <span class="comment">// 添加最后更新时间</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        jFund.AddMember(<span class="stringliteral">&quot;update_time&quot;</span>, fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a8d898e75e1ecf3be5c1ed9776c3b9b1b">_update_time</a>, allocator);</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>        <span class="comment">// 将资金对象添加到根文档</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>        root.AddMember(<span class="stringliteral">&quot;fund&quot;</span>, jFund, allocator);</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    }</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span> </div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    {<span class="comment">// 保存持仓数据</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="comment">// 创建持仓数组</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        rj::Value jPos(rj::kArrayType);</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        <span class="comment">// 遍历所有持仓</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>.begin(); it != <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>.end(); it++)</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        {</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>            <span class="comment">// 获取合约代码和持仓信息</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>            <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode = it-&gt;first.c_str();</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="classWtEngine.html#a95d70b06ff982397dcc4ff218f5789d8">PosInfoPtr</a>&amp; pInfo = it-&gt;second;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span> </div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>            <span class="comment">// 创建单个持仓项目</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>            rj::Value pItem(rj::kObjectType);</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>            <span class="comment">// 添加合约代码</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>            pItem.AddMember(<span class="stringliteral">&quot;code&quot;</span>, rj::Value(stdCode, allocator), allocator);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>            <span class="comment">// 添加持仓量</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>            pItem.AddMember(<span class="stringliteral">&quot;volume&quot;</span>, pInfo-&gt;_volume, allocator);</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>            <span class="comment">// 添加平仓盈亏</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>            pItem.AddMember(<span class="stringliteral">&quot;closeprofit&quot;</span>, pInfo-&gt;_closeprofit, allocator);</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>            <span class="comment">// 添加浮动盈亏</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>            pItem.AddMember(<span class="stringliteral">&quot;dynprofit&quot;</span>, pInfo-&gt;_dynprofit, allocator);</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span> </div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>            <span class="comment">// 创建持仓明细数组</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>            rj::Value details(rj::kArrayType);</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>            <span class="comment">// 遍历所有持仓明细</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> dit = pInfo-&gt;_details.begin(); dit != pInfo-&gt;_details.end(); dit++)</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>            {</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                <span class="keyword">const</span> <a class="code hl_struct" href="structWtEngine_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo = *dit;</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>                <span class="comment">// 如果持仓量为0，则跳过</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>                <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a>, 0))</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>                <span class="comment">// 创建明细项目</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>                rj::Value dItem(rj::kObjectType);</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                <span class="comment">// 添加多空方向标记（true为多头，false为空头）</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>                dItem.AddMember(<span class="stringliteral">&quot;long&quot;</span>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a>, allocator);</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                <span class="comment">// 添加开仓价格</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                dItem.AddMember(<span class="stringliteral">&quot;price&quot;</span>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">_price</a>, allocator);</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                <span class="comment">// 添加持仓量</span></div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                dItem.AddMember(<span class="stringliteral">&quot;volume&quot;</span>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a>, allocator);</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                <span class="comment">// 添加开仓时间</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                dItem.AddMember(<span class="stringliteral">&quot;opentime&quot;</span>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a4bb172995fd3cbb4a852123ef14b9eb3">_opentime</a>, allocator);</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>                <span class="comment">// 添加开仓交易日</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                dItem.AddMember(<span class="stringliteral">&quot;opentdate&quot;</span>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#af014064a77bdaa2adf7c0950e3a552d7">_opentdate</a>, allocator);</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span> </div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                <span class="comment">// 添加浮动盈亏</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                dItem.AddMember(<span class="stringliteral">&quot;profit&quot;</span>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a70a4ac93cfa1a2abd30d1d7920327c19">_profit</a>, allocator);</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                <span class="comment">// 将明细项目添加到明细数组</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>                details.PushBack(dItem, allocator);</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>            }</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span> </div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>            <span class="comment">// 将明细数组添加到持仓项目</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>            pItem.AddMember(<span class="stringliteral">&quot;details&quot;</span>, details, allocator);</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>            <span class="comment">// 将持仓项目添加到持仓数组</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>            jPos.PushBack(pItem, allocator);</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        }</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span> </div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>        <span class="comment">// 将持仓数组添加到根文档</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>        root.AddMember(<span class="stringliteral">&quot;positions&quot;</span>, jPos, allocator);</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    }</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>    <span class="comment">// 保存风控参数设置</span></div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    {</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>        <span class="comment">// 创建风控对象</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        rj::Value jRisk(rj::kObjectType);</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span> </div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        <span class="comment">// 添加风控仓位比例</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>        jRisk.AddMember(<span class="stringliteral">&quot;scale&quot;</span>, <a class="code hl_variable" href="classWtEngine.html#a949c7b173c6799080d27e6b79e76297e">_risk_volscale</a>, allocator);</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        <span class="comment">// 添加风控参数更新日期</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>        jRisk.AddMember(<span class="stringliteral">&quot;date&quot;</span>, <a class="code hl_variable" href="classWtEngine.html#ae061bcec5d0092f7758bddb6c10ef5d5">_risk_date</a>, allocator);</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span> </div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>        <span class="comment">// 将风控对象添加到根文档</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        root.AddMember(<span class="stringliteral">&quot;riskmon&quot;</span>, jRisk, allocator);</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>    }</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>    <span class="comment">// 将数据写入文件</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    {</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        <span class="comment">// 构造数据文件路径</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>        std::string filename = <a class="code hl_function" href="classWtHelper.html#abb1e5b65775cc630a9fcabe71a3da098">WtHelper::getPortifolioDir</a>();</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>        filename += <span class="stringliteral">&quot;datas.json&quot;</span>;</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        <span class="comment">// 创建文件对象</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>        <a class="code hl_class" href="classBoostFile.html">BoostFile</a> bf;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>        <span class="comment">// 创建新文件</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="keywordflow">if</span> (bf.<a class="code hl_function" href="classBoostFile.html#a5eab32a7044d5e65fb18aca7fd90b864">create_new_file</a>(filename.c_str()))</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        {</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>            <span class="comment">// 创建字符串缓冲区</span></div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>            rj::StringBuffer sb;</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>            <span class="comment">// 创建JSON格式化写入器</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>            rj::PrettyWriter&lt;rj::StringBuffer&gt; writer(sb);</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>            <span class="comment">// 将JSON文档写入缓冲区</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>            root.Accept(writer);</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>            <span class="comment">// 将缓冲区内容写入文件</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>            bf.<a class="code hl_function" href="classBoostFile.html#aca29c4c4ed11acc16411e3fcc986f6e3">write_file</a>(sb.GetString());</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>            <span class="comment">// 关闭文件</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>            bf.<a class="code hl_function" href="classBoostFile.html#a5481db505f5c5d99c9aa9ba36806bff0">close_file</a>();</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        }</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>    }</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>}</div>
</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span> </div>
<div class="foldopen" id="foldopen00791" data-start="{" data-end="}">
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno"><a class="line" href="classWtEngine.html#aa21948337706337dd9377e86b16ff7a9">  791</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#aa21948337706337dd9377e86b16ff7a9">WtEngine::load_datas</a>()</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>{</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>    <span class="comment">// 创建资金对象</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>    <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a> = <a class="code hl_function" href="classWTSPortFundInfo.html#a49573253dde385ccb9fe189a0bef1bad">WTSPortFundInfo::create</a>();</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span> </div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    <span class="comment">// 构造数据文件路径</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    std::string filename = <a class="code hl_function" href="classWtHelper.html#abb1e5b65775cc630a9fcabe71a3da098">WtHelper::getPortifolioDir</a>();</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    filename += <span class="stringliteral">&quot;datas.json&quot;</span>;</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>    <span class="comment">// 如果文件不存在，直接返回</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classStdFile.html#a65778f7268857f981a2e19acb8379761">StdFile::exists</a>(filename.c_str()))</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    {</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    }</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span> </div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>    <span class="comment">// 读取文件内容</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    std::string content;</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>    <a class="code hl_function" href="classStdFile.html#a23e935cf0937cc0cd1cd2ee4c3eecb53">StdFile::read_file_content</a>(filename.c_str(), content);</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>    <span class="comment">// 如果文件内容为空，直接返回</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>    <span class="keywordflow">if</span> (content.empty())</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span> </div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>    <span class="comment">// 解析JSON文档</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>    rj::Document root;</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    root.Parse(content.c_str());</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span> </div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    <span class="comment">// 如果解析出错，直接返回</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>    <span class="keywordflow">if</span> (root.HasParseError())</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span> </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>    <span class="comment">// 读取资金信息</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    {</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>        <span class="comment">// 获取资金对象</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>        <span class="keyword">const</span> rj::Value&amp; jFund = root[<span class="stringliteral">&quot;fund&quot;</span>];</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>        <span class="comment">// 如果资金对象存在且有效</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>        <span class="keywordflow">if</span> (!jFund.IsNull() &amp;&amp; jFund.IsObject())</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>        {</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>            <span class="comment">// 获取资金结构信息</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>            <a class="code hl_struct" href="struct__WTSFundStruct.html">WTSFundStruct</a>&amp; fundInfo = <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a>-&gt;<a class="code hl_function" href="classWTSPortFundInfo.html#ae1618a5871a2fedb5e24c1ef435c5c8e">fundInfo</a>();</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>            <span class="comment">// 读取前一日动态权益</span></div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a588c43df3e1818b0048b84588854d7d4">_predynbal</a> = jFund[<span class="stringliteral">&quot;predynbal&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>            <span class="comment">// 读取当前静态权益</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> = jFund[<span class="stringliteral">&quot;balance&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>            <span class="comment">// 读取前一日静态权益</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a4cb52624d7cece31e756bc8b41348ea3">_prebalance</a> = jFund[<span class="stringliteral">&quot;prebalance&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>            <span class="comment">// 读取平仓盈亏</span></div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a90def687e499e865a61b42e8b3d43794">_profit</a> = jFund[<span class="stringliteral">&quot;profit&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>            <span class="comment">// 读取浮动盈亏</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#ab0b87a191365ccb2e793f14b44866975">_dynprofit</a> = jFund[<span class="stringliteral">&quot;dynprofit&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            <span class="comment">// 读取手续费</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_fees</a> = jFund[<span class="stringliteral">&quot;fees&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>            <span class="comment">// 读取最后结算日期</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#af31ce96ef3973ddb049d1717978c219e">_last_date</a> = jFund[<span class="stringliteral">&quot;last_date&quot;</span>].GetUint();</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>            <span class="comment">// 读取最大动态权益</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_max_dyn_bal</a> = jFund[<span class="stringliteral">&quot;max_dyn_bal&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>            <span class="comment">// 读取最大权益时间</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a353c06ccf3e55f35cd44f47a389facb2">_max_time</a> = jFund[<span class="stringliteral">&quot;max_time&quot;</span>].GetUint();</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>            <span class="comment">// 读取最小动态权益</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_min_dyn_bal</a> = jFund[<span class="stringliteral">&quot;min_dyn_bal&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>            <span class="comment">// 读取最小权益时间</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#adcdb4d61e8d3fbc43dc32a8957fdac91">_min_time</a> = jFund[<span class="stringliteral">&quot;min_time&quot;</span>].GetUint();</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span> </div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>            <span class="comment">// 读取多日最大动态权益信息</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>            <span class="keyword">const</span> rj::Value&amp; jMaxMD = jFund[<span class="stringliteral">&quot;maxmd&quot;</span>];</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a> = jMaxMD[<span class="stringliteral">&quot;dyn_balance&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_max_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a> = jMaxMD[<span class="stringliteral">&quot;date&quot;</span>].GetUint();</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span> </div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>            <span class="comment">// 读取多日最小动态权益信息</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>            <span class="keyword">const</span> rj::Value&amp; jMinMD = jFund[<span class="stringliteral">&quot;minmd&quot;</span>];</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_dyn_balance</a> = jMinMD[<span class="stringliteral">&quot;dyn_balance&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_min_md_dyn_bal</a>.<a class="code hl_variable" href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_date</a> = jMinMD[<span class="stringliteral">&quot;date&quot;</span>].GetUint();</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span> </div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>            <span class="comment">// 如果有更新时间字段，则读取更新时间</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>            <span class="keywordflow">if</span>(jFund.HasMember(<span class="stringliteral">&quot;update_time&quot;</span>))</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>            {</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>                fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a8d898e75e1ecf3be5c1ed9776c3b9b1b">_update_time</a> = jFund[<span class="stringliteral">&quot;update_time&quot;</span>].GetInt64();</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>            }</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        }</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    }</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span> </div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    {<span class="comment">// 读取持仓数据</span></div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>        <span class="comment">// 初始化总平仓盈亏和总浮动盈亏</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>        <span class="keywordtype">double</span> total_profit = 0;</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>        <span class="keywordtype">double</span> total_dynprofit = 0;</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        <span class="comment">// 获取持仓数组</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        <span class="keyword">const</span> rj::Value&amp; jPos = root[<span class="stringliteral">&quot;positions&quot;</span>];</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>        <span class="comment">// 如果持仓数组存在且有效</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>        <span class="keywordflow">if</span> (!jPos.IsNull() &amp;&amp; jPos.IsArray())</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>        {</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>            <span class="comment">// 遍历所有持仓项目</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> rj::Value&amp; pItem : jPos.GetArray())</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>            {</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                <span class="comment">// 获取合约代码</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode = pItem[<span class="stringliteral">&quot;code&quot;</span>].GetString();</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>                <span class="comment">// 获取或创建持仓信息对象</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>                <a class="code hl_typedef" href="classWtEngine.html#a95d70b06ff982397dcc4ff218f5789d8">PosInfoPtr</a>&amp; pInfo = <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>                <span class="keywordflow">if</span> (pInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>                    pInfo.reset(<span class="keyword">new</span> <a class="code hl_struct" href="structWtEngine_1_1__PosInfo.html">PosInfo</a>);</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                <span class="comment">// 读取平仓盈亏</span></div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>                pInfo-&gt;_closeprofit = pItem[<span class="stringliteral">&quot;closeprofit&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>                <span class="comment">// 读取持仓量</span></div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>                pInfo-&gt;_volume = pItem[<span class="stringliteral">&quot;volume&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>                <span class="comment">// 如果持仓量为0，则浮动盈亏也为0，否则读取浮动盈亏</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>                <span class="keywordflow">if</span> (pInfo-&gt;_volume == 0)</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>                    pInfo-&gt;_dynprofit = 0;</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>                    pInfo-&gt;_dynprofit = pItem[<span class="stringliteral">&quot;dynprofit&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span> </div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>                <span class="comment">// 累计总平仓盈亏和总浮动盈亏</span></div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>                total_profit += pInfo-&gt;_closeprofit;</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>                total_dynprofit += pInfo-&gt;_dynprofit;</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span> </div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>                <span class="comment">// 获取持仓明细数组</span></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>                <span class="keyword">const</span> rj::Value&amp; details = pItem[<span class="stringliteral">&quot;details&quot;</span>];</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>                <span class="comment">// 如果明细数组不存在或为空，则跳过</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>                <span class="keywordflow">if</span> (details.IsNull() || !details.IsArray() || details.Size() == 0)</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span> </div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>                <span class="comment">// 遍历所有持仓明细</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>                <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; details.Size(); i++)</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>                {</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>                    <span class="comment">// 获取单个明细项目</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>                    <span class="keyword">const</span> rj::Value&amp; dItem = details[i];</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>                    <span class="comment">// 创建明细信息对象</span></div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>                    <a class="code hl_struct" href="structWtEngine_1_1__DetailInfo.html">DetailInfo</a> dInfo;</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>                    <span class="comment">// 读取多空方向标记（true为多头，false为空头）</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>                    dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a> = dItem[<span class="stringliteral">&quot;long&quot;</span>].GetBool();</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>                    <span class="comment">// 读取开仓价格</span></div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>                    dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">_price</a> = dItem[<span class="stringliteral">&quot;price&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>                    <span class="comment">// 读取持仓量</span></div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>                    dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a> = dItem[<span class="stringliteral">&quot;volume&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>                    <span class="comment">// 读取开仓时间</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>                    dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a4bb172995fd3cbb4a852123ef14b9eb3">_opentime</a> = dItem[<span class="stringliteral">&quot;opentime&quot;</span>].GetUint64();</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>                    <span class="comment">// 如果有开仓交易日字段，则读取</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>                    <span class="keywordflow">if</span> (dItem.HasMember(<span class="stringliteral">&quot;opentdate&quot;</span>))</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>                        dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#af014064a77bdaa2adf7c0950e3a552d7">_opentdate</a> = dItem[<span class="stringliteral">&quot;opentdate&quot;</span>].GetUint();</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span> </div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>                    <span class="comment">// 读取浮动盈亏</span></div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>                    dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a70a4ac93cfa1a2abd30d1d7920327c19">_profit</a> = dItem[<span class="stringliteral">&quot;profit&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>                    <span class="comment">// 将明细信息添加到持仓信息中</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>                    pInfo-&gt;_details.emplace_back(dInfo);</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>                }</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span> </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>                <span class="comment">// 输出持仓确认日志</span></div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>                <a class="code hl_function" href="classWTSLogger.html#adcbb6a78b99a8c514a4b55677e5a1a28">WTSLogger::debug</a>(<span class="stringliteral">&quot;Porfolio position confirmed,{} -&gt; {}&quot;</span>, stdCode, pInfo-&gt;_volume);</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>            }</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>        }</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>        <span class="comment">// 更新资金账户的总浮动盈亏</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>        <a class="code hl_struct" href="struct__WTSFundStruct.html">WTSFundStruct</a>&amp; fundInfo = <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a>-&gt;<a class="code hl_function" href="classWTSPortFundInfo.html#ae1618a5871a2fedb5e24c1ef435c5c8e">fundInfo</a>();</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#ab0b87a191365ccb2e793f14b44866975">_dynprofit</a> = total_dynprofit;</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span> </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>        <span class="comment">// 输出持仓加载完成日志</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>        <a class="code hl_function" href="classWTSLogger.html#adcbb6a78b99a8c514a4b55677e5a1a28">WTSLogger::debug</a>(<span class="stringliteral">&quot;{} position info of portfolio loaded&quot;</span>, <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>.size());</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    }</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span> </div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    <span class="comment">// 检查是否有风控参数配置</span></div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    <span class="keywordflow">if</span>(root.HasMember(<span class="stringliteral">&quot;riskmon&quot;</span>))</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    {</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>        <span class="comment">// 读取风控参数</span></div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>        <span class="keyword">const</span> rj::Value&amp; jRisk = root[<span class="stringliteral">&quot;riskmon&quot;</span>];</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>        <span class="comment">// 读取风控仓位比例，用于调整交易仓位的大小</span></div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>        <a class="code hl_variable" href="classWtEngine.html#a949c7b173c6799080d27e6b79e76297e">_risk_volscale</a> = jRisk[<span class="stringliteral">&quot;scale&quot;</span>].GetDouble();</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        <span class="comment">// 读取风控参数更新日期</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <a class="code hl_variable" href="classWtEngine.html#ae061bcec5d0092f7758bddb6c10ef5d5">_risk_date</a> = jRisk[<span class="stringliteral">&quot;date&quot;</span>].GetUint();</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>        <span class="comment">// 风控参数用于控制交易风险，包括仓位比例和更新日期</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>        <span class="comment">// 仓位比例用于调整交易仓位的大小，更新日期用于记录风控参数的更新时间</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    }</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>}</div>
</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span> </div>
<div class="foldopen" id="foldopen00971" data-start="{" data-end="}">
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno"><a class="line" href="classWtEngine.html#a336c43b26da626884612923bb5168225">  971</a></span><a class="code hl_class" href="classWTSTickSlice.html">WTSTickSlice</a>* <a class="code hl_function" href="classWtEngine.html#a336c43b26da626884612923bb5168225">WtEngine::get_tick_slice</a>(uint32_t sid, <span class="keyword">const</span> <span class="keywordtype">char</span>* code, uint32_t count)</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>{</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    <span class="comment">// 从数据管理器中获取Tick数据切片</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#a7621426df582e4c1a818623bb25b2d14">get_tick_slice</a>(code, count);</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>}</div>
</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="foldopen" id="foldopen00986" data-start="{" data-end="}">
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno"><a class="line" href="classWtEngine.html#abfa097f39c0bf17ea21e8ee8d54de47e">  986</a></span><a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* <a class="code hl_function" href="classWtEngine.html#abfa097f39c0bf17ea21e8ee8d54de47e">WtEngine::get_last_tick</a>(uint32_t sid, <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>{</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <span class="comment">// 从数据管理器中获取最新的Tick数据</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#a6cd8f89ff3aa31eac4b0cc54d363a65d">grab_last_tick</a>(stdCode);</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>}</div>
</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span> </div>
<div class="foldopen" id="foldopen01006" data-start="{" data-end="}">
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"><a class="line" href="classWtEngine.html#a138e94ed4c69081758d3de4307276a25"> 1006</a></span><a class="code hl_class" href="classWTSKlineSlice.html">WTSKlineSlice</a>* <a class="code hl_function" href="classWtEngine.html#a138e94ed4c69081758d3de4307276a25">WtEngine::get_kline_slice</a>(uint32_t sid, <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keyword">const</span> <span class="keywordtype">char</span>* period, uint32_t count, uint32_t times <span class="comment">/* = 1 */</span>, uint64_t etime <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>{</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>    <span class="comment">// 解析标准化合约代码</span></div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> codeInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(stdCode, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="comment">// 获取商品信息</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* cInfo = <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a435a180d8497a49cd6468fd34579b7ff">getCommodity</a>(codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">_exchg</a>, codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#a1d4f7a6320d180db879340b763224bbf">_product</a>);</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    <span class="comment">// 如果找不到商品信息，返回NULL</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keywordflow">if</span> (cInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    <span class="comment">// 使用线程本地存储的键值缓冲区</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    <span class="keyword">thread_local</span> <span class="keyword">static</span> <span class="keywordtype">char</span> key[64] = { 0 };</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>    <span class="comment">// 生成唯一的订阅键，包含合约代码、周期和倍数</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    <a class="code hl_function" href="namespacefmtutil.html#a5bfccdc4da1277f2585e7b31c6395bb3">fmtutil::format_to</a>(key, <span class="stringliteral">&quot;{}-{}-{}&quot;</span>, stdCode, period, times);</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span> </div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <span class="comment">// 将订阅者ID添加到订阅映射表中</span></div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    <a class="code hl_class" href="classwt__hashmap.html">SubList</a>&amp; sids = <a class="code hl_variable" href="classWtEngine.html#a8917b41644c63b149ec85d6a56e56389">_bar_sub_map</a>[key];</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    sids[sid] = std::make_pair(sid, 0);</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span> </div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    <span class="comment">// 定义K线周期类型</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    <a class="code hl_typedef" href="WTSTypes_8h.html#a27f5d8bd7208a5fc1d044c6f5961904c">WTSKlinePeriod</a> kp;</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="comment">// 如果是分钟周期</span></div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    <span class="keywordflow">if</span> (period[0] == <span class="charliteral">&#39;m&#39;</span>)</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    {</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>        <span class="comment">// 如果倍数是5的倍数，则使用基于5分钟线的周期</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>        <span class="keywordflow">if</span> (times % 5 == 0)</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        {</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>            kp = <a class="code hl_enumvalue" href="WTSTypes_8h.html#acac96eb977d20b3a6186f0ccede8a9d8adcd66f71c090964efdc8474bca5b9209">KP_Minute5</a>;</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>            times /= 5;</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>        }</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>            <span class="comment">// 否则使用基于1分钟线的周期</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>            kp = <a class="code hl_enumvalue" href="WTSTypes_8h.html#acac96eb977d20b3a6186f0ccede8a9d8a3b64a9f21f4bd5432a8b3f8424c4410e">KP_Minute1</a>;</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    }</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    {</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        <span class="comment">// 如果不是分钟周期，则默认使用日线周期</span></div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>        kp = <a class="code hl_enumvalue" href="WTSTypes_8h.html#acac96eb977d20b3a6186f0ccede8a9d8a048058b5939234978e278291866f6cd2">KP_DAY</a>;</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    }</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span> </div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>    <span class="comment">// 从数据管理器中获取K线切片数据</span></div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#ab4cdcf2a7c5069b105a9a89902e04c54">get_kline_slice</a>(stdCode, kp, times, count, etime);</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>}</div>
</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span> </div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span> </div>
<div class="foldopen" id="foldopen01058" data-start="{" data-end="}">
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"><a class="line" href="classWtEngine.html#abe547880a4fc90b37c4a054cf77314d5"> 1058</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#abe547880a4fc90b37c4a054cf77314d5">WtEngine::handle_push_quote</a>(<a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* curTick)</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>{</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>    <span class="comment">// 获取标准化合约代码</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>    std::string stdCode = curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae40aac80fd30843224b6e88d007b1d05">code</a>();</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <span class="comment">// 将Tick数据传递给数据管理器处理</span></div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#a3e3a1f265f439df9846c475348a12821">handle_push_quote</a>(stdCode.c_str(), curTick);</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    <span class="comment">// 调用on_tick函数处理原始合约的Tick数据</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    <a class="code hl_function" href="classWtEngine.html#a13559b13d0400d1a71e9eb71dcf8e84f">on_tick</a>(stdCode.c_str(), curTick);</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span> </div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="comment">// 获取当前价格</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>    <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> = curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>();</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    <span class="comment">// 获取合约信息</span></div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    <a class="code hl_class" href="classWTSContractInfo.html">WTSContractInfo</a>* cInfo = curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a3bf709056260520001ce36105cad50ed">getContractInfo</a>();</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    <span class="comment">// 判断是否为非平合约（即可以生成主力合约的合约）</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="comment">//if(hotFlag == 1)</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <span class="keywordflow">if</span>(!cInfo-&gt;<a class="code hl_function" href="classWTSContractInfo.html#af034e65b2bdf76e1737b36759e43ee0c">isFlat</a>())</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    {</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>        <span class="comment">// 获取主力合约代码</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>        <span class="keyword">const</span> <span class="keywordtype">char</span>* hotCode = cInfo-&gt;<a class="code hl_function" href="classWTSContractInfo.html#a0c356989f33d9acf090117960bbfa605">getHotCode</a>();</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>        <span class="comment">// 创建主力合约的Tick数据对象</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>        <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* hotTick = <a class="code hl_function" href="classWTSTickData.html#a4b56adfd1cd4e6b95833653ca987ce43">WTSTickData::create</a>(curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a6a81212366831e7afe3eeac41b42e7b0">getTickStruct</a>());</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>        <span class="comment">// 设置主力合约代码</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>        hotTick-&gt;<a class="code hl_function" href="classWTSTickData.html#af8df9fb130bea4ca8470a0ccef56b690">setCode</a>(hotCode);</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>        <span class="comment">// 设置合约信息</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>        hotTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a3f5ca8ee02338f1991293bb33ba0318d">setContractInfo</a>(curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a3bf709056260520001ce36105cad50ed">getContractInfo</a>());</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span> </div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>        <span class="comment">// 将主力合约的Tick数据传递给数据管理器处理</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>        <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#a3e3a1f265f439df9846c475348a12821">handle_push_quote</a>(hotCode, hotTick);</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>        <span class="comment">// 调用on_tick函数处理主力合约的Tick数据</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        <a class="code hl_function" href="classWtEngine.html#a13559b13d0400d1a71e9eb71dcf8e84f">on_tick</a>(hotCode, hotTick);</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span> </div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <span class="comment">// 释放主力合约的Tick数据对象</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>        hotTick-&gt;<a class="code hl_function" href="classWTSPoolObject.html#a868f127b3ccc31cba6b077803cb00951">release</a>();</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>    }</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    <span class="comment">// 以下注释代码是旧的实现方式，用于处理次主力合约</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    <span class="comment">//else if (hotFlag == 2)</span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    <span class="comment">//{</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>    <span class="comment">//  std::string scndCode = CodeHelper::stdCodeToStd2ndCode(stdCode.c_str());</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>    <span class="comment">//  WTSTickData* scndTick = WTSTickData::create(curTick-&gt;getTickStruct());</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    <span class="comment">//  scndTick-&gt;setCode(scndCode.c_str());</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>    <span class="comment">//  scndTick-&gt;setContractInfo(curTick-&gt;getContractInfo());</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span> </div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>    <span class="comment">//  _data_mgr-&gt;handle_push_quote(scndCode.c_str(), scndTick);</span></div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>    <span class="comment">//  on_tick(scndCode.c_str(), scndTick);</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <span class="comment">//  scndTick-&gt;release();</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>    <span class="comment">//}</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>}</div>
</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span> </div>
<div class="foldopen" id="foldopen01116" data-start="{" data-end="}">
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"><a class="line" href="classWtEngine.html#a658742fa0657c79475f8c7675c4bb897"> 1116</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classWtEngine.html#a658742fa0657c79475f8c7675c4bb897">WtEngine::get_cur_price</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>{</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>    <span class="comment">// 获取合约代码长度</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    <span class="keyword">auto</span> len = strlen(stdCode);</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    <span class="comment">// 获取合约代码的最后一个字符，用于判断是否需要复权</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="keywordtype">char</span> lastChar = stdCode[len - 1];</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <span class="comment">//判断是否需要复权</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <span class="keywordtype">bool</span> bAdjusted = (lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a> || lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#a57589d4ee5ee7b3d186d8e3c6436bce7">SUFFIX_HFQ</a>);</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    <span class="comment">//前复权需要去掉后缀，后复权和未复权都直接使用原始代码</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    std::string sCode = (lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a>) ? std::string(stdCode, len - 1) : stdCode;</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>    <span class="comment">// 在价格缓存中查找</span></div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    <span class="keyword">auto</span> it = <a class="code hl_variable" href="classWtEngine.html#a04c2ea36fe63e6d3d92bac9d3000a5ac">_price_map</a>.find(sCode);</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>    <span class="comment">// 如果缓存中没有找到，需要从数据管理器中获取</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    <span class="keywordflow">if</span>(it == <a class="code hl_variable" href="classWtEngine.html#a04c2ea36fe63e6d3d92bac9d3000a5ac">_price_map</a>.end())</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    {</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>        <span class="comment">// 如果是复权代码，先去掉后缀获取原始代码</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>        std::string fCode = bAdjusted ? std::string(stdCode, len - 1) : stdCode;</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>        <span class="comment">// 从数据管理器中获取最新的Tick数据</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>        <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* lastTick = <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#a6cd8f89ff3aa31eac4b0cc54d363a65d">grab_last_tick</a>(fCode.c_str());</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>        <span class="comment">// 如果没有找到Tick数据，返回0</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>        <span class="keywordflow">if</span> (lastTick == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>            <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span> </div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>        <span class="comment">// 获取合约信息</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>        <a class="code hl_class" href="classWTSContractInfo.html">WTSContractInfo</a>* cInfo = lastTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a3bf709056260520001ce36105cad50ed">getContractInfo</a>();</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span> </div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>        <span class="comment">// 获取原始价格</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        <span class="keywordtype">double</span> ret = lastTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>();</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>        <span class="comment">// 释放Tick数据对象</span></div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>        lastTick-&gt;<a class="code hl_function" href="classWTSPoolObject.html#a868f127b3ccc31cba6b077803cb00951">release</a>();</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span> </div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="comment">// 如果是后复权，需要将价格乘以除权因子</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>        <span class="keywordflow">if</span> (lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#a57589d4ee5ee7b3d186d8e3c6436bce7">SUFFIX_HFQ</a>)</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>        {</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>            <span class="comment">// 获取除权因子并进行价格调整</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>            ret *= <a class="code hl_function" href="classWtEngine.html#ab6464b8e3675226ef6b3c89f8bbe2e7a">get_exright_factor</a>(stdCode, cInfo-&gt;<a class="code hl_function" href="classWTSContractInfo.html#a8fa410ebad3ac115725f7c06c0440211">getCommInfo</a>());</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>        }</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span> </div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>        <span class="comment">// 将计算后的价格存入缓存</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>        <a class="code hl_variable" href="classWtEngine.html#a04c2ea36fe63e6d3d92bac9d3000a5ac">_price_map</a>[sCode] = ret;</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>    }</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>    {</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>        <span class="comment">// 如果缓存中找到了，直接返回缓存的价格</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>        <span class="keywordflow">return</span> it-&gt;second;</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>    }</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>}</div>
</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span> </div>
<div class="foldopen" id="foldopen01174" data-start="{" data-end="}">
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"><a class="line" href="classWtEngine.html#aa18f2cc0bac48ac597a21307d6ff9085"> 1174</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classWtEngine.html#aa18f2cc0bac48ac597a21307d6ff9085">WtEngine::get_day_price</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">int</span> flag <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>{</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>    <span class="comment">// 获取合约代码长度</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>    <span class="keyword">auto</span> len = strlen(stdCode);</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>    <span class="comment">// 获取合约代码的最后一个字符，用于判断是否需要复权</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>    <span class="keywordtype">char</span> lastChar = stdCode[len - 1];</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>    <span class="comment">//判断是否需要复权</span></div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>    <span class="keywordtype">bool</span> bAdjusted = (lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a> || lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#a57589d4ee5ee7b3d186d8e3c6436bce7">SUFFIX_HFQ</a>);</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>    <span class="comment">//前复权需要去掉后缀，后复权和未复权都直接使用原始代码</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>    std::string sCode = (lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a>) ? std::string(stdCode, len - 1) : stdCode;</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span> </div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>    <span class="comment">// 如果是复权代码，先去掉后缀获取原始代码</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>    std::string fCode = bAdjusted ? std::string(stdCode, len - 1) : stdCode;</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>    <span class="comment">// 从数据管理器中获取最新的Tick数据</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>    <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* lastTick = <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#a6cd8f89ff3aa31eac4b0cc54d363a65d">grab_last_tick</a>(fCode.c_str());</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>    <span class="comment">// 如果没有找到Tick数据，返回0</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    <span class="keywordflow">if</span> (lastTick == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>    <span class="comment">// 获取商品信息</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_function" href="classWtEngine.html#a048845994584287eec212d39539ba645">get_commodity_info</a>(fCode.c_str());</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span> </div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>    <span class="comment">// 根据价格类型标志获取相应的价格</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    <span class="keywordtype">double</span> ret = 0.0;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>    <span class="keywordflow">switch</span> (flag)</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>    {</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>    <span class="keywordflow">case</span> 0: <span class="comment">// 开盘价</span></div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>        ret = lastTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a25b6a4e9293d666b29ee5c409d72073a">open</a>(); <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>    <span class="keywordflow">case</span> 1: <span class="comment">// 最高价</span></div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>        ret = lastTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a7119fbf29cf6e3775a75bc0c093ab613">high</a>(); <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>    <span class="keywordflow">case</span> 2: <span class="comment">// 最低价</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>        ret = lastTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a47ff21745fccd3f0e8c8178b601e2b39">low</a>(); <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>    <span class="keywordflow">case</span> 3: <span class="comment">// 收盘价/当前价</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>        ret = lastTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>(); <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>    }</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    <span class="comment">// 释放Tick数据对象</span></div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>    lastTick-&gt;<a class="code hl_function" href="classWTSPoolObject.html#a868f127b3ccc31cba6b077803cb00951">release</a>();</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span> </div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>    <span class="comment">// 如果是后复权，需要将价格乘以除权因子</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    <span class="keywordflow">if</span> (lastChar == <a class="code hl_variable" href="CodeHelper_8hpp.html#a57589d4ee5ee7b3d186d8e3c6436bce7">SUFFIX_HFQ</a>)</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>    {</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>        <span class="comment">// 获取除权因子并进行价格调整</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>        ret *= <a class="code hl_function" href="classWtEngine.html#ab6464b8e3675226ef6b3c89f8bbe2e7a">get_exright_factor</a>(stdCode, commInfo);</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>    }</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span> </div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>}</div>
</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span> </div>
<div class="foldopen" id="foldopen01234" data-start="{" data-end="}">
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"><a class="line" href="classWtEngine.html#ab6464b8e3675226ef6b3c89f8bbe2e7a"> 1234</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classWtEngine.html#ab6464b8e3675226ef6b3c89f8bbe2e7a">WtEngine::get_exright_factor</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo <span class="comment">/* = NULL */</span>)</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>{</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    <span class="comment">// 如果没有提供商品信息，则自动获取</span></div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>    <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>        commInfo = <a class="code hl_function" href="classWtEngine.html#a048845994584287eec212d39539ba645">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span> </div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>    <span class="comment">// 如果仍然无法获取商品信息，则返回默认因子1.0（不复权）</span></div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>    <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>        <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span> </div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>    <span class="comment">// 如果是股票，从数据管理器中获取除权因子</span></div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>    <span class="keywordflow">if</span> (commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a423fe594ac3daf36d22956bc07706f75">isStock</a>())</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">_data_mgr</a>-&gt;<a class="code hl_function" href="classWtDtMgr.html#ad95c02b7148be0d26851d8cb9ce32002">get_adjusting_factor</a>(stdCode, <a class="code hl_function" href="classWtEngine.html#a73508a20ab06d4e602d671dc48e06b1e">get_trading_date</a>());</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>    {</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>        <span class="comment">// 如果是期货，则获取规则标签</span></div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>        <span class="keyword">const</span> <span class="keywordtype">char</span>* ruleTag = <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>-&gt;<a class="code hl_function" href="classIHotMgr.html#af8bb8076fc8bf44ea9897f7dc418d5f6">getRuleTag</a>(stdCode);</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>        <span class="comment">// 如果有规则标签，则从主力合约管理器中获取规则因子</span></div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>        <span class="keywordflow">if</span>(strlen(ruleTag) &gt; 0)</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>-&gt;<a class="code hl_function" href="classIHotMgr.html#aca821cad1dccf944e7afa850fb848e30">getRuleFactor</a>(ruleTag, commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a109c202bf9a0216819d45e676fa029bf">getFullPid</a>(), <a class="code hl_function" href="classWtEngine.html#a73508a20ab06d4e602d671dc48e06b1e">get_trading_date</a>());</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>    }</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span> </div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>    <span class="comment">// 默认返回1.0（不复权）</span></div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>    <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>}</div>
</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span> </div>
<div class="foldopen" id="foldopen01266" data-start="{" data-end="}">
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"><a class="line" href="classWtEngine.html#ae090cca52beb4eda803a06afd384e626"> 1266</a></span>uint32_t <a class="code hl_function" href="classWtEngine.html#ae090cca52beb4eda803a06afd384e626">WtEngine::get_adjusting_flag</a>()</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>{</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>    <span class="comment">// 当当前日期与交易日期相同时，不需要复权</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a> == <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>)</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span> </div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    <span class="comment">// 当当前日期与交易日期不同时，需要复权</span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>}</div>
</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span> </div>
<div class="foldopen" id="foldopen01285" data-start="{" data-end="}">
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"><a class="line" href="classWtEngine.html#a5ca45b0593039bc63b4eab1c215ec828"> 1285</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a5ca45b0593039bc63b4eab1c215ec828">WtEngine::sub_tick</a>(uint32_t sid, <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>{</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>    <span class="comment">// 如果是主力合约代码, 如SHFE.ag.HOT, 那么要转换成原合约代码, 如SHFE.ag.1912</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>    <span class="comment">// 因为执行器只识别原合约代码</span></div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>    <span class="comment">// 获取合约的规则标签，用于判断是否为主力合约</span></div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* ruleTag = <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>-&gt;<a class="code hl_function" href="classIHotMgr.html#af8bb8076fc8bf44ea9897f7dc418d5f6">getRuleTag</a>(stdCode);</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>    <span class="comment">// 如果有规则标签，说明是主力合约</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>    <span class="keywordflow">if</span>(strlen(ruleTag) &gt; 0)</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>    {</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>        <span class="comment">// 以下注释代码是旧的实现方式</span></div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>        <span class="comment">//SubList&amp; sids = _tick_sub_map[stdCode];</span></div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>        <span class="comment">//sids[sid] = std::make_pair(sid, 0);</span></div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span> </div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>        <span class="comment">// 获取合约代码长度</span></div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>        std::size_t length = strlen(stdCode);</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>        <span class="comment">// 复权标志：0-不复权，1-前复权，2-后复权</span></div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>        uint32_t flag = 0;</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>        <span class="comment">// 判断是否有复权后缀</span></div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>        <span class="keywordflow">if</span> (stdCode[length - 1] == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a> || stdCode[length - 1] == <a class="code hl_variable" href="CodeHelper_8hpp.html#a57589d4ee5ee7b3d186d8e3c6436bce7">SUFFIX_HFQ</a>)</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>        {</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>            <span class="comment">// 如果有复权后缀，则去掉后缀</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>            length--;</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span> </div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>            <span class="comment">// 设置复权标志：1-前复权，2-后复权</span></div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>            flag = (stdCode[length] == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a>) ? 1 : 2;</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        }</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span> </div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>        <span class="comment">// 将订阅者ID和复权标志添加到订阅映射表中</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>        <a class="code hl_class" href="classwt__hashmap.html">SubList</a>&amp; sids = <a class="code hl_variable" href="classWtEngine.html#aca3e2d517249bef5ed21db8a71e66d26">_tick_sub_map</a>[std::string(stdCode, length)];</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>        sids[sid] = std::make_pair(sid, flag);</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span> </div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>        <span class="comment">// 解析标准化合约代码</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>        <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> cInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(stdCode, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>        <span class="comment">// 获取实际的原始合约代码</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>        std::string rawCode = <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>-&gt;<a class="code hl_function" href="classIHotMgr.html#a0eeb3b1944544abdcd6bcbfccadfc356">getCustomRawCode</a>(ruleTag, cInfo.<a class="code hl_function" href="structCodeHelper_1_1__CodeInfo.html#aa13a243f0cd0f40c859242b5c524a9a4">stdCommID</a>(), <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>);</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>        <span class="comment">// 将原始合约代码转换为标准化合约代码</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>        std::string stdRawCode = <a class="code hl_function" href="classCodeHelper.html#ad05f109a3cdaca9068d19d41fc288643">CodeHelper::rawMonthCodeToStdCode</a>(rawCode.c_str(), cInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">_exchg</a>);</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>    }</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>    <span class="comment">//if (CodeHelper::isStdFutHotCode(stdCode))</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>    <span class="comment">//{</span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>    <span class="comment">//  SubList&amp; sids = _tick_sub_map[stdCode];</span></div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>    <span class="comment">//  sids[sid] = std::make_pair(sid, 0);</span></div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span> </div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>    <span class="comment">//  CodeHelper::CodeInfo cInfo = CodeHelper::extractStdCode(stdCode);</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>    <span class="comment">//  std::string rawCode = _hot_mgr-&gt;getRawCode(cInfo._exchg, cInfo._product, _cur_tdate);</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>    <span class="comment">//  std::string stdRawCode = CodeHelper::rawMonthCodeToStdCode(rawCode.c_str(), cInfo._exchg);</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>    <span class="comment">//  //_ticksubed_raw_codes.insert(stdRawCode);</span></div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>    <span class="comment">//}</span></div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>    <span class="comment">//else if (CodeHelper::isStdFut2ndCode(stdCode))</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>    <span class="comment">//{</span></div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>    <span class="comment">//  SubList&amp; sids = _tick_sub_map[stdCode];</span></div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>    <span class="comment">//  sids[sid] = std::make_pair(sid, 0);</span></div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span> </div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>    <span class="comment">//  CodeHelper::CodeInfo cInfo = CodeHelper::extractStdCode(stdCode);</span></div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>    <span class="comment">//  std::string rawCode = _hot_mgr-&gt;getSecondRawCode(cInfo._exchg, cInfo._product, _cur_tdate);</span></div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>    <span class="comment">//  std::string stdRawCode = CodeHelper::rawMonthCodeToStdCode(rawCode.c_str(), cInfo._exchg);</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>    <span class="comment">//  //_ticksubed_raw_codes.insert(stdRawCode);</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>    <span class="comment">//}</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>    <span class="comment">// 如果不是主力合约，则直接订阅原始合约</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>    {</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>        <span class="comment">// 获取合约代码长度</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>        std::size_t length = strlen(stdCode);</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>        <span class="comment">// 复权标志：0-不复权，1-前复权，2-后复权</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>        uint32_t flag = 0;</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>        <span class="comment">// 判断是否有复权后缀</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>        <span class="keywordflow">if</span> (stdCode[length - 1] == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a> || stdCode[length - 1] == <a class="code hl_variable" href="CodeHelper_8hpp.html#a57589d4ee5ee7b3d186d8e3c6436bce7">SUFFIX_HFQ</a>)</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>        {</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>            <span class="comment">// 如果有复权后缀，则去掉后缀</span></div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>            length--;</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span> </div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>            <span class="comment">// 设置复权标志：1-前复权，2-后复权</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>            flag = (stdCode[length - 1] == <a class="code hl_variable" href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a>) ? 1 : 2;</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>        }</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span> </div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>        <span class="comment">// 将订阅者ID和复权标志添加到订阅映射表中</span></div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        <a class="code hl_class" href="classwt__hashmap.html">SubList</a>&amp; sids = <a class="code hl_variable" href="classWtEngine.html#aca3e2d517249bef5ed21db8a71e66d26">_tick_sub_map</a>[std::string(stdCode, length)];</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>        sids[sid] = std::make_pair(sid, flag);</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>        <span class="comment">// 以下注释代码是旧的实现方式，用于记录订阅的原始合约代码</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>        <span class="comment">//_ticksubed_raw_codes.insert(std::string(stdCode, length));</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>    }</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>}</div>
</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span> </div>
<div class="foldopen" id="foldopen01376" data-start="{" data-end="}">
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"><a class="line" href="classWtEngine.html#a18bf11787444741d15a4c1993c16f9dd"> 1376</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a18bf11787444741d15a4c1993c16f9dd">WtEngine::load_fees</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename)</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>{</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>    <span class="comment">// 如果文件名为空，直接返回</span></div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>    <span class="keywordflow">if</span> (strlen(filename) == 0)</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span> </div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    <span class="comment">// 检查文件是否存在</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classStdFile.html#a65778f7268857f981a2e19acb8379761">StdFile::exists</a>(filename))</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>    {</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>        <span class="comment">// 如果文件不存在，记录错误日志</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>        <a class="code hl_function" href="classWTSLogger.html#a618c41d0ff3c1f5ce0a70d83c28bc9fc">WTSLogger::error</a>(<span class="stringliteral">&quot;Fee templates file {} not exists&quot;</span>, filename);</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>    }</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span> </div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>    <span class="comment">// 从文件加载配置</span></div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>    <a class="code hl_class" href="classWTSVariant.html">WTSVariant</a>* cfg = <a class="code hl_function" href="classWTSCfgLoader.html#a222f42e290bc1aa38b4f67c005e10887">WTSCfgLoader::load_from_file</a>(filename);</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>    <span class="keywordflow">if</span> (cfg == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>    {</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>        <span class="comment">// 如果加载失败，记录错误日志</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>        <a class="code hl_function" href="classWTSLogger.html#a618c41d0ff3c1f5ce0a70d83c28bc9fc">WTSLogger::error</a>(<span class="stringliteral">&quot;Fee templates file {} loading failed&quot;</span>, filename);</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>    }</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span> </div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    <span class="comment">// 获取所有配置项的键名（商品ID）</span></div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>    <span class="keyword">auto</span> keys = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a4324db343ea15614f9ad80e1e4d076b8">memberNames</a>();</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>    <span class="comment">// 遍历所有商品配置</span></div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> std::string&amp; fullPid : keys)</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>    {</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>        <span class="comment">// 获取当前商品的费用配置</span></div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>        <a class="code hl_class" href="classWTSVariant.html">WTSVariant</a>* cfgItem = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a4dacb2b4afd195d05dedb5323d7982f3">get</a>(fullPid.c_str());</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>        <span class="comment">// 将商品ID按点分隔，分为交易所和品种代码</span></div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="StrUtil_8hpp.html#ab8e1ede88e2ff1c3b448334e6cbd3533">StringVector</a>&amp; ay = <a class="code hl_function" href="classStrUtil.html#ab7f8887aed021ea6dafe93ce1f2b67a0">StrUtil::split</a>(fullPid, <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>        <span class="comment">// 从基础数据管理器中获取商品信息</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>        <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a435a180d8497a49cd6468fd34579b7ff">getCommodity</a>(ay[0].c_str(), ay[1].c_str());</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>        <span class="comment">// 如果商品信息不存在，跳过当前项</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>        <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span> </div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>        <span class="comment">// 设置费用率：开仓手续费、平仓手续费、平今手续费，以及是否按手数计算</span></div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>        commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a5cd587f6361eda2a9d3d68c58288982f">setFeeRates</a>(cfgItem-&gt;<a class="code hl_function" href="classWTSVariant.html#a394beb745c43614ae782ea502735143f">getDouble</a>(<span class="stringliteral">&quot;open&quot;</span>), cfgItem-&gt;<a class="code hl_function" href="classWTSVariant.html#a394beb745c43614ae782ea502735143f">getDouble</a>(<span class="stringliteral">&quot;close&quot;</span>), cfgItem-&gt;<a class="code hl_function" href="classWTSVariant.html#a394beb745c43614ae782ea502735143f">getDouble</a>(<span class="stringliteral">&quot;closetoday&quot;</span>), cfgItem-&gt;<a class="code hl_function" href="classWTSVariant.html#a597bf32bfe71fb040721dc65dc786df6">getBoolean</a>(<span class="stringliteral">&quot;byvolume&quot;</span>));</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>        <span class="comment">// 设置保证金率</span></div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>        commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#add2c9d0cd2f7463cb0f60c85cd118fef">setMarginRate</a>(cfgItem-&gt;<a class="code hl_function" href="classWTSVariant.html#a394beb745c43614ae782ea502735143f">getDouble</a>(<span class="stringliteral">&quot;margin&quot;</span>));</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>    }</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span> </div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>    <span class="comment">// 释放配置对象</span></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>    cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a888d00f531f1a3ae9d0f12543f302522">release</a>();</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span> </div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>    <span class="comment">// 记录加载完成日志</span></div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>    <a class="code hl_function" href="classWTSLogger.html#a20d65255542e3ed5d694b529892a0f57">WTSLogger::info</a>(<span class="stringliteral">&quot;{} fee templates loaded&quot;</span>, <a class="code hl_variable" href="classWtEngine.html#a3c792ff47f8a8cccbbdfa5a0eb5ca0e7">_fee_map</a>.size());</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>}</div>
</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span> </div>
<div class="foldopen" id="foldopen01439" data-start="{" data-end="}">
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"><a class="line" href="classWtEngine.html#a3ce8b51712ebb3eb403b90afe90b0304"> 1439</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classWtEngine.html#a3ce8b51712ebb3eb403b90afe90b0304">WtEngine::calc_fee</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, uint32_t offset)</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>{</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>    <span class="comment">// 解析标准化合约代码，获取商品ID</span></div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>    <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> codeInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(stdCode, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* stdPID = codeInfo.<a class="code hl_function" href="structCodeHelper_1_1__CodeInfo.html#aa13a243f0cd0f40c859242b5c524a9a4">stdCommID</a>();</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>    <span class="comment">// 从手续费映射表中查找对应商品的手续费模板</span></div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>    <span class="keyword">auto</span> it = <a class="code hl_variable" href="classWtEngine.html#a3c792ff47f8a8cccbbdfa5a0eb5ca0e7">_fee_map</a>.find(stdPID);</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>    <span class="comment">// 如果找不到对应的手续费模板，记录警告并返回0.0</span></div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>    <span class="keywordflow">if</span> (it == <a class="code hl_variable" href="classWtEngine.html#a3c792ff47f8a8cccbbdfa5a0eb5ca0e7">_fee_map</a>.end())</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>    {</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>        <a class="code hl_function" href="classWTSLogger.html#a147defb6e1fb287cc8d95bfb753f6f11">WTSLogger::warn</a>(<span class="stringliteral">&quot;Fee template of {} not found, return 0.0 as default&quot;</span>, stdPID);</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>    }</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span> </div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>    <span class="comment">// 初始化返回值</span></div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>    <span class="keywordtype">double</span> ret = 0.0;</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>    <span class="comment">// 获取商品信息</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a435a180d8497a49cd6468fd34579b7ff">getCommodity</a>(stdPID);</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>    <span class="comment">// 获取手续费项</span></div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structWtEngine_1_1__FeeItem.html">FeeItem</a>&amp; fItem = it-&gt;second;</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>    <span class="comment">// 如果是按手数计算手续费</span></div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>    <span class="keywordflow">if</span>(fItem.<a class="code hl_variable" href="structWtEngine_1_1__FeeItem.html#ac96429edbc80400202b1118936784db3">_by_volume</a>)</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>    {</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>        <span class="comment">// 根据开平仓类型选择不同的费率</span></div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>        <span class="keywordflow">switch</span> (offset)</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>        {</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>        <span class="keywordflow">case</span> 0: ret = fItem.<a class="code hl_variable" href="structWtEngine_1_1__FeeItem.html#aedc9935f6f316885e870dcdc296b8380">_open</a>*qty; <span class="keywordflow">break</span>;        <span class="comment">// 开仓手续费 = 开仓费率 * 数量</span></div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>        <span class="keywordflow">case</span> 1: ret = fItem.<a class="code hl_variable" href="structWtEngine_1_1__FeeItem.html#a84034290bc5695ade05ae3395d247b4c">_close</a>*qty; <span class="keywordflow">break</span>;       <span class="comment">// 平仓手续费 = 平仓费率 * 数量</span></div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>        <span class="keywordflow">case</span> 2: ret = fItem.<a class="code hl_variable" href="structWtEngine_1_1__FeeItem.html#aa5a0dde57240a86963f4aa129d4768ab">_close_today</a>*qty; <span class="keywordflow">break</span>; <span class="comment">// 平今仓手续费 = 平今费率 * 数量</span></div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>        <span class="keywordflow">default</span>: ret = 0.0; <span class="keywordflow">break</span>;                   <span class="comment">// 默认情况返回0.0</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>        }</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>    }</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>    <span class="comment">// 如果是按金额计算手续费</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>    {</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>        <span class="comment">// 计算交易金额 = 价格 * 数量 * 合约乘数</span></div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>        <span class="keywordtype">double</span> amount = <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>*qty*commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">getVolScale</a>();</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>        <span class="comment">// 根据开平仓类型选择不同的费率</span></div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>        <span class="keywordflow">switch</span> (offset)</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>        {</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>        <span class="keywordflow">case</span> 0: ret = fItem.<a class="code hl_variable" href="structWtEngine_1_1__FeeItem.html#aedc9935f6f316885e870dcdc296b8380">_open</a>*amount; <span class="keywordflow">break</span>;        <span class="comment">// 开仓手续费 = 开仓费率 * 交易金额</span></div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>        <span class="keywordflow">case</span> 1: ret = fItem.<a class="code hl_variable" href="structWtEngine_1_1__FeeItem.html#a84034290bc5695ade05ae3395d247b4c">_close</a>*amount; <span class="keywordflow">break</span>;       <span class="comment">// 平仓手续费 = 平仓费率 * 交易金额</span></div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>        <span class="keywordflow">case</span> 2: ret = fItem.<a class="code hl_variable" href="structWtEngine_1_1__FeeItem.html#aa5a0dde57240a86963f4aa129d4768ab">_close_today</a>*amount; <span class="keywordflow">break</span>; <span class="comment">// 平今仓手续费 = 平今费率 * 交易金额</span></div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>        <span class="keywordflow">default</span>: ret = 0.0; <span class="keywordflow">break</span>;                      <span class="comment">// 默认情况返回0.0</span></div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>        }</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>    }</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span> </div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>    <span class="comment">// 将手续费四舍五入到两位小数</span></div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>    <span class="keywordflow">return</span> (int32_t)(ret * 100 + 0.5) / 100.0;</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>}</div>
</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span> </div>
<div class="foldopen" id="foldopen01499" data-start="{" data-end="}">
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"><a class="line" href="classWtEngine.html#a2c25985ccf06e1da8f2767a23620e875"> 1499</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a2c25985ccf06e1da8f2767a23620e875">WtEngine::append_signal</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> qty, <span class="keywordtype">bool</span> bStandBy <span class="comment">/* = true */</span>)</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>{</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span><span class="comment">     *  By Wesley @ 2021.12.16</span></div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span><span class="comment">     *  这里发现一个问题，就是组合的理论成交价和策略的理论成交价不一致</span></div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span><span class="comment">     *  检查以后发现，策略的理论成交价会在下一个tick更新</span></div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span><span class="comment">     *  但是组合的理论成交价这一个tick就直接更新了</span></div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span><span class="comment">     *  这就导致组合成交价永远比策略提前一个tick</span></div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span><span class="comment">     *  这里做一个修正，等下一个tick进来，触发signal</span></div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span><span class="comment">     *  如果是bar内触发的，bStandBy为false，则直接修改持仓</span></div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span><span class="comment">     */</span></div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>    <span class="comment">// 获取当前合约价格</span></div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>    <span class="keywordtype">double</span> curPx = <a class="code hl_function" href="classWtEngine.html#a658742fa0657c79475f8c7675c4bb897">get_cur_price</a>(stdCode);</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>    <span class="comment">// 如果需要等待下一个Tick或者当前价格为0，则将信号存入信号映射表</span></div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>    <span class="keywordflow">if</span>(bStandBy || <a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(curPx, 0.0))</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>    {</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>        <span class="comment">// 获取或创建合约的信号信息</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>        <a class="code hl_struct" href="structWtEngine_1_1__SigInfo.html">SigInfo</a>&amp; sInfo = <a class="code hl_variable" href="classWtEngine.html#a2a2a7c974cbdc00810a0451552c5e271">_sig_map</a>[stdCode];</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>        <span class="comment">// 设置目标持仓量</span></div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>        sInfo.<a class="code hl_variable" href="structWtEngine_1_1__SigInfo.html#a2c8fd5df10de9b10311327dbf0878167">_volume</a> = qty;</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>        <span class="comment">// 记录信号生成时间</span></div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>        sInfo.<a class="code hl_variable" href="structWtEngine_1_1__SigInfo.html#aa0f12a7afa24e182f6069e5e9f55e382">_gentime</a> = (uint64_t)<a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a> * 1000000000 + (uint64_t)<a class="code hl_variable" href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">_cur_raw_time</a> * 100000 + <a class="code hl_variable" href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">_cur_secs</a>;</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>    }</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>    {</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>        <span class="comment">// 如果不需要等待，则直接调用do_set_position设置持仓</span></div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>        <a class="code hl_function" href="classWtEngine.html#a7c136cba5e314c5f4dbb1f13838e849c">do_set_position</a>(stdCode, qty);</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>    }</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span> </div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span><span class="comment">    double curPx = get_cur_price(stdCode);</span></div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span><span class="comment">    if(decimal::eq(curPx, 0.0))</span></div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span><span class="comment">    {</span></div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span><span class="comment">        SigInfo&amp; sInfo = _sig_map[stdCode];</span></div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span><span class="comment">        sInfo._volume = qty;</span></div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span><span class="comment">        sInfo._gentime = (uint64_t)_cur_date * 1000000000 + (uint64_t)_cur_raw_time * 100000 + _cur_secs;</span></div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span><span class="comment">    }</span></div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span><span class="comment">    else</span></div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span><span class="comment">    {</span></div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span><span class="comment">        do_set_position(stdCode, qty);</span></div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span><span class="comment">    }</span></div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span><span class="comment">    */</span></div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>}</div>
</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span> </div>
<div class="foldopen" id="foldopen01552" data-start="{" data-end="}">
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"><a class="line" href="classWtEngine.html#a7c136cba5e314c5f4dbb1f13838e849c"> 1552</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a7c136cba5e314c5f4dbb1f13838e849c">WtEngine::do_set_position</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> qty, <span class="keywordtype">double</span> curPx <span class="comment">/* = -1 */</span>)</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>{</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>    <span class="comment">// 获取或创建合约的持仓信息对象</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>    <a class="code hl_typedef" href="classWtEngine.html#a95d70b06ff982397dcc4ff218f5789d8">PosInfoPtr</a>&amp; pInfo = <a class="code hl_variable" href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>    <span class="keywordflow">if</span> (pInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>        pInfo.reset(<span class="keyword">new</span> <a class="code hl_struct" href="structWtEngine_1_1__PosInfo.html">PosInfo</a>);</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span> </div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>    <span class="comment">// 加锁保护持仓信息，防止多线程并发修改</span></div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>    <a class="code hl_class" href="classSpinLock.html">SpinLock</a> lock(pInfo-&gt;_mtx);</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span> </div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>    <span class="comment">// 如果传入的价格小于0，则自动获取当前合约价格</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(curPx, 0))</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>        curPx = <a class="code hl_function" href="classWtEngine.html#a658742fa0657c79475f8c7675c4bb897">get_cur_price</a>(stdCode);</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span> </div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>    <span class="comment">// 生成当前时间戳和交易日期</span></div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>    uint64_t curTm = (uint64_t)<a class="code hl_variable" href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">_cur_date</a> * 10000 + <a class="code hl_variable" href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">_cur_time</a>;</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>    uint32_t curTDate = <a class="code hl_variable" href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">_cur_tdate</a>;</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span> </div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>    <span class="comment">// 如果目标仓位与当前仓位相等，则无需操作，直接返回</span></div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(pInfo-&gt;_volume, qty))</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span> </div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>    <span class="comment">// 计算目标仓位与当前仓位的差值，决定是增加还是减少持仓</span></div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>    <span class="keywordtype">double</span> diff = qty - pInfo-&gt;_volume;</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span> </div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>    <span class="comment">// 提取合约信息和商品信息</span></div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>    <a class="code hl_struct" href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::CodeInfo</a> codeInfo = <a class="code hl_function" href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a>(stdCode, <a class="code hl_variable" href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">_hot_mgr</a>);</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classWtEngine.html#af42087900846f147e477097373ae3a2f">_base_data_mgr</a>-&gt;<a class="code hl_function" href="classIBaseDataMgr.html#a435a180d8497a49cd6468fd34579b7ff">getCommodity</a>(codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">_exchg</a>, codeInfo.<a class="code hl_variable" href="structCodeHelper_1_1__CodeInfo.html#a1d4f7a6320d180db879340b763224bbf">_product</a>);</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span> </div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>    <a class="code hl_struct" href="struct__WTSFundStruct.html">WTSFundStruct</a>&amp; fundInfo = <a class="code hl_variable" href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">_port_fund</a>-&gt;<a class="code hl_function" href="classWTSPortFundInfo.html#ae1618a5871a2fedb5e24c1ef435c5c8e">fundInfo</a>();</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span> </div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>    <span class="comment">// 如果当前持仓和目标仓位方向一致，则增加一条明细，增加数量即可</span></div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(pInfo-&gt;_volume*diff, 0))</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>    {</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>        pInfo-&gt;_volume = qty;</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span> </div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>        <a class="code hl_struct" href="structWtEngine_1_1__DetailInfo.html">DetailInfo</a> dInfo;</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>        dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a> = <a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(qty, 0);</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>        dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">_price</a> = curPx;</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>        dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a> = abs(diff);</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>        dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a4bb172995fd3cbb4a852123ef14b9eb3">_opentime</a> = curTm;</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>        dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#af014064a77bdaa2adf7c0950e3a552d7">_opentdate</a> = curTDate;</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>        pInfo-&gt;_details.emplace_back(dInfo);</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span> </div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>        <span class="keywordtype">double</span> fee = commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#afe6547adfa89e66b5b57e20ef07706a5">calcFee</a>(curPx, abs(qty), 0);</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_fees</a> += fee;</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>        fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> -= fee;</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span> </div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>        <a class="code hl_function" href="classWtEngine.html#a6085176597fb79d563ad3f687591279f">log_trade</a>(stdCode, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a>, <span class="keyword">true</span>, curTm, curPx, abs(diff), fee);</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>    }</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>    {<span class="comment">//持仓方向和目标仓位方向不一致, 需要平仓</span></div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>        <span class="keywordtype">double</span> left = abs(diff);</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span> </div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>        pInfo-&gt;_volume = qty;</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(pInfo-&gt;_volume, 0))</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>            pInfo-&gt;_dynprofit = 0;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>        uint32_t count = 0;</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pInfo-&gt;_details.begin(); it != pInfo-&gt;_details.end(); it++)</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        {</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>            <a class="code hl_struct" href="structWtEngine_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo = *it;</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a>, 0))</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>            {</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>                count++;</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>            }</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span> </div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>            <span class="keywordtype">double</span> maxQty = min(dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a>, left);</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(maxQty, 0))</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span> </div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>            dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a> -= maxQty;</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>            left -= maxQty;</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span> </div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>            <span class="comment">//if (dInfo._volume == 0)</span></div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a>, 0))</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>                count++;</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span> </div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>            <span class="keywordtype">double</span> profit = (curPx - dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">_price</a>) * maxQty * commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">getVolScale</a>();</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>            <span class="keywordflow">if</span> (!dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a>)</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>                profit *= -1;</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>            pInfo-&gt;_closeprofit += profit;</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>            pInfo-&gt;_dynprofit = pInfo-&gt;_dynprofit*dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a> / (dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a> + maxQty);<span class="comment">//浮盈也要做等比缩放</span></div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a90def687e499e865a61b42e8b3d43794">_profit</a> += profit;</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> += profit;</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span> </div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>            <span class="keywordtype">double</span> fee = commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#afe6547adfa89e66b5b57e20ef07706a5">calcFee</a>(curPx, maxQty, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#af014064a77bdaa2adf7c0950e3a552d7">_opentdate</a> == curTDate ? 2 : 1);</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_fees</a> += fee;</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> -= fee;</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span> </div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>            <span class="comment">//这里写成交记录</span></div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>            <a class="code hl_function" href="classWtEngine.html#a6085176597fb79d563ad3f687591279f">log_trade</a>(stdCode, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a>, <span class="keyword">false</span>, curTm, curPx, maxQty, fee);</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>            <span class="comment">//这里写平仓记录</span></div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>            <a class="code hl_function" href="classWtEngine.html#a03ffb0f844d21afde748ff9ef8b41f47">log_close</a>(stdCode, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a4bb172995fd3cbb4a852123ef14b9eb3">_opentime</a>, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">_price</a>, curTm, curPx, maxQty, profit, pInfo-&gt;_closeprofit);</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span> </div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>            <span class="keywordflow">if</span> (left == 0)</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>        }</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span> </div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>        <span class="comment">//需要清理掉已经平仓完的明细</span></div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>        <span class="keywordflow">while</span> (count &gt; 0)</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>        {</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>            <span class="keyword">auto</span> it = pInfo-&gt;_details.begin();</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>            pInfo-&gt;_details.erase(it);</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>            count--;</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>        }</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span> </div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>        <span class="comment">//最后, 如果还有剩余的, 则需要反手了</span></div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>        <span class="comment">//if (left &gt; 0)</span></div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>        <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(left, 0))</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>        {</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>            left = left * qty / abs(qty);</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span> </div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>            <a class="code hl_struct" href="structWtEngine_1_1__DetailInfo.html">DetailInfo</a> dInfo;</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>            dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a> = qty &gt; 0;</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>            dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">_price</a> = curPx;</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>            dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">_volume</a> = abs(left);</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>            dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a4bb172995fd3cbb4a852123ef14b9eb3">_opentime</a> = curTm;</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>            dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#af014064a77bdaa2adf7c0950e3a552d7">_opentdate</a> = curTDate;</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>            pInfo-&gt;_details.emplace_back(dInfo);</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span> </div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>            <span class="comment">//这里还需要写一笔成交记录</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>            <span class="keywordtype">double</span> fee = commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#afe6547adfa89e66b5b57e20ef07706a5">calcFee</a>(curPx, abs(qty), 0);</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_fees</a> += fee;</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>            fundInfo.<a class="code hl_variable" href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_balance</a> -= fee;</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span> </div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>            <a class="code hl_function" href="classWtEngine.html#a6085176597fb79d563ad3f687591279f">log_trade</a>(stdCode, dInfo.<a class="code hl_variable" href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">_long</a>, <span class="keyword">true</span>, curTm, curPx, abs(left), fee);</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>        }</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>    }</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>}</div>
</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span> </div>
<div class="foldopen" id="foldopen01689" data-start="{" data-end="}">
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"><a class="line" href="classWtEngine.html#a578422f505b1a6270edfc91bbf3db0ee"> 1689</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a578422f505b1a6270edfc91bbf3db0ee">WtEngine::push_task</a>(<a class="code hl_typedef" href="WtEngine_8h.html#a2737a35c87dcf993424860e0e43719fb">TaskItem</a> task)</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>{</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>    {</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>        <span class="comment">// 加锁保护任务队列</span></div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>        <a class="code hl_typedef" href="group__MutexUtils.html#ga20a94e05f8d16ed0be0999b2b4b5ea2f">StdUniqueLock</a> lock(<a class="code hl_variable" href="classWtEngine.html#ada1664ec0b95fb612ae86054190e6f24">_mtx_task</a>);</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>        <span class="comment">// 将任务添加到队列中</span></div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>        <a class="code hl_variable" href="classWtEngine.html#a11261379454fc23df1db62a0197b1032">_task_queue</a>.push(task);</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>    }</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>    </div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span> </div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>    <span class="comment">// 如果后台任务线程还没有创建，则创建一个</span></div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classWtEngine.html#a16b30134700726e86c856c812e1dd575">_thrd_task</a> == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>    {</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>        <a class="code hl_variable" href="classWtEngine.html#a16b30134700726e86c856c812e1dd575">_thrd_task</a>.reset(<span class="keyword">new</span> <a class="code hl_typedef" href="group__ThreadUtils.html#gad58209190954450c6ef8c8d66f422e61">StdThread</a>([<span class="keyword">this</span>]{</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>            <a class="code hl_function" href="classWtEngine.html#a29b7b633cc31100cd806a8245a70f6d0">task_loop</a>();</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>        }));</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>    }</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span> </div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    <span class="comment">// 通知所有等待任务的线程</span></div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>    <a class="code hl_variable" href="classWtEngine.html#afa0b0ffb6985e4ee2ec2b41cec41828c">_cond_task</a>.notify_all();</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>}</div>
</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span> </div>
<div class="foldopen" id="foldopen01716" data-start="{" data-end="}">
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"><a class="line" href="classWtEngine.html#a29b7b633cc31100cd806a8245a70f6d0"> 1716</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a29b7b633cc31100cd806a8245a70f6d0">WtEngine::task_loop</a>()</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>{</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>    <span class="comment">// 循环处理，直到终止信号被设置</span></div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>    <span class="keywordflow">while</span> (!<a class="code hl_variable" href="classWtEngine.html#afd182b1e34e048312c8e1838d4e63a5c">_terminated</a>)</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>    {</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>        <a class="code hl_typedef" href="classWtEngine.html#a4f642b7373570d14722e1660f006324c">TaskQueue</a> temp;</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>        {</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>            <span class="comment">// 加锁保护任务队列</span></div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>            <a class="code hl_typedef" href="group__MutexUtils.html#ga20a94e05f8d16ed0be0999b2b4b5ea2f">StdUniqueLock</a> lock(<a class="code hl_variable" href="classWtEngine.html#ada1664ec0b95fb612ae86054190e6f24">_mtx_task</a>);</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>            <span class="comment">// 如果任务队列为空，则等待条件变量通知</span></div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>            <span class="keywordflow">if</span>(<a class="code hl_variable" href="classWtEngine.html#a11261379454fc23df1db62a0197b1032">_task_queue</a>.empty())</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>            {</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>                <a class="code hl_variable" href="classWtEngine.html#afa0b0ffb6985e4ee2ec2b41cec41828c">_cond_task</a>.wait(<a class="code hl_variable" href="classWtEngine.html#ada1664ec0b95fb612ae86054190e6f24">_mtx_task</a>);</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>            }</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span> </div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>            <span class="comment">// 交换任务队列，将当前队列中的所有任务移到临时队列中处理</span></div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>            <span class="comment">// 这样可以快速释放锁，不影响其他线程添加新任务</span></div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>            temp.swap(<a class="code hl_variable" href="classWtEngine.html#a11261379454fc23df1db62a0197b1032">_task_queue</a>);</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>        }</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span> </div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>        <span class="comment">// 处理临时队列中的所有任务</span></div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>        <span class="keywordflow">for</span> (;;)</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>        {</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>            <span class="comment">// 如果临时队列为空，则退出循环</span></div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>            <span class="keywordflow">if</span>(temp.empty())</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span> </div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>            <span class="comment">// 获取并执行队列中的第一个任务</span></div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>            <a class="code hl_typedef" href="WtEngine_8h.html#a2737a35c87dcf993424860e0e43719fb">TaskItem</a>&amp; item = temp.front();</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>            item();  <span class="comment">// 调用函数对象</span></div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>            temp.pop();  <span class="comment">// 从队列中移除已执行的任务</span></div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>        }</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>    }</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>}</div>
</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span> </div>
<div class="foldopen" id="foldopen01760" data-start="{" data-end="}">
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"><a class="line" href="classWtEngine.html#a9759242686c911952bf87cb72f8cc306"> 1760</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classWtEngine.html#a9759242686c911952bf87cb72f8cc306">WtEngine::init_riskmon</a>(<a class="code hl_class" href="classWTSVariant.html">WTSVariant</a>* cfg)</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>{</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>    <span class="comment">// 检查配置是否为空</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>    <span class="keywordflow">if</span> (cfg == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span> </div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>    <span class="comment">// 检查风控模块是否激活</span></div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>    <span class="keywordflow">if</span> (!cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a597bf32bfe71fb040721dc65dc786df6">getBoolean</a>(<span class="stringliteral">&quot;active&quot;</span>))</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span> </div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>    <span class="comment">// 获取风控模块名称，并进行平台适配（添加正确的文件后缀如.dll或.so）</span></div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>    std::string <span class="keyword">module</span> = DLLHelper::wrap_module(cfg-&gt;getCString(&quot;module&quot;));</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>    <span class="comment">//先看工作目录下是否有对应模块</span></div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>    std::string dllpath = <a class="code hl_function" href="classWtHelper.html#ac5e1e8cf33bf4c502aedaf6c6db62ab5">WtHelper::getCWD</a>() + <span class="keyword">module</span>;</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>    <span class="comment">//如果没有,则再看模块目录,即dll同目录下</span></div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classStdFile.html#a65778f7268857f981a2e19acb8379761">StdFile::exists</a>(dllpath.c_str()))</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>        dllpath = <a class="code hl_function" href="classWtHelper.html#af1a7e612c19e279fc8b57066cad0c2f9">WtHelper::getInstDir</a>() + <span class="keyword">module</span>;</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span> </div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>    <span class="comment">// 加载风控模块动态库</span></div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>    <a class="code hl_typedef" href="DLLHelper_8hpp.html#a40972742af38c16d3ab2f521abf0ca8a">DllHandle</a> hInst = <a class="code hl_function" href="classDLLHelper.html#ac5d55450ea114206242d9ccbfd65ac82">DLLHelper::load_library</a>(dllpath.c_str());</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>    <span class="keywordflow">if</span> (hInst == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>    {</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>        <span class="comment">// 如果加载失败，记录错误日志</span></div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>        <a class="code hl_function" href="classWTSLogger.html#a50df3d38d311e4792f52f0a7b0fa205e">WTSLogger::log_by_cat</a>(<span class="stringliteral">&quot;risk&quot;</span>, <a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba50717458baf49c204bb0645418e0da15">LL_ERROR</a>, <span class="stringliteral">&quot;Riskmon module {} loading failed&quot;</span>, dllpath.c_str());</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>    }</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span> </div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>    <span class="comment">// 获取风控工厂创建函数</span></div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>    <a class="code hl_typedef" href="RiskMonDefs_8h.html#a6a11dd5cf65f3da85a609d38b2176476">FuncCreateRiskMonFact</a> creator = (<a class="code hl_typedef" href="RiskMonDefs_8h.html#a6a11dd5cf65f3da85a609d38b2176476">FuncCreateRiskMonFact</a>)<a class="code hl_function" href="classDLLHelper.html#ae01c3a299dd418d0298d29fa5f5f9b2c">DLLHelper::get_symbol</a>(hInst, <span class="stringliteral">&quot;createRiskMonFact&quot;</span>);</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>    <span class="keywordflow">if</span> (creator == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>    {</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>        <span class="comment">// 如果获取失败，释放动态库并记录错误日志</span></div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>        <a class="code hl_function" href="classDLLHelper.html#adbde89a530ae734c57506bf9639ccc65">DLLHelper::free_library</a>(hInst);</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>        <a class="code hl_function" href="classWTSLogger.html#a50df3d38d311e4792f52f0a7b0fa205e">WTSLogger::log_by_cat</a>(<span class="stringliteral">&quot;risk&quot;</span>, <a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba50717458baf49c204bb0645418e0da15">LL_ERROR</a>, <span class="stringliteral">&quot;Riskmon module {} is not compatible&quot;</span>, module.c_str());</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>    }</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span> </div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>    <span class="comment">// 设置风控工厂相关信息</span></div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>    <a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#a0e5379c2785570ff52da7b09f6c93778">_module_inst</a> = hInst;  <span class="comment">// 动态库句柄</span></div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>    <a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#a89cc876e8037797912c7272d0fe2f20c">_module_path</a> = <span class="keyword">module</span>;  <span class="comment">// 模块路径</span></div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>    <a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#afd68dc1a855b31894f68ca2210a5678e">_creator</a> = creator;     <span class="comment">// 创建函数</span></div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>    <span class="comment">// 获取风控工厂删除函数</span></div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>    <a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#ae2013754599ebdb8ce875a2f271145af">_remover</a> = (<a class="code hl_typedef" href="RiskMonDefs_8h.html#a7e46e4d0d7c281cd57c9b46ebef9994f">FuncDeleteRiskMonFact</a>)<a class="code hl_function" href="classDLLHelper.html#ae01c3a299dd418d0298d29fa5f5f9b2c">DLLHelper::get_symbol</a>(hInst, <span class="stringliteral">&quot;deleteRiskMonFact&quot;</span>);</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>    <span class="comment">// 创建风控工厂实例</span></div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>    <a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#a4619a924c5d6528fc343f3a8f43ab395">_fact</a> = <a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#afd68dc1a855b31894f68ca2210a5678e">_creator</a>();</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span> </div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>    <span class="comment">// 获取风控器名称</span></div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* name = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a830db11fc8daceff409fdbebaa7bea8a">getCString</a>(<span class="stringliteral">&quot;name&quot;</span>);</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>    </div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>    <span class="comment">// 创建风控器包装器，包含风控器实例和对应的工厂</span></div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>    <a class="code hl_variable" href="classWtEngine.html#ae86eeb05290fcd43d8e2176c230c9e23">_risk_mon</a>.reset(<span class="keyword">new</span> <a class="code hl_class" href="classWtRiskMonWrapper.html">WtRiskMonWrapper</a>(<a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#a4619a924c5d6528fc343f3a8f43ab395">_fact</a>-&gt;<a class="code hl_function" href="classIRiskMonitorFact.html#a01d7cc2875a1934b5f972c4ce70bb65a">createRiskMonotor</a>(name), <a class="code hl_variable" href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">_risk_fact</a>.<a class="code hl_variable" href="structWtEngine_1_1__RiskMonFactInfo.html#a4619a924c5d6528fc343f3a8f43ab395">_fact</a>));</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>    <span class="comment">// 初始化风控器，传入引擎实例和配置</span></div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>    <a class="code hl_variable" href="classWtEngine.html#ae86eeb05290fcd43d8e2176c230c9e23">_risk_mon</a>-&gt;self()-&gt;init(<span class="keyword">this</span>, cfg);</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span> </div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>}</div>
</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span> </div>
<div class="foldopen" id="foldopen01822" data-start="{" data-end="}">
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"><a class="line" href="classWtEngine.html#a78e78faf98d93a32c6b0bee6f81edb7b"> 1822</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a78e78faf98d93a32c6b0bee6f81edb7b">WtEngine::init_outputs</a>()</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>{</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>    <span class="comment">// 获取组合目录</span></div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>    std::string folder = <a class="code hl_function" href="classWtHelper.html#abb1e5b65775cc630a9fcabe71a3da098">WtHelper::getPortifolioDir</a>();</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>    </div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>    <span class="comment">// 初始化交易日志文件</span></div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>    std::string filename = folder + <span class="stringliteral">&quot;trades.csv&quot;</span>;</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>    <a class="code hl_variable" href="classWtEngine.html#abb0c5dc7eed14e13a7a7464d3cc6e3ae">_trade_logs</a>.reset(<span class="keyword">new</span> <a class="code hl_class" href="classBoostFile.html">BoostFile</a>());</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>    {</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>        <span class="comment">// 检查文件是否存在</span></div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>        <span class="keywordtype">bool</span> isNewFile = !<a class="code hl_function" href="classBoostFile.html#aab642b9bcdfa02c81c2530110eb8a61e">BoostFile::exists</a>(filename.c_str());</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>        <span class="comment">// 创建或打开文件</span></div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>        <a class="code hl_variable" href="classWtEngine.html#abb0c5dc7eed14e13a7a7464d3cc6e3ae">_trade_logs</a>-&gt;create_or_open_file(filename.c_str());</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>        <span class="keywordflow">if</span> (isNewFile)</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>        {</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>            <span class="comment">// 如果是新文件，则写入CSV列头</span></div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>            <a class="code hl_variable" href="classWtEngine.html#abb0c5dc7eed14e13a7a7464d3cc6e3ae">_trade_logs</a>-&gt;write_file(<span class="stringliteral">&quot;code,time,direct,action,price,qty,fee\n&quot;</span>);</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>        }</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>        {</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>            <span class="comment">// 如果是已存在的文件，则定位到文件末尾准备追加</span></div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>            <a class="code hl_variable" href="classWtEngine.html#abb0c5dc7eed14e13a7a7464d3cc6e3ae">_trade_logs</a>-&gt;seek_to_end();</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>        }</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>    }</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span> </div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>    <span class="comment">// 初始化平仓日志文件</span></div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>    filename = folder + <span class="stringliteral">&quot;closes.csv&quot;</span>;</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>    <a class="code hl_variable" href="classWtEngine.html#a3de152e1623d0496f2ce3bc01882cb68">_close_logs</a>.reset(<span class="keyword">new</span> <a class="code hl_class" href="classBoostFile.html">BoostFile</a>());</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>    {</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>        <span class="comment">// 检查文件是否存在</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>        <span class="keywordtype">bool</span> isNewFile = !<a class="code hl_function" href="classBoostFile.html#aab642b9bcdfa02c81c2530110eb8a61e">BoostFile::exists</a>(filename.c_str());</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>        <span class="comment">// 创建或打开文件</span></div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>        <a class="code hl_variable" href="classWtEngine.html#a3de152e1623d0496f2ce3bc01882cb68">_close_logs</a>-&gt;create_or_open_file(filename.c_str());</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>        <span class="keywordflow">if</span> (isNewFile)</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>        {</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>            <span class="comment">// 如果是新文件，则写入CSV列头</span></div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>            <a class="code hl_variable" href="classWtEngine.html#a3de152e1623d0496f2ce3bc01882cb68">_close_logs</a>-&gt;write_file(<span class="stringliteral">&quot;code,direct,opentime,openprice,closetime,closeprice,qty,profit,totalprofit\n&quot;</span>);</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>        }</div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>        {</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>            <span class="comment">// 如果是已存在的文件，则定位到文件末尾准备追加</span></div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>            <a class="code hl_variable" href="classWtEngine.html#a3de152e1623d0496f2ce3bc01882cb68">_close_logs</a>-&gt;seek_to_end();</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>        }</div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>    }</div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>}</div>
</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span> </div>
<div class="foldopen" id="foldopen01880" data-start="{" data-end="}">
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"><a class="line" href="classWtEngine.html#a6085176597fb79d563ad3f687591279f"> 1880</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a6085176597fb79d563ad3f687591279f">WtEngine::log_trade</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> isLong, <span class="keywordtype">bool</span> isOpen, uint64_t curTime, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">double</span> fee <span class="comment">/* = 0.0 */</span>)</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span>{</div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classWtEngine.html#abb0c5dc7eed14e13a7a7464d3cc6e3ae">_trade_logs</a>)</div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>    {</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>        std::stringstream ss;</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>        ss &lt;&lt; stdCode &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; curTime &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; (isLong ? <span class="stringliteral">&quot;LONG&quot;</span> : <span class="stringliteral">&quot;SHORT&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; (isOpen ? <span class="stringliteral">&quot;OPEN&quot;</span> : <span class="stringliteral">&quot;CLOSE&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; qty &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fee &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>        <a class="code hl_variable" href="classWtEngine.html#abb0c5dc7eed14e13a7a7464d3cc6e3ae">_trade_logs</a>-&gt;write_file(ss.str());</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>    }</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>}</div>
</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span> </div>
<div class="foldopen" id="foldopen01904" data-start="{" data-end="}">
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"><a class="line" href="classWtEngine.html#a03ffb0f844d21afde748ff9ef8b41f47"> 1904</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classWtEngine.html#a03ffb0f844d21afde748ff9ef8b41f47">WtEngine::log_close</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> isLong, uint64_t openTime, <span class="keywordtype">double</span> openpx, uint64_t closeTime, <span class="keywordtype">double</span> closepx, <span class="keywordtype">double</span> qty, <span class="keywordtype">double</span> profit, <span class="keywordtype">double</span> totalprofit <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span>{</div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classWtEngine.html#a3de152e1623d0496f2ce3bc01882cb68">_close_logs</a>)</div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span>    {</div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>        std::stringstream ss;</div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span>        ss &lt;&lt; stdCode &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; (isLong ? <span class="stringliteral">&quot;LONG&quot;</span> : <span class="stringliteral">&quot;SHORT&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; openTime &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; openpx</div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span>            &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; closeTime &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; closepx &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; qty &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; profit &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>            &lt;&lt; totalprofit &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span>        <a class="code hl_variable" href="classWtEngine.html#a3de152e1623d0496f2ce3bc01882cb68">_close_logs</a>-&gt;write_file(ss.str());</div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span>    }</div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span>}</div>
</div>
<div class="ttc" id="aBoostFile_8hpp_html_a596e60eb12117122d44c36f261d58a04"><div class="ttname"><a href="BoostFile_8hpp.html#a596e60eb12117122d44c36f261d58a04">BoostFilePtr</a></div><div class="ttdeci">boost::shared_ptr&lt; BoostFile &gt; BoostFilePtr</div><div class="ttdoc">BoostFile类的智能指针类型</div><div class="ttdef"><b>Definition</b> <a href="BoostFile_8hpp_source.html#l00559">BoostFile.hpp:559</a></div></div>
<div class="ttc" id="aCodeHelper_8hpp_html_a57589d4ee5ee7b3d186d8e3c6436bce7"><div class="ttname"><a href="CodeHelper_8hpp.html#a57589d4ee5ee7b3d186d8e3c6436bce7">SUFFIX_HFQ</a></div><div class="ttdeci">static const char SUFFIX_HFQ</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00031">CodeHelper.hpp:31</a></div></div>
<div class="ttc" id="aCodeHelper_8hpp_html_aa013c59ce217dc9abf54b9ca3f82da03"><div class="ttname"><a href="CodeHelper_8hpp.html#aa013c59ce217dc9abf54b9ca3f82da03">SUFFIX_QFQ</a></div><div class="ttdeci">static const char SUFFIX_QFQ</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00028">CodeHelper.hpp:28</a></div></div>
<div class="ttc" id="aDLLHelper_8hpp_html_a40972742af38c16d3ab2f521abf0ca8a"><div class="ttname"><a href="DLLHelper_8hpp.html#a40972742af38c16d3ab2f521abf0ca8a">DllHandle</a></div><div class="ttdeci">void * DllHandle</div><div class="ttdoc">动态库句柄类型（非Windows平台）</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00032">DLLHelper.hpp:32</a></div></div>
<div class="ttc" id="aRiskMonDefs_8h_html_a6a11dd5cf65f3da85a609d38b2176476"><div class="ttname"><a href="RiskMonDefs_8h.html#a6a11dd5cf65f3da85a609d38b2176476">FuncCreateRiskMonFact</a></div><div class="ttdeci">IRiskMonitorFact *(* FuncCreateRiskMonFact)()</div><div class="ttdef"><b>Definition</b> <a href="RiskMonDefs_8h_source.html#l00155">RiskMonDefs.h:155</a></div></div>
<div class="ttc" id="aRiskMonDefs_8h_html_a7e46e4d0d7c281cd57c9b46ebef9994f"><div class="ttname"><a href="RiskMonDefs_8h.html#a7e46e4d0d7c281cd57c9b46ebef9994f">FuncDeleteRiskMonFact</a></div><div class="ttdeci">void(* FuncDeleteRiskMonFact)(IRiskMonitorFact *&amp;fact)</div><div class="ttdef"><b>Definition</b> <a href="RiskMonDefs_8h_source.html#l00157">RiskMonDefs.h:157</a></div></div>
<div class="ttc" id="aStrUtil_8hpp_html_ab8e1ede88e2ff1c3b448334e6cbd3533"><div class="ttname"><a href="StrUtil_8hpp.html#ab8e1ede88e2ff1c3b448334e6cbd3533">StringVector</a></div><div class="ttdeci">std::vector&lt; std::string &gt; StringVector</div><div class="ttdoc">字符串数组类型</div><div class="ttdef"><b>Definition</b> <a href="StrUtil_8hpp_source.html#l00028">StrUtil.hpp:28</a></div></div>
<div class="ttc" id="aWTSMarcos_8h_html_ae3e2cd00c20ce8b9ae0ae37a089d7d5e"><div class="ttname"><a href="WTSMarcos_8h.html#ae3e2cd00c20ce8b9ae0ae37a089d7d5e">wt_strcpy</a></div><div class="ttdeci">size_t wt_strcpy(char *des, const char *src, size_t len=0)</div><div class="ttdoc">字符串拷贝函数</div><div class="ttdef"><b>Definition</b> <a href="WTSMarcos_8h_source.html#l00155">WTSMarcos.h:155</a></div></div>
<div class="ttc" id="aWTSMarcos_8h_html_af78670ee54c1203d613f8fb0e022d214"><div class="ttname"><a href="WTSMarcos_8h.html#af78670ee54c1203d613f8fb0e022d214">DBL_MAX</a></div><div class="ttdeci">#define DBL_MAX</div><div class="ttdef"><b>Definition</b> <a href="WTSMarcos_8h_source.html#l00045">WTSMarcos.h:45</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_a27f5d8bd7208a5fc1d044c6f5961904c"><div class="ttname"><a href="WTSTypes_8h.html#a27f5d8bd7208a5fc1d044c6f5961904c">WTSKlinePeriod</a></div><div class="ttdeci">enum tagKlinePeriod WTSKlinePeriod</div></div>
<div class="ttc" id="aWTSTypes_8h_html_acac96eb977d20b3a6186f0ccede8a9d8a048058b5939234978e278291866f6cd2"><div class="ttname"><a href="WTSTypes_8h.html#acac96eb977d20b3a6186f0ccede8a9d8a048058b5939234978e278291866f6cd2">KP_DAY</a></div><div class="ttdeci">@ KP_DAY</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00107">WTSTypes.h:107</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_acac96eb977d20b3a6186f0ccede8a9d8a3b64a9f21f4bd5432a8b3f8424c4410e"><div class="ttname"><a href="WTSTypes_8h.html#acac96eb977d20b3a6186f0ccede8a9d8a3b64a9f21f4bd5432a8b3f8424c4410e">KP_Minute1</a></div><div class="ttdeci">@ KP_Minute1</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00105">WTSTypes.h:105</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_acac96eb977d20b3a6186f0ccede8a9d8adcd66f71c090964efdc8474bca5b9209"><div class="ttname"><a href="WTSTypes_8h.html#acac96eb977d20b3a6186f0ccede8a9d8adcd66f71c090964efdc8474bca5b9209">KP_Minute5</a></div><div class="ttdeci">@ KP_Minute5</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00106">WTSTypes.h:106</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_aed5503152b508c68a90229e513a8e15ba3d0aabc1a000a1668922ab44aeca5771"><div class="ttname"><a href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba3d0aabc1a000a1668922ab44aeca5771">LL_INFO</a></div><div class="ttdeci">@ LL_INFO</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00129">WTSTypes.h:129</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_aed5503152b508c68a90229e513a8e15ba50717458baf49c204bb0645418e0da15"><div class="ttname"><a href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba50717458baf49c204bb0645418e0da15">LL_ERROR</a></div><div class="ttdeci">@ LL_ERROR</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00131">WTSTypes.h:131</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_aed5503152b508c68a90229e513a8e15ba7413c537cbbee6447b4d2a2fd90bd1c9"><div class="ttname"><a href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba7413c537cbbee6447b4d2a2fd90bd1c9">LL_WARN</a></div><div class="ttdeci">@ LL_WARN</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00130">WTSTypes.h:130</a></div></div>
<div class="ttc" id="aWtDtMgr_8h_html"><div class="ttname"><a href="WtDtMgr_8h.html">WtDtMgr.h</a></div></div>
<div class="ttc" id="aWtEngine_8cpp_html_a17226795848decb565e90624584e5c0f"><div class="ttname"><a href="WtEngine_8cpp.html#a17226795848decb565e90624584e5c0f">USING_NS_WTP</a></div><div class="ttdeci">USING_NS_WTP</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00041">WtEngine.cpp:41</a></div></div>
<div class="ttc" id="aWtEngine_8h_html"><div class="ttname"><a href="WtEngine_8h.html">WtEngine.h</a></div><div class="ttdoc">WonderTrader核心交易引擎类头文件。</div></div>
<div class="ttc" id="aWtEngine_8h_html_a2737a35c87dcf993424860e0e43719fb"><div class="ttname"><a href="WtEngine_8h.html#a2737a35c87dcf993424860e0e43719fb">TaskItem</a></div><div class="ttdeci">std::function&lt; void()&gt; TaskItem</div><div class="ttdoc">任务项类型定义</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00113">WtEngine.h:113</a></div></div>
<div class="ttc" id="aWtUftCore_2WtHelper_8h_html"><div class="ttname"><a href="WtUftCore_2WtHelper_8h.html">WtHelper.h</a></div><div class="ttdoc">WonderTrader辅助工具类头文件</div></div>
<div class="ttc" id="aclassBoostFile_html"><div class="ttname"><a href="classBoostFile.html">BoostFile</a></div><div class="ttdoc">boost库文件操作的封装类</div><div class="ttdef"><b>Definition</b> <a href="BoostFile_8hpp_source.html#l00044">BoostFile.hpp:45</a></div></div>
<div class="ttc" id="aclassBoostFile_html_a5481db505f5c5d99c9aa9ba36806bff0"><div class="ttname"><a href="classBoostFile.html#a5481db505f5c5d99c9aa9ba36806bff0">BoostFile::close_file</a></div><div class="ttdeci">void close_file()</div><div class="ttdoc">关闭文件</div><div class="ttdef"><b>Definition</b> <a href="BoostFile_8hpp_source.html#l00162">BoostFile.hpp:162</a></div></div>
<div class="ttc" id="aclassBoostFile_html_a5eab32a7044d5e65fb18aca7fd90b864"><div class="ttname"><a href="classBoostFile.html#a5eab32a7044d5e65fb18aca7fd90b864">BoostFile::create_new_file</a></div><div class="ttdeci">bool create_new_file(const char *name, boost::interprocess::mode_t mode=boost::interprocess::read_write, bool temporary=false)</div><div class="ttdoc">创建新文件</div><div class="ttdef"><b>Definition</b> <a href="BoostFile_8hpp_source.html#l00080">BoostFile.hpp:80</a></div></div>
<div class="ttc" id="aclassBoostFile_html_aab642b9bcdfa02c81c2530110eb8a61e"><div class="ttname"><a href="classBoostFile.html#aab642b9bcdfa02c81c2530110eb8a61e">BoostFile::exists</a></div><div class="ttdeci">static bool exists(const char *name)</div><div class="ttdoc">检查文件或目录是否存在（静态方法）</div><div class="ttdef"><b>Definition</b> <a href="BoostFile_8hpp_source.html#l00546">BoostFile.hpp:546</a></div></div>
<div class="ttc" id="aclassBoostFile_html_aca29c4c4ed11acc16411e3fcc986f6e3"><div class="ttname"><a href="classBoostFile.html#aca29c4c4ed11acc16411e3fcc986f6e3">BoostFile::write_file</a></div><div class="ttdeci">bool write_file(const void *data, std::size_t numdata)</div><div class="ttdoc">写入数据到文件</div><div class="ttdef"><b>Definition</b> <a href="BoostFile_8hpp_source.html#l00350">BoostFile.hpp:350</a></div></div>
<div class="ttc" id="aclassCodeHelper_html_a2426a3a2c8623ebb0e47274dd2c5a83d"><div class="ttname"><a href="classCodeHelper.html#a2426a3a2c8623ebb0e47274dd2c5a83d">CodeHelper::extractStdCode</a></div><div class="ttdeci">static CodeInfo extractStdCode(const char *stdCode, IHotMgr *hotMgr)</div><div class="ttdoc">从标准代码中提取合约信息</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00646">CodeHelper.hpp:646</a></div></div>
<div class="ttc" id="aclassCodeHelper_html_ad05f109a3cdaca9068d19d41fc288643"><div class="ttname"><a href="classCodeHelper.html#ad05f109a3cdaca9068d19d41fc288643">CodeHelper::rawMonthCodeToStdCode</a></div><div class="ttdeci">static std::string rawMonthCodeToStdCode(const char *code, const char *exchg, bool isComm=false)</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00280">CodeHelper.hpp:280</a></div></div>
<div class="ttc" id="aclassDLLHelper_html_ac5d55450ea114206242d9ccbfd65ac82"><div class="ttname"><a href="classDLLHelper.html#ac5d55450ea114206242d9ccbfd65ac82">DLLHelper::load_library</a></div><div class="ttdeci">static DllHandle load_library(const char *filename)</div><div class="ttdoc">加载动态库</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00058">DLLHelper.hpp:58</a></div></div>
<div class="ttc" id="aclassDLLHelper_html_adbde89a530ae734c57506bf9639ccc65"><div class="ttname"><a href="classDLLHelper.html#adbde89a530ae734c57506bf9639ccc65">DLLHelper::free_library</a></div><div class="ttdeci">static void free_library(DllHandle handle)</div><div class="ttdoc">释放动态库</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00085">DLLHelper.hpp:85</a></div></div>
<div class="ttc" id="aclassDLLHelper_html_ae01c3a299dd418d0298d29fa5f5f9b2c"><div class="ttname"><a href="classDLLHelper.html#ae01c3a299dd418d0298d29fa5f5f9b2c">DLLHelper::get_symbol</a></div><div class="ttdeci">static ProcHandle get_symbol(DllHandle handle, const char *name)</div><div class="ttdoc">获取动态库中的符号（函数或变量）</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00107">DLLHelper.hpp:107</a></div></div>
<div class="ttc" id="aclassEventNotifier_html"><div class="ttname"><a href="classEventNotifier.html">EventNotifier</a></div><div class="ttdoc">事件通知器类，用于回测过程中的事件、数据和资金信息广播</div><div class="ttdef"><b>Definition</b> <a href="WtBtCore_2EventNotifier_8h_source.html#l00063">EventNotifier.h:64</a></div></div>
<div class="ttc" id="aclassIBaseDataMgr_html"><div class="ttname"><a href="classIBaseDataMgr.html">IBaseDataMgr</a></div><div class="ttdoc">基础数据管理器接口</div><div class="ttdef"><b>Definition</b> <a href="IBaseDataMgr_8h_source.html#l00075">IBaseDataMgr.h:76</a></div></div>
<div class="ttc" id="aclassIBaseDataMgr_html_a435a180d8497a49cd6468fd34579b7ff"><div class="ttname"><a href="classIBaseDataMgr.html#a435a180d8497a49cd6468fd34579b7ff">IBaseDataMgr::getCommodity</a></div><div class="ttdeci">virtual WTSCommodityInfo * getCommodity(const char *exchgpid)=0</div><div class="ttdoc">获取品种信息</div></div>
<div class="ttc" id="aclassIBaseDataMgr_html_a4c98c31963a32a6c91e0df4316f06ad7"><div class="ttname"><a href="classIBaseDataMgr.html#a4c98c31963a32a6c91e0df4316f06ad7">IBaseDataMgr::getSession</a></div><div class="ttdeci">virtual WTSSessionInfo * getSession(const char *sid)=0</div><div class="ttdoc">获取交易时段信息</div></div>
<div class="ttc" id="aclassIBaseDataMgr_html_a7902cf7c19636ee381ba9fa7a6e3f065"><div class="ttname"><a href="classIBaseDataMgr.html#a7902cf7c19636ee381ba9fa7a6e3f065">IBaseDataMgr::getContract</a></div><div class="ttdeci">virtual WTSContractInfo * getContract(const char *code, const char *exchg=&quot;&quot;, uint32_t uDate=0)=0</div><div class="ttdoc">获取合约信息</div></div>
<div class="ttc" id="aclassIHotMgr_html"><div class="ttname"><a href="classIHotMgr.html">IHotMgr</a></div><div class="ttdoc">主力合约管理器接口</div><div class="ttdef"><b>Definition</b> <a href="IHotMgr_8h_source.html#l00066">IHotMgr.h:67</a></div></div>
<div class="ttc" id="aclassIHotMgr_html_a0eeb3b1944544abdcd6bcbfccadfc356"><div class="ttname"><a href="classIHotMgr.html#a0eeb3b1944544abdcd6bcbfccadfc356">IHotMgr::getCustomRawCode</a></div><div class="ttdeci">virtual const char * getCustomRawCode(const char *tag, const char *fullPid, uint32_t dt=0)=0</div><div class="ttdoc">获取自定义主力合约的分月代码</div></div>
<div class="ttc" id="aclassIHotMgr_html_aca821cad1dccf944e7afa850fb848e30"><div class="ttname"><a href="classIHotMgr.html#aca821cad1dccf944e7afa850fb848e30">IHotMgr::getRuleFactor</a></div><div class="ttdeci">virtual double getRuleFactor(const char *ruleTag, const char *fullPid, uint32_t uDate=0)=0</div><div class="ttdoc">获取规则因子</div></div>
<div class="ttc" id="aclassIHotMgr_html_af8bb8076fc8bf44ea9897f7dc418d5f6"><div class="ttname"><a href="classIHotMgr.html#af8bb8076fc8bf44ea9897f7dc418d5f6">IHotMgr::getRuleTag</a></div><div class="ttdeci">virtual const char * getRuleTag(const char *stdCode)=0</div><div class="ttdoc">根据标准合约代码获取规则标签</div></div>
<div class="ttc" id="aclassIRiskMonitorFact_html_a01d7cc2875a1934b5f972c4ce70bb65a"><div class="ttname"><a href="classIRiskMonitorFact.html#a01d7cc2875a1934b5f972c4ce70bb65a">IRiskMonitorFact::createRiskMonotor</a></div><div class="ttdeci">virtual WtRiskMonitor * createRiskMonotor(const char *name)=0</div></div>
<div class="ttc" id="aclassSpinLock_html"><div class="ttname"><a href="classSpinLock.html">SpinLock</a></div><div class="ttdoc">自旋锁的RAII封装</div><div class="ttdef"><b>Definition</b> <a href="SpinMutex_8hpp_source.html#l00090">SpinMutex.hpp:91</a></div></div>
<div class="ttc" id="aclassStdFile_html_a23e935cf0937cc0cd1cd2ee4c3eecb53"><div class="ttname"><a href="classStdFile.html#a23e935cf0937cc0cd1cd2ee4c3eecb53">StdFile::read_file_content</a></div><div class="ttdeci">static uint64_t read_file_content(const char *filename, std::string &amp;content)</div><div class="ttdoc">读取文件内容到字符串</div><div class="ttdef"><b>Definition</b> <a href="StdUtils_8hpp_source.html#l00152">StdUtils.hpp:152</a></div></div>
<div class="ttc" id="aclassStdFile_html_a65778f7268857f981a2e19acb8379761"><div class="ttname"><a href="classStdFile.html#a65778f7268857f981a2e19acb8379761">StdFile::exists</a></div><div class="ttdeci">static bool exists(const char *filename)</div><div class="ttdoc">检查文件是否存在</div><div class="ttdef"><b>Definition</b> <a href="StdUtils_8hpp_source.html#l00221">StdUtils.hpp:221</a></div></div>
<div class="ttc" id="aclassStrUtil_html_ab7f8887aed021ea6dafe93ce1f2b67a0"><div class="ttname"><a href="classStrUtil.html#ab7f8887aed021ea6dafe93ce1f2b67a0">StrUtil::split</a></div><div class="ttdeci">static StringVector split(const std::string &amp;str, const std::string &amp;delims=&quot;\t\n &quot;, unsigned int maxSplits=0)</div><div class="ttdoc">分割字符串为多个字符串并返回字符串数组</div><div class="ttdef"><b>Definition</b> <a href="StrUtil_8hpp_source.html#l00150">StrUtil.hpp:150</a></div></div>
<div class="ttc" id="aclassTimeUtils_html_a48644704dd42fbb708a3e8b88b9611a8"><div class="ttname"><a href="classTimeUtils.html#a48644704dd42fbb708a3e8b88b9611a8">TimeUtils::getLocalTimeNow</a></div><div class="ttdeci">static int64_t getLocalTimeNow(void)</div><div class="ttdoc">获取当前本地时间，精确到毫秒</div><div class="ttdef"><b>Definition</b> <a href="TimeUtils_8hpp_source.html#l00123">TimeUtils.hpp:123</a></div></div>
<div class="ttc" id="aclassTimeUtils_html_ac04a739040d6a0d39400c2a74b96583b"><div class="ttname"><a href="classTimeUtils.html#ac04a739040d6a0d39400c2a74b96583b">TimeUtils::getDateTime</a></div><div class="ttdeci">static void getDateTime(uint32_t &amp;date, uint32_t &amp;time)</div><div class="ttdoc">获取当前日期和时间，分别存储到两个参数中</div><div class="ttdef"><b>Definition</b> <a href="TimeUtils_8hpp_source.html#l00216">TimeUtils.hpp:216</a></div></div>
<div class="ttc" id="aclassWTSCfgLoader_html_a222f42e290bc1aa38b4f67c005e10887"><div class="ttname"><a href="classWTSCfgLoader.html#a222f42e290bc1aa38b4f67c005e10887">WTSCfgLoader::load_from_file</a></div><div class="ttdeci">static WTSVariant * load_from_file(const char *filename)</div><div class="ttdoc">从文件加载配置</div><div class="ttdef"><b>Definition</b> <a href="WTSCfgLoader_8cpp_source.html#l00291">WTSCfgLoader.cpp:291</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html"><div class="ttname"><a href="classWTSCommodityInfo.html">WTSCommodityInfo</a></div><div class="ttdoc">品种信息类</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00020">WTSContractInfo.hpp:21</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_a109c202bf9a0216819d45e676fa029bf"><div class="ttname"><a href="classWTSCommodityInfo.html#a109c202bf9a0216819d45e676fa029bf">WTSCommodityInfo::getFullPid</a></div><div class="ttdeci">const char * getFullPid() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00056">WTSContractInfo.hpp:56</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_a3f74c34d16cd5a0702ee9c1d31681525"><div class="ttname"><a href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">WTSCommodityInfo::getVolScale</a></div><div class="ttdeci">uint32_t getVolScale() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00058">WTSContractInfo.hpp:58</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_a423fe594ac3daf36d22956bc07706f75"><div class="ttname"><a href="classWTSCommodityInfo.html#a423fe594ac3daf36d22956bc07706f75">WTSCommodityInfo::isStock</a></div><div class="ttdeci">bool isStock() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00083">WTSContractInfo.hpp:83</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_a5cd587f6361eda2a9d3d68c58288982f"><div class="ttname"><a href="classWTSCommodityInfo.html#a5cd587f6361eda2a9d3d68c58288982f">WTSCommodityInfo::setFeeRates</a></div><div class="ttdeci">void setFeeRates(double open, double close, double closeToday, bool byVolume)</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00094">WTSContractInfo.hpp:94</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_add2c9d0cd2f7463cb0f60c85cd118fef"><div class="ttname"><a href="classWTSCommodityInfo.html#add2c9d0cd2f7463cb0f60c85cd118fef">WTSCommodityInfo::setMarginRate</a></div><div class="ttdeci">void setMarginRate(double rate)</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00102">WTSContractInfo.hpp:102</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_afaa5c2a84bef03ffe717f244c340fcd2"><div class="ttname"><a href="classWTSCommodityInfo.html#afaa5c2a84bef03ffe717f244c340fcd2">WTSCommodityInfo::getSession</a></div><div class="ttdeci">const char * getSession() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00054">WTSContractInfo.hpp:54</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_afe6547adfa89e66b5b57e20ef07706a5"><div class="ttname"><a href="classWTSCommodityInfo.html#afe6547adfa89e66b5b57e20ef07706a5">WTSCommodityInfo::calcFee</a></div><div class="ttdeci">double calcFee(double price, double qty, uint32_t offset)</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00105">WTSContractInfo.hpp:105</a></div></div>
<div class="ttc" id="aclassWTSContractInfo_html"><div class="ttname"><a href="classWTSContractInfo.html">WTSContractInfo</a></div><div class="ttdoc">合约信息类</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00171">WTSContractInfo.hpp:172</a></div></div>
<div class="ttc" id="aclassWTSContractInfo_html_a0c356989f33d9acf090117960bbfa605"><div class="ttname"><a href="classWTSContractInfo.html#a0c356989f33d9acf090117960bbfa605">WTSContractInfo::getHotCode</a></div><div class="ttdeci">const char * getHotCode() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00299">WTSContractInfo.hpp:299</a></div></div>
<div class="ttc" id="aclassWTSContractInfo_html_a8fa410ebad3ac115725f7c06c0440211"><div class="ttname"><a href="classWTSContractInfo.html#a8fa410ebad3ac115725f7c06c0440211">WTSContractInfo::getCommInfo</a></div><div class="ttdeci">WTSCommodityInfo * getCommInfo() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00249">WTSContractInfo.hpp:249</a></div></div>
<div class="ttc" id="aclassWTSContractInfo_html_af034e65b2bdf76e1737b36759e43ee0c"><div class="ttname"><a href="classWTSContractInfo.html#af034e65b2bdf76e1737b36759e43ee0c">WTSContractInfo::isFlat</a></div><div class="ttdeci">bool isFlat() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00296">WTSContractInfo.hpp:296</a></div></div>
<div class="ttc" id="aclassWTSKlineSlice_html"><div class="ttname"><a href="classWTSKlineSlice.html">WTSKlineSlice</a></div><div class="ttdoc">K线数据切片类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l00295">WTSDataDef.hpp:296</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_a01fb1b92bf14e993751ce211b00e7dd2"><div class="ttname"><a href="classWTSLogger.html#a01fb1b92bf14e993751ce211b00e7dd2">WTSLogger::log_raw_by_cat</a></div><div class="ttdeci">static void log_raw_by_cat(const char *catName, WTSLogLevel ll, const char *message)</div><div class="ttdoc">按分类输出日志消息</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8cpp_source.html#l00446">WTSLogger.cpp:446</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_a147defb6e1fb287cc8d95bfb753f6f11"><div class="ttname"><a href="classWTSLogger.html#a147defb6e1fb287cc8d95bfb753f6f11">WTSLogger::warn</a></div><div class="ttdeci">static void warn(const char *format, const Args &amp;...args)</div><div class="ttdoc">输出警告级别日志</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8h_source.html#l00213">WTSLogger.h:213</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_a20d65255542e3ed5d694b529892a0f57"><div class="ttname"><a href="classWTSLogger.html#a20d65255542e3ed5d694b529892a0f57">WTSLogger::info</a></div><div class="ttdeci">static void info(const char *format, const Args &amp;...args)</div><div class="ttdoc">输出信息级别日志</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8h_source.html#l00187">WTSLogger.h:187</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_a50df3d38d311e4792f52f0a7b0fa205e"><div class="ttname"><a href="classWTSLogger.html#a50df3d38d311e4792f52f0a7b0fa205e">WTSLogger::log_by_cat</a></div><div class="ttdeci">static void log_by_cat(const char *catName, WTSLogLevel ll, const char *format, const Args &amp;...args)</div><div class="ttdoc">使用指定分类和级别输出格式化日志</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8h_source.html#l00314">WTSLogger.h:314</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_a618c41d0ff3c1f5ce0a70d83c28bc9fc"><div class="ttname"><a href="classWTSLogger.html#a618c41d0ff3c1f5ce0a70d83c28bc9fc">WTSLogger::error</a></div><div class="ttdeci">static void error(const char *format, const Args &amp;...args)</div><div class="ttdoc">输出错误级别日志</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8h_source.html#l00239">WTSLogger.h:239</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_aa3257bbd8e5b1db25f65cd936f50025c"><div class="ttname"><a href="classWTSLogger.html#aa3257bbd8e5b1db25f65cd936f50025c">WTSLogger::log_raw</a></div><div class="ttdeci">static void log_raw(WTSLogLevel ll, const char *message)</div><div class="ttdoc">直接输出日志消息</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8cpp_source.html#l00407">WTSLogger.cpp:407</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_adcbb6a78b99a8c514a4b55677e5a1a28"><div class="ttname"><a href="classWTSLogger.html#adcbb6a78b99a8c514a4b55677e5a1a28">WTSLogger::debug</a></div><div class="ttdeci">static void debug(const char *format, const Args &amp;...args)</div><div class="ttdoc">fmt格式化日志接口</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8h_source.html#l00161">WTSLogger.h:161</a></div></div>
<div class="ttc" id="aclassWTSPoolObject_html_a868f127b3ccc31cba6b077803cb00951"><div class="ttname"><a href="classWTSPoolObject.html#a868f127b3ccc31cba6b077803cb00951">WTSPoolObject::release</a></div><div class="ttdeci">virtual void release() override</div><div class="ttdef"><b>Definition</b> <a href="WTSObject_8hpp_source.html#l00092">WTSObject.hpp:92</a></div></div>
<div class="ttc" id="aclassWTSPortFundInfo_html"><div class="ttname"><a href="classWTSPortFundInfo.html">WTSPortFundInfo</a></div><div class="ttdoc">组合资金信息类</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00143">WTSRiskDef.hpp:144</a></div></div>
<div class="ttc" id="aclassWTSPortFundInfo_html_a49573253dde385ccb9fe189a0bef1bad"><div class="ttname"><a href="classWTSPortFundInfo.html#a49573253dde385ccb9fe189a0bef1bad">WTSPortFundInfo::create</a></div><div class="ttdeci">static WTSPortFundInfo * create()</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00149">WTSRiskDef.hpp:149</a></div></div>
<div class="ttc" id="aclassWTSPortFundInfo_html_ae1618a5871a2fedb5e24c1ef435c5c8e"><div class="ttname"><a href="classWTSPortFundInfo.html#ae1618a5871a2fedb5e24c1ef435c5c8e">WTSPortFundInfo::fundInfo</a></div><div class="ttdeci">WTSFundStruct &amp; fundInfo()</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00155">WTSRiskDef.hpp:155</a></div></div>
<div class="ttc" id="aclassWTSSessionInfo_html"><div class="ttname"><a href="classWTSSessionInfo.html">WTSSessionInfo</a></div><div class="ttdoc">会话信息类</div><div class="ttdef"><b>Definition</b> <a href="WTSSessionInfo_8hpp_source.html#l00020">WTSSessionInfo.hpp:21</a></div></div>
<div class="ttc" id="aclassWTSSessionInfo_html_ac80489cf435cb91c5305c201a5a7072c"><div class="ttname"><a href="classWTSSessionInfo.html#ac80489cf435cb91c5305c201a5a7072c">WTSSessionInfo::isInTradingTime</a></div><div class="ttdeci">bool isInTradingTime(uint32_t uTime, bool bStrict=false)</div><div class="ttdef"><b>Definition</b> <a href="WTSSessionInfo_8hpp_source.html#l00441">WTSSessionInfo.hpp:441</a></div></div>
<div class="ttc" id="aclassWTSTickData_html"><div class="ttname"><a href="classWTSTickData.html">WTSTickData</a></div><div class="ttdoc">Tick数据对象</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01251">WTSDataDef.hpp:1252</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a097548155cfbbf9a0a36e1ee1ce3ad38"><div class="ttname"><a href="classWTSTickData.html#a097548155cfbbf9a0a36e1ee1ce3ad38">WTSTickData::volume</a></div><div class="ttdeci">double volume() const</div><div class="ttdoc">获取当前成交量</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01428">WTSDataDef.hpp:1428</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a25b6a4e9293d666b29ee5c409d72073a"><div class="ttname"><a href="classWTSTickData.html#a25b6a4e9293d666b29ee5c409d72073a">WTSTickData::open</a></div><div class="ttdeci">double open() const</div><div class="ttdoc">获取Tick数据的开盘价</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01347">WTSDataDef.hpp:1347</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a3bf709056260520001ce36105cad50ed"><div class="ttname"><a href="classWTSTickData.html#a3bf709056260520001ce36105cad50ed">WTSTickData::getContractInfo</a></div><div class="ttdeci">WTSContractInfo * getContractInfo() const</div><div class="ttdoc">获取Tick数据对应的合约信息</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01599">WTSDataDef.hpp:1599</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a3f5ca8ee02338f1991293bb33ba0318d"><div class="ttname"><a href="classWTSTickData.html#a3f5ca8ee02338f1991293bb33ba0318d">WTSTickData::setContractInfo</a></div><div class="ttdeci">void setContractInfo(WTSContractInfo *cInfo)</div><div class="ttdoc">设置Tick数据对应的合约信息</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01590">WTSDataDef.hpp:1590</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a47ff21745fccd3f0e8c8178b601e2b39"><div class="ttname"><a href="classWTSTickData.html#a47ff21745fccd3f0e8c8178b601e2b39">WTSTickData::low</a></div><div class="ttdeci">double low() const</div><div class="ttdoc">获取Tick数据的最低价</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01365">WTSDataDef.hpp:1365</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a4b56adfd1cd4e6b95833653ca987ce43"><div class="ttname"><a href="classWTSTickData.html#a4b56adfd1cd4e6b95833653ca987ce43">WTSTickData::create</a></div><div class="ttdeci">static WTSTickData * create(const char *stdCode)</div><div class="ttdoc">创建一个Tick数据对象</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01270">WTSDataDef.hpp:1270</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a6a81212366831e7afe3eeac41b42e7b0"><div class="ttname"><a href="classWTSTickData.html#a6a81212366831e7afe3eeac41b42e7b0">WTSTickData::getTickStruct</a></div><div class="ttdeci">WTSTickStruct &amp; getTickStruct()</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01580">WTSDataDef.hpp:1580</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a7119fbf29cf6e3775a75bc0c093ab613"><div class="ttname"><a href="classWTSTickData.html#a7119fbf29cf6e3775a75bc0c093ab613">WTSTickData::high</a></div><div class="ttdeci">double high() const</div><div class="ttdoc">获取Tick数据的最高价</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01356">WTSDataDef.hpp:1356</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_ae40aac80fd30843224b6e88d007b1d05"><div class="ttname"><a href="classWTSTickData.html#ae40aac80fd30843224b6e88d007b1d05">WTSTickData::code</a></div><div class="ttdeci">const char * code() const</div><div class="ttdoc">获取Tick数据的合约代码</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01320">WTSDataDef.hpp:1320</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_ae502123e14736815e734b7f6456cfd13"><div class="ttname"><a href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">WTSTickData::price</a></div><div class="ttdeci">double price() const</div><div class="ttdoc">获取Tick数据的最新成交价</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01338">WTSDataDef.hpp:1338</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_af8df9fb130bea4ca8470a0ccef56b690"><div class="ttname"><a href="classWTSTickData.html#af8df9fb130bea4ca8470a0ccef56b690">WTSTickData::setCode</a></div><div class="ttdeci">void setCode(const char *code, std::size_t len=0)</div><div class="ttdoc">设置Tick数据的合约代码</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01305">WTSDataDef.hpp:1305</a></div></div>
<div class="ttc" id="aclassWTSTickSlice_html"><div class="ttname"><a href="classWTSTickSlice.html">WTSTickSlice</a></div><div class="ttdoc">Tick数据切片类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l02128">WTSDataDef.hpp:2129</a></div></div>
<div class="ttc" id="aclassWTSVariant_html"><div class="ttname"><a href="classWTSVariant.html">WTSVariant</a></div><div class="ttdoc">变量类</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00037">WTSVariant.hpp:38</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a394beb745c43614ae782ea502735143f"><div class="ttname"><a href="classWTSVariant.html#a394beb745c43614ae782ea502735143f">WTSVariant::getDouble</a></div><div class="ttdeci">double getDouble(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00321">WTSVariant.hpp:321</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a4324db343ea15614f9ad80e1e4d076b8"><div class="ttname"><a href="classWTSVariant.html#a4324db343ea15614f9ad80e1e4d076b8">WTSVariant::memberNames</a></div><div class="ttdeci">MemberNames memberNames() const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00676">WTSVariant.hpp:676</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a4dacb2b4afd195d05dedb5323d7982f3"><div class="ttname"><a href="classWTSVariant.html#a4dacb2b4afd195d05dedb5323d7982f3">WTSVariant::get</a></div><div class="ttdeci">WTSVariant * get(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00357">WTSVariant.hpp:357</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a597bf32bfe71fb040721dc65dc786df6"><div class="ttname"><a href="classWTSVariant.html#a597bf32bfe71fb040721dc65dc786df6">WTSVariant::getBoolean</a></div><div class="ttdeci">bool getBoolean(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00348">WTSVariant.hpp:348</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a830db11fc8daceff409fdbebaa7bea8a"><div class="ttname"><a href="classWTSVariant.html#a830db11fc8daceff409fdbebaa7bea8a">WTSVariant::getCString</a></div><div class="ttdeci">const char * getCString(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00339">WTSVariant.hpp:339</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a888d00f531f1a3ae9d0f12543f302522"><div class="ttname"><a href="classWTSVariant.html#a888d00f531f1a3ae9d0f12543f302522">WTSVariant::release</a></div><div class="ttdeci">virtual void release()</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00691">WTSVariant.hpp:691</a></div></div>
<div class="ttc" id="aclassWtDtMgr_html"><div class="ttname"><a href="classWtDtMgr.html">WtDtMgr</a></div><div class="ttdoc">数据管理器类</div><div class="ttdef"><b>Definition</b> <a href="WtDtMgr_8h_source.html#l00038">WtDtMgr.h:39</a></div></div>
<div class="ttc" id="aclassWtDtMgr_html_a3e3a1f265f439df9846c475348a12821"><div class="ttname"><a href="classWtDtMgr.html#a3e3a1f265f439df9846c475348a12821">WtDtMgr::handle_push_quote</a></div><div class="ttdeci">void handle_push_quote(const char *stdCode, WTSTickData *newTick)</div><div class="ttdoc">处理推送的行情数据</div><div class="ttdef"><b>Definition</b> <a href="WtDtMgr_8cpp_source.html#l00326">WtDtMgr.cpp:326</a></div></div>
<div class="ttc" id="aclassWtDtMgr_html_a6cd8f89ff3aa31eac4b0cc54d363a65d"><div class="ttname"><a href="classWtDtMgr.html#a6cd8f89ff3aa31eac4b0cc54d363a65d">WtDtMgr::grab_last_tick</a></div><div class="ttdeci">virtual WTSTickData * grab_last_tick(const char *stdCode) override</div><div class="ttdoc">获取最新的Tick数据</div><div class="ttdef"><b>Definition</b> <a href="WtDtMgr_8cpp_source.html#l00362">WtDtMgr.cpp:362</a></div></div>
<div class="ttc" id="aclassWtDtMgr_html_a7621426df582e4c1a818623bb25b2d14"><div class="ttname"><a href="classWtDtMgr.html#a7621426df582e4c1a818623bb25b2d14">WtDtMgr::get_tick_slice</a></div><div class="ttdeci">virtual WTSTickSlice * get_tick_slice(const char *stdCode, uint32_t count, uint64_t etime=0) override</div><div class="ttdoc">获取Tick数据切片</div><div class="ttdef"><b>Definition</b> <a href="WtDtMgr_8cpp_source.html#l00417">WtDtMgr.cpp:417</a></div></div>
<div class="ttc" id="aclassWtDtMgr_html_ab4cdcf2a7c5069b105a9a89902e04c54"><div class="ttname"><a href="classWtDtMgr.html#ab4cdcf2a7c5069b105a9a89902e04c54">WtDtMgr::get_kline_slice</a></div><div class="ttdeci">virtual WTSKlineSlice * get_kline_slice(const char *stdCode, WTSKlinePeriod period, uint32_t times, uint32_t count, uint64_t etime=0) override</div><div class="ttdoc">获取K线数据切片</div><div class="ttdef"><b>Definition</b> <a href="WtDtMgr_8cpp_source.html#l00577">WtDtMgr.cpp:577</a></div></div>
<div class="ttc" id="aclassWtDtMgr_html_ad95c02b7148be0d26851d8cb9ce32002"><div class="ttname"><a href="classWtDtMgr.html#ad95c02b7148be0d26851d8cb9ce32002">WtDtMgr::get_adjusting_factor</a></div><div class="ttdeci">virtual double get_adjusting_factor(const char *stdCode, uint32_t uDate) override</div><div class="ttdoc">获取复权因子</div><div class="ttdef"><b>Definition</b> <a href="WtDtMgr_8cpp_source.html#l00382">WtDtMgr.cpp:382</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a03ffb0f844d21afde748ff9ef8b41f47"><div class="ttname"><a href="classWtEngine.html#a03ffb0f844d21afde748ff9ef8b41f47">WtEngine::log_close</a></div><div class="ttdeci">void log_close(const char *stdCode, bool isLong, uint64_t openTime, double openpx, uint64_t closeTime, double closepx, double qty, double profit, double totalprofit=0)</div><div class="ttdoc">记录平仓日志</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01904">WtEngine.cpp:1904</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a048845994584287eec212d39539ba645"><div class="ttname"><a href="classWtEngine.html#a048845994584287eec212d39539ba645">WtEngine::get_commodity_info</a></div><div class="ttdeci">WTSCommodityInfo * get_commodity_info(const char *stdCode)</div><div class="ttdoc">获取品种信息</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00131">WtEngine.cpp:131</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a04c2ea36fe63e6d3d92bac9d3000a5ac"><div class="ttname"><a href="classWtEngine.html#a04c2ea36fe63e6d3d92bac9d3000a5ac">WtEngine::_price_map</a></div><div class="ttdeci">PriceMap _price_map</div><div class="ttdoc">当前合约价格映射表</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00846">WtEngine.h:846</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a05c37fcb997b75b4b83336d56e8c82f8"><div class="ttname"><a href="classWtEngine.html#a05c37fcb997b75b4b83336d56e8c82f8">WtEngine::getCurTime</a></div><div class="ttdeci">virtual uint32_t getCurTime() override</div><div class="ttdoc">获取当前时间</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00410">WtEngine.cpp:410</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a11261379454fc23df1db62a0197b1032"><div class="ttname"><a href="classWtEngine.html#a11261379454fc23df1db62a0197b1032">WtEngine::_task_queue</a></div><div class="ttdeci">TaskQueue _task_queue</div><div class="ttdoc">任务队列</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00854">WtEngine.h:854</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a12c3726337001fb1f6058c97ee637c09"><div class="ttname"><a href="classWtEngine.html#a12c3726337001fb1f6058c97ee637c09">WtEngine::set_trading_date</a></div><div class="ttdeci">void set_trading_date(uint32_t curTDate)</div><div class="ttdoc">设置交易日期</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00113">WtEngine.cpp:113</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a13559b13d0400d1a71e9eb71dcf8e84f"><div class="ttname"><a href="classWtEngine.html#a13559b13d0400d1a71e9eb71dcf8e84f">WtEngine::on_tick</a></div><div class="ttdeci">virtual void on_tick(const char *stdCode, WTSTickData *curTick)</div><div class="ttdoc">Tick数据到达事件</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00217">WtEngine.cpp:217</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a138e94ed4c69081758d3de4307276a25"><div class="ttname"><a href="classWtEngine.html#a138e94ed4c69081758d3de4307276a25">WtEngine::get_kline_slice</a></div><div class="ttdeci">WTSKlineSlice * get_kline_slice(uint32_t sid, const char *stdCode, const char *period, uint32_t count, uint32_t times=1, uint64_t etime=0)</div><div class="ttdoc">获取K线切片数据</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01006">WtEngine.cpp:1006</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a16b30134700726e86c856c812e1dd575"><div class="ttname"><a href="classWtEngine.html#a16b30134700726e86c856c812e1dd575">WtEngine::_thrd_task</a></div><div class="ttdeci">StdThreadPtr _thrd_task</div><div class="ttdoc">后台任务线程指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00853">WtEngine.h:853</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a18bf11787444741d15a4c1993c16f9dd"><div class="ttname"><a href="classWtEngine.html#a18bf11787444741d15a4c1993c16f9dd">WtEngine::load_fees</a></div><div class="ttdeci">void load_fees(const char *filename)</div><div class="ttdoc">加载手续费配置</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01376">WtEngine.cpp:1376</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a1a83817fd43cdf080c6f5428c798b419"><div class="ttname"><a href="classWtEngine.html#a1a83817fd43cdf080c6f5428c798b419">WtEngine::set_date_time</a></div><div class="ttdeci">void set_date_time(uint32_t curDate, uint32_t curTime, uint32_t curSecs=0, uint32_t rawTime=0)</div><div class="ttdoc">设置当前日期时间</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00085">WtEngine.cpp:85</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a1f26eb99410502190ee06014f8098c50"><div class="ttname"><a href="classWtEngine.html#a1f26eb99410502190ee06014f8098c50">WtEngine::_cur_secs</a></div><div class="ttdeci">uint32_t _cur_secs</div><div class="ttdoc">当前秒数，包含毫秒</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00607">WtEngine.h:607</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a2021f9b8eab5fa7024e377d7917225d5"><div class="ttname"><a href="classWtEngine.html#a2021f9b8eab5fa7024e377d7917225d5">WtEngine::_cur_raw_time</a></div><div class="ttdeci">uint32_t _cur_raw_time</div><div class="ttdoc">当前真实时间，格式HHMMSS</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00602">WtEngine.h:602</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a2732e226070da4cdb1b7c0fc62d9f139"><div class="ttname"><a href="classWtEngine.html#a2732e226070da4cdb1b7c0fc62d9f139">WtEngine::_port_fund</a></div><div class="ttdeci">WTSPortFundInfo * _port_fund</div><div class="ttdoc">组合资金信息指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00786">WtEngine.h:786</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a29b7b633cc31100cd806a8245a70f6d0"><div class="ttname"><a href="classWtEngine.html#a29b7b633cc31100cd806a8245a70f6d0">WtEngine::task_loop</a></div><div class="ttdeci">void task_loop()</div><div class="ttdoc">任务循环</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01716">WtEngine.cpp:1716</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a2a2a7c974cbdc00810a0451552c5e271"><div class="ttname"><a href="classWtEngine.html#a2a2a7c974cbdc00810a0451552c5e271">WtEngine::_sig_map</a></div><div class="ttdeci">SignalMap _sig_map</div><div class="ttdoc">信号映射表</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00717">WtEngine.h:717</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a2c25985ccf06e1da8f2767a23620e875"><div class="ttname"><a href="classWtEngine.html#a2c25985ccf06e1da8f2767a23620e875">WtEngine::append_signal</a></div><div class="ttdeci">void append_signal(const char *stdCode, double qty, bool bStandBy)</div><div class="ttdoc">添加信号</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01499">WtEngine.cpp:1499</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a2ef4669a0c26a457938ff2557563de45"><div class="ttname"><a href="classWtEngine.html#a2ef4669a0c26a457938ff2557563de45">WtEngine::_hot_mgr</a></div><div class="ttdeci">IHotMgr * _hot_mgr</div><div class="ttdoc">主力合约管理器</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00629">WtEngine.h:629</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a336c43b26da626884612923bb5168225"><div class="ttname"><a href="classWtEngine.html#a336c43b26da626884612923bb5168225">WtEngine::get_tick_slice</a></div><div class="ttdeci">WTSTickSlice * get_tick_slice(uint32_t sid, const char *stdCode, uint32_t count)</div><div class="ttdoc">获取Tick切片数据</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00971">WtEngine.cpp:971</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a33ad98d7ca50f3fea285ffba0c090f08"><div class="ttname"><a href="classWtEngine.html#a33ad98d7ca50f3fea285ffba0c090f08">WtEngine::update_fund_dynprofit</a></div><div class="ttdeci">void update_fund_dynprofit()</div><div class="ttdoc">更新资金动态盈亏</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00305">WtEngine.cpp:305</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a3c792ff47f8a8cccbbdfa5a0eb5ca0e7"><div class="ttname"><a href="classWtEngine.html#a3c792ff47f8a8cccbbdfa5a0eb5ca0e7">WtEngine::_fee_map</a></div><div class="ttdeci">FeeMap _fee_map</div><div class="ttdoc">手续费映射表</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00779">WtEngine.h:779</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a3ce8b51712ebb3eb403b90afe90b0304"><div class="ttname"><a href="classWtEngine.html#a3ce8b51712ebb3eb403b90afe90b0304">WtEngine::calc_fee</a></div><div class="ttdeci">double calc_fee(const char *stdCode, double price, double qty, uint32_t offset)</div><div class="ttdoc">计算手续费</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01439">WtEngine.cpp:1439</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a3d14559ce4c66de587de46611f1e6158"><div class="ttname"><a href="classWtEngine.html#a3d14559ce4c66de587de46611f1e6158">WtEngine::_cur_time</a></div><div class="ttdeci">uint32_t _cur_time</div><div class="ttdoc">当前时间，是1分钟线时间</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00597">WtEngine.h:597</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a3de152e1623d0496f2ce3bc01882cb68"><div class="ttname"><a href="classWtEngine.html#a3de152e1623d0496f2ce3bc01882cb68">WtEngine::_close_logs</a></div><div class="ttdeci">BoostFilePtr _close_logs</div><div class="ttdoc">平仓日志文件指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00891">WtEngine.h:891</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a432d3c5160d63742d577bfb045fb5b91"><div class="ttname"><a href="classWtEngine.html#a432d3c5160d63742d577bfb045fb5b91">WtEngine::_cur_tdate</a></div><div class="ttdeci">uint32_t _cur_tdate</div><div class="ttdoc">当前交易日，格式YYYYMMDD</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00612">WtEngine.h:612</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a472556a49dd1f59645f7acc634ae272c"><div class="ttname"><a href="classWtEngine.html#a472556a49dd1f59645f7acc634ae272c">WtEngine::get_contract_info</a></div><div class="ttdeci">WTSContractInfo * get_contract_info(const char *stdCode)</div><div class="ttdoc">获取合约信息</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00148">WtEngine.cpp:148</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a4796a8db9c86d12ac396503a33a2d5f2"><div class="ttname"><a href="classWtEngine.html#a4796a8db9c86d12ac396503a33a2d5f2">WtEngine::getTradingDate</a></div><div class="ttdeci">virtual uint32_t getTradingDate() override</div><div class="ttdoc">获取交易日期</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00424">WtEngine.cpp:424</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a4f642b7373570d14722e1660f006324c"><div class="ttname"><a href="classWtEngine.html#a4f642b7373570d14722e1660f006324c">WtEngine::TaskQueue</a></div><div class="ttdeci">std::queue&lt; TaskItem &gt; TaskQueue</div><div class="ttdoc">后台任务线程相关成员</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00852">WtEngine.h:852</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a578422f505b1a6270edfc91bbf3db0ee"><div class="ttname"><a href="classWtEngine.html#a578422f505b1a6270edfc91bbf3db0ee">WtEngine::push_task</a></div><div class="ttdeci">void push_task(TaskItem task)</div><div class="ttdoc">推送任务</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01689">WtEngine.cpp:1689</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a5ca45b0593039bc63b4eab1c215ec828"><div class="ttname"><a href="classWtEngine.html#a5ca45b0593039bc63b4eab1c215ec828">WtEngine::sub_tick</a></div><div class="ttdeci">void sub_tick(uint32_t sid, const char *code)</div><div class="ttdoc">订阅Tick数据</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01285">WtEngine.cpp:1285</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a5e1dfb89897bd0c7e8c2b8fa135344d8"><div class="ttname"><a href="classWtEngine.html#a5e1dfb89897bd0c7e8c2b8fa135344d8">WtEngine::_pos_map</a></div><div class="ttdeci">PositionMap _pos_map</div><div class="ttdoc">当前所有合约的持仓映射表</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00838">WtEngine.h:838</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a6006b1b612a0a56214ad8e532bb083bf"><div class="ttname"><a href="classWtEngine.html#a6006b1b612a0a56214ad8e532bb083bf">WtEngine::isInTrading</a></div><div class="ttdeci">virtual bool isInTrading() override</div><div class="ttdoc">检查是否在交易时段内</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00437">WtEngine.cpp:437</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a6085176597fb79d563ad3f687591279f"><div class="ttname"><a href="classWtEngine.html#a6085176597fb79d563ad3f687591279f">WtEngine::log_trade</a></div><div class="ttdeci">void log_trade(const char *stdCode, bool isLong, bool isOpen, uint64_t curTime, double price, double qty, double fee=0.0)</div><div class="ttdoc">记录交易日志</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01880">WtEngine.cpp:1880</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a64d1422fc2cce207851877d2ebfd9b94"><div class="ttname"><a href="classWtEngine.html#a64d1422fc2cce207851877d2ebfd9b94">WtEngine::_data_mgr</a></div><div class="ttdeci">WtDtMgr * _data_mgr</div><div class="ttdoc">数据管理器</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00635">WtEngine.h:635</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a658742fa0657c79475f8c7675c4bb897"><div class="ttname"><a href="classWtEngine.html#a658742fa0657c79475f8c7675c4bb897">WtEngine::get_cur_price</a></div><div class="ttdeci">double get_cur_price(const char *stdCode)</div><div class="ttdoc">获取当前价格</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01116">WtEngine.cpp:1116</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a6909bea9afa5f3ddbc06f6d57bf11b53"><div class="ttname"><a href="classWtEngine.html#a6909bea9afa5f3ddbc06f6d57bf11b53">WtEngine::getFundInfo</a></div><div class="ttdeci">virtual WTSPortFundInfo * getFundInfo() override</div><div class="ttdoc">获取组合资金信息</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00472">WtEngine.cpp:472</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a6c51ead2f0c35c0ae075bc55e91ea828"><div class="ttname"><a href="classWtEngine.html#a6c51ead2f0c35c0ae075bc55e91ea828">WtEngine::get_session_info</a></div><div class="ttdeci">WTSSessionInfo * get_session_info(const char *sid, bool isCode=false)</div><div class="ttdoc">获取交易时段信息</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00192">WtEngine.cpp:192</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a73508a20ab06d4e602d671dc48e06b1e"><div class="ttname"><a href="classWtEngine.html#a73508a20ab06d4e602d671dc48e06b1e">WtEngine::get_trading_date</a></div><div class="ttdeci">uint32_t get_trading_date()</div><div class="ttdoc">获取当前交易日期</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00247">WtEngine.h:247</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a78e78faf98d93a32c6b0bee6f81edb7b"><div class="ttname"><a href="classWtEngine.html#a78e78faf98d93a32c6b0bee6f81edb7b">WtEngine::init_outputs</a></div><div class="ttdeci">void init_outputs()</div><div class="ttdoc">初始化输出模块</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01822">WtEngine.cpp:1822</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a7c136cba5e314c5f4dbb1f13838e849c"><div class="ttname"><a href="classWtEngine.html#a7c136cba5e314c5f4dbb1f13838e849c">WtEngine::do_set_position</a></div><div class="ttdeci">void do_set_position(const char *stdCode, double qty, double curPx=-1)</div><div class="ttdoc">设置仓位</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01552">WtEngine.cpp:1552</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a8500acd28ad8cecf813fa3dc9d64b19b"><div class="ttname"><a href="classWtEngine.html#a8500acd28ad8cecf813fa3dc9d64b19b">WtEngine::init</a></div><div class="ttdeci">virtual void init(WTSVariant *cfg, IBaseDataMgr *bdMgr, WtDtMgr *dataMgr, IHotMgr *hotMgr, EventNotifier *notifier)</div><div class="ttdoc">初始化引擎</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00495">WtEngine.cpp:495</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a8917b41644c63b149ec85d6a56e56389"><div class="ttname"><a href="classWtEngine.html#a8917b41644c63b149ec85d6a56e56389">WtEngine::_bar_sub_map</a></div><div class="ttdeci">StraSubMap _bar_sub_map</div><div class="ttdoc">K线数据订阅表</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00672">WtEngine.h:672</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a8f7155ed8cd8b0f89243276b21052cd5"><div class="ttname"><a href="classWtEngine.html#a8f7155ed8cd8b0f89243276b21052cd5">WtEngine::get_rawcode</a></div><div class="ttdeci">std::string get_rawcode(const char *stdCode)</div><div class="ttdoc">获取原始合约代码</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00165">WtEngine.cpp:165</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a949c7b173c6799080d27e6b79e76297e"><div class="ttname"><a href="classWtEngine.html#a949c7b173c6799080d27e6b79e76297e">WtEngine::_risk_volscale</a></div><div class="ttdeci">double _risk_volscale</div><div class="ttdoc">风控用合约乘数</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00873">WtEngine.h:873</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a95d70b06ff982397dcc4ff218f5789d8"><div class="ttname"><a href="classWtEngine.html#a95d70b06ff982397dcc4ff218f5789d8">WtEngine::PosInfoPtr</a></div><div class="ttdeci">std::shared_ptr&lt; PosInfo &gt; PosInfoPtr</div><div class="ttdoc">持仓信息智能指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00836">WtEngine.h:836</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a95ff15fed1bd22e8c23be0e99553cc0c"><div class="ttname"><a href="classWtEngine.html#a95ff15fed1bd22e8c23be0e99553cc0c">WtEngine::_fund_udt_span</a></div><div class="ttdeci">uint32_t _fund_udt_span</div><div class="ttdoc">组合资金更新时间间隔，单位毫秒</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00617">WtEngine.h:617</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a96b3c5a16cea856a5e26c8ff05208566"><div class="ttname"><a href="classWtEngine.html#a96b3c5a16cea856a5e26c8ff05208566">WtEngine::_risk_fact</a></div><div class="ttdeci">RiskMonFactInfo _risk_fact</div><div class="ttdoc">当前风控工厂信息</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00871">WtEngine.h:871</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a973c4477c266e36612edcee2d363081c"><div class="ttname"><a href="classWtEngine.html#a973c4477c266e36612edcee2d363081c">WtEngine::_filter_mgr</a></div><div class="ttdeci">WtFilterMgr _filter_mgr</div><div class="ttdoc">信号过滤器管理器</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00723">WtEngine.h:723</a></div></div>
<div class="ttc" id="aclassWtEngine_html_a9759242686c911952bf87cb72f8cc306"><div class="ttname"><a href="classWtEngine.html#a9759242686c911952bf87cb72f8cc306">WtEngine::init_riskmon</a></div><div class="ttdeci">bool init_riskmon(WTSVariant *cfg)</div><div class="ttdoc">初始化风控模块</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01760">WtEngine.cpp:1760</a></div></div>
<div class="ttc" id="aclassWtEngine_html_aa18f2cc0bac48ac597a21307d6ff9085"><div class="ttname"><a href="classWtEngine.html#aa18f2cc0bac48ac597a21307d6ff9085">WtEngine::get_day_price</a></div><div class="ttdeci">double get_day_price(const char *stdCode, int flag=0)</div><div class="ttdoc">获取当日价格</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01174">WtEngine.cpp:1174</a></div></div>
<div class="ttc" id="aclassWtEngine_html_aa21948337706337dd9377e86b16ff7a9"><div class="ttname"><a href="classWtEngine.html#aa21948337706337dd9377e86b16ff7a9">WtEngine::load_datas</a></div><div class="ttdeci">void load_datas()</div><div class="ttdoc">加载数据</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00791">WtEngine.cpp:791</a></div></div>
<div class="ttc" id="aclassWtEngine_html_aa306db82dde1e9259005ce44ae233f01"><div class="ttname"><a href="classWtEngine.html#aa306db82dde1e9259005ce44ae233f01">WtEngine::_notifier</a></div><div class="ttdeci">EventNotifier * _notifier</div><div class="ttdoc">事件通知器</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00729">WtEngine.h:729</a></div></div>
<div class="ttc" id="aclassWtEngine_html_aa4bf95915f60e8f7b588c44e151aec56"><div class="ttname"><a href="classWtEngine.html#aa4bf95915f60e8f7b588c44e151aec56">WtEngine::on_session_begin</a></div><div class="ttdeci">virtual void on_session_begin()</div><div class="ttdoc">交易时段开始回调</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00614">WtEngine.cpp:614</a></div></div>
<div class="ttc" id="aclassWtEngine_html_aa4d4751e75b542e177dc6203314b6ba5"><div class="ttname"><a href="classWtEngine.html#aa4d4751e75b542e177dc6203314b6ba5">WtEngine::on_session_end</a></div><div class="ttdeci">virtual void on_session_end()</div><div class="ttdoc">交易时段结束回调</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00546">WtEngine.cpp:546</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ab03870fa91659e930c925422a05beee2"><div class="ttname"><a href="classWtEngine.html#ab03870fa91659e930c925422a05beee2">WtEngine::save_datas</a></div><div class="ttdeci">void save_datas()</div><div class="ttdoc">保存数据</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00624">WtEngine.cpp:624</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ab6464b8e3675226ef6b3c89f8bbe2e7a"><div class="ttname"><a href="classWtEngine.html#ab6464b8e3675226ef6b3c89f8bbe2e7a">WtEngine::get_exright_factor</a></div><div class="ttdeci">double get_exright_factor(const char *stdCode, WTSCommodityInfo *commInfo=NULL)</div><div class="ttdoc">获取复权因子</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01234">WtEngine.cpp:1234</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ab6f78977ebba071a101535a5c547c0cc"><div class="ttname"><a href="classWtEngine.html#ab6f78977ebba071a101535a5c547c0cc">WtEngine::setVolScale</a></div><div class="ttdeci">virtual void setVolScale(double scale) override</div><div class="ttdoc">设置仓位缩放比例</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00450">WtEngine.cpp:450</a></div></div>
<div class="ttc" id="aclassWtEngine_html_abb0c5dc7eed14e13a7a7464d3cc6e3ae"><div class="ttname"><a href="classWtEngine.html#abb0c5dc7eed14e13a7a7464d3cc6e3ae">WtEngine::_trade_logs</a></div><div class="ttdeci">BoostFilePtr _trade_logs</div><div class="ttdoc">交易日志文件指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00886">WtEngine.h:886</a></div></div>
<div class="ttc" id="aclassWtEngine_html_abe547880a4fc90b37c4a054cf77314d5"><div class="ttname"><a href="classWtEngine.html#abe547880a4fc90b37c4a054cf77314d5">WtEngine::handle_push_quote</a></div><div class="ttdeci">virtual void handle_push_quote(WTSTickData *newTick) override</div><div class="ttdoc">IParserStub接口实现</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01058">WtEngine.cpp:1058</a></div></div>
<div class="ttc" id="aclassWtEngine_html_abfa097f39c0bf17ea21e8ee8d54de47e"><div class="ttname"><a href="classWtEngine.html#abfa097f39c0bf17ea21e8ee8d54de47e">WtEngine::get_last_tick</a></div><div class="ttdeci">WTSTickData * get_last_tick(uint32_t sid, const char *stdCode)</div><div class="ttdoc">获取最新的Tick数据</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00986">WtEngine.cpp:986</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ac3bb192a7d478dda732accd72f7499e5"><div class="ttname"><a href="classWtEngine.html#ac3bb192a7d478dda732accd72f7499e5">WtEngine::getCurDate</a></div><div class="ttdeci">virtual uint32_t getCurDate() override</div><div class="ttdoc">获取当前日期</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00397">WtEngine.cpp:397</a></div></div>
<div class="ttc" id="aclassWtEngine_html_aca3e2d517249bef5ed21db8a71e66d26"><div class="ttname"><a href="classWtEngine.html#aca3e2d517249bef5ed21db8a71e66d26">WtEngine::_tick_sub_map</a></div><div class="ttdeci">StraSubMap _tick_sub_map</div><div class="ttdoc">tick数据订阅表</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00666">WtEngine.h:666</a></div></div>
<div class="ttc" id="aclassWtEngine_html_acde4886b0c399bd811eec59f3bb5cc9c"><div class="ttname"><a href="classWtEngine.html#acde4886b0c399bd811eec59f3bb5cc9c">WtEngine::WtEngine</a></div><div class="ttdeci">WtEngine()</div><div class="ttdoc">构造函数</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00048">WtEngine.cpp:48</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ad77543e1d1e0a3a8e94163f61a14f86c"><div class="ttname"><a href="classWtEngine.html#ad77543e1d1e0a3a8e94163f61a14f86c">WtEngine::_cur_date</a></div><div class="ttdeci">uint32_t _cur_date</div><div class="ttdoc">当前日期，格式YYYYMMDD</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00591">WtEngine.h:591</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ad85990540ce319bfea09f435f537bd1a"><div class="ttname"><a href="classWtEngine.html#ad85990540ce319bfea09f435f537bd1a">WtEngine::writeRiskLog</a></div><div class="ttdeci">virtual void writeRiskLog(const char *message) override</div><div class="ttdoc">写入风控日志</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l00378">WtEngine.cpp:378</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ada1664ec0b95fb612ae86054190e6f24"><div class="ttname"><a href="classWtEngine.html#ada1664ec0b95fb612ae86054190e6f24">WtEngine::_mtx_task</a></div><div class="ttdeci">StdUniqueMutex _mtx_task</div><div class="ttdoc">任务队列互斥锁</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00855">WtEngine.h:855</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ae061bcec5d0092f7758bddb6c10ef5d5"><div class="ttname"><a href="classWtEngine.html#ae061bcec5d0092f7758bddb6c10ef5d5">WtEngine::_risk_date</a></div><div class="ttdeci">uint32_t _risk_date</div><div class="ttdoc">风控日期</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00874">WtEngine.h:874</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ae090cca52beb4eda803a06afd384e626"><div class="ttname"><a href="classWtEngine.html#ae090cca52beb4eda803a06afd384e626">WtEngine::get_adjusting_flag</a></div><div class="ttdeci">uint32_t get_adjusting_flag()</div><div class="ttdoc">获取收盘布局调整标志</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8cpp_source.html#l01266">WtEngine.cpp:1266</a></div></div>
<div class="ttc" id="aclassWtEngine_html_ae86eeb05290fcd43d8e2176c230c9e23"><div class="ttname"><a href="classWtEngine.html#ae86eeb05290fcd43d8e2176c230c9e23">WtEngine::_risk_mon</a></div><div class="ttdeci">WtRiskMonPtr _risk_mon</div><div class="ttdoc">风控实例智能指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00872">WtEngine.h:872</a></div></div>
<div class="ttc" id="aclassWtEngine_html_af42087900846f147e477097373ae3a2f"><div class="ttname"><a href="classWtEngine.html#af42087900846f147e477097373ae3a2f">WtEngine::_base_data_mgr</a></div><div class="ttdeci">IBaseDataMgr * _base_data_mgr</div><div class="ttdoc">基础数据管理器</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00623">WtEngine.h:623</a></div></div>
<div class="ttc" id="aclassWtEngine_html_afa0b0ffb6985e4ee2ec2b41cec41828c"><div class="ttname"><a href="classWtEngine.html#afa0b0ffb6985e4ee2ec2b41cec41828c">WtEngine::_cond_task</a></div><div class="ttdeci">StdCondVariable _cond_task</div><div class="ttdoc">任务队列条件变量</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00856">WtEngine.h:856</a></div></div>
<div class="ttc" id="aclassWtEngine_html_afd182b1e34e048312c8e1838d4e63a5c"><div class="ttname"><a href="classWtEngine.html#afd182b1e34e048312c8e1838d4e63a5c">WtEngine::_terminated</a></div><div class="ttdeci">bool _terminated</div><div class="ttdoc">任务线程终止标志</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00857">WtEngine.h:857</a></div></div>
<div class="ttc" id="aclassWtFilterMgr_html_a5825155c6fb417d388fa2c3d5cb5e465"><div class="ttname"><a href="classWtFilterMgr.html#a5825155c6fb417d388fa2c3d5cb5e465">WtFilterMgr::set_notifier</a></div><div class="ttdeci">void set_notifier(EventNotifier *notifier)</div><div class="ttdoc">设置事件通知器</div><div class="ttdef"><b>Definition</b> <a href="WtFilterMgr_8h_source.html#l00035">WtFilterMgr.h:35</a></div></div>
<div class="ttc" id="aclassWtFilterMgr_html_a9a56b4340fb952158f647453b2e9bc99"><div class="ttname"><a href="classWtFilterMgr.html#a9a56b4340fb952158f647453b2e9bc99">WtFilterMgr::load_filters</a></div><div class="ttdeci">void load_filters(const char *fileName=&quot;&quot;)</div><div class="ttdoc">加载信号过滤器</div><div class="ttdef"><b>Definition</b> <a href="WtFilterMgr_8cpp_source.html#l00025">WtFilterMgr.cpp:25</a></div></div>
<div class="ttc" id="aclassWtHelper_html_aa1041d638b2c3c271177dd2f9c153c4a"><div class="ttname"><a href="classWtHelper.html#aa1041d638b2c3c271177dd2f9c153c4a">WtHelper::setTDate</a></div><div class="ttdeci">static void setTDate(uint32_t tDate)</div><div class="ttdoc">设置当前交易日</div><div class="ttdef"><b>Definition</b> <a href="WtCore_2WtHelper_8h_source.html#l00090">WtHelper.h:90</a></div></div>
<div class="ttc" id="aclassWtHelper_html_abb1e5b65775cc630a9fcabe71a3da098"><div class="ttname"><a href="classWtHelper.html#abb1e5b65775cc630a9fcabe71a3da098">WtHelper::getPortifolioDir</a></div><div class="ttdeci">static const char * getPortifolioDir()</div><div class="ttdoc">获取组合目录</div><div class="ttdef"><b>Definition</b> <a href="WtCore_2WtHelper_8cpp_source.html#l00137">WtHelper.cpp:137</a></div></div>
<div class="ttc" id="aclassWtHelper_html_ac290c0e80d469a0f09f7e37c568a11ab"><div class="ttname"><a href="classWtHelper.html#ac290c0e80d469a0f09f7e37c568a11ab">WtHelper::setTime</a></div><div class="ttdeci">static void setTime(uint32_t date, uint32_t time, uint32_t secs=0)</div><div class="ttdoc">设置当前时间</div><div class="ttdef"><b>Definition</b> <a href="WtCore_2WtHelper_8h_source.html#l00079">WtHelper.h:79</a></div></div>
<div class="ttc" id="aclassWtHelper_html_ac5e1e8cf33bf4c502aedaf6c6db62ab5"><div class="ttname"><a href="classWtHelper.html#ac5e1e8cf33bf4c502aedaf6c6db62ab5">WtHelper::getCWD</a></div><div class="ttdeci">static std::string getCWD()</div><div class="ttdoc">获取当前工作目录</div><div class="ttdef"><b>Definition</b> <a href="WtBtCore_2WtHelper_8cpp_source.html#l00031">WtHelper.cpp:31</a></div></div>
<div class="ttc" id="aclassWtHelper_html_af1a7e612c19e279fc8b57066cad0c2f9"><div class="ttname"><a href="classWtHelper.html#af1a7e612c19e279fc8b57066cad0c2f9">WtHelper::getInstDir</a></div><div class="ttdeci">static const std::string &amp; getInstDir()</div><div class="ttdoc">获取实例目录</div><div class="ttdef"><b>Definition</b> <a href="WtBtCore_2WtHelper_8h_source.html#l00041">WtHelper.h:41</a></div></div>
<div class="ttc" id="aclassWtRiskMonWrapper_html"><div class="ttname"><a href="classWtRiskMonWrapper.html">WtRiskMonWrapper</a></div><div class="ttdoc">风控监控器包装类</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00119">WtEngine.h:120</a></div></div>
<div class="ttc" id="aclasswt__hashmap_html"><div class="ttname"><a href="classwt__hashmap.html">wt_hashmap</a></div><div class="ttdoc">WonderTrader通用高性能哈希表模板类</div><div class="ttdef"><b>Definition</b> <a href="FasterDefs_8h_source.html#l00162">FasterDefs.h:163</a></div></div>
<div class="ttc" id="ademo__send__order_8cpp_html_a04f887fc8800d4727971dbb8eb550132"><div class="ttname"><a href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a></div><div class="ttdeci">ATPPriceType price</div><div class="ttdef"><b>Definition</b> <a href="API_2AtpTradeApi_2demo_2all__message__demo_2main_8cpp_source.html#l00040">main.cpp:40</a></div></div>
<div class="ttc" id="agroup__MutexUtils_html_ga20a94e05f8d16ed0be0999b2b4b5ea2f"><div class="ttname"><a href="group__MutexUtils.html#ga20a94e05f8d16ed0be0999b2b4b5ea2f">StdUniqueLock</a></div><div class="ttdeci">std::unique_lock&lt; StdUniqueMutex &gt; StdUniqueLock</div><div class="ttdoc">唯一锁类型</div><div class="ttdef"><b>Definition</b> <a href="StdUtils_8hpp_source.html#l00073">StdUtils.hpp:73</a></div></div>
<div class="ttc" id="agroup__ThreadUtils_html_gad58209190954450c6ef8c8d66f422e61"><div class="ttname"><a href="group__ThreadUtils.html#gad58209190954450c6ef8c8d66f422e61">StdThread</a></div><div class="ttdeci">std::thread StdThread</div><div class="ttdoc">std::thread的别名</div><div class="ttdef"><b>Definition</b> <a href="StdUtils_8hpp_source.html#l00036">StdUtils.hpp:36</a></div></div>
<div class="ttc" id="anamespacedecimal_html_a1109e5cbdd666b1dd19d91d65768f9f6"><div class="ttname"><a href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a></div><div class="ttdeci">bool gt(double a, double b=0.0) noexcept</div><div class="ttdoc">判断第一个浮点数是否大于第二个浮点数</div><div class="ttdef"><b>Definition</b> <a href="decimal_8h_source.html#l00057">decimal.h:57</a></div></div>
<div class="ttc" id="anamespacedecimal_html_a663d923b333cced39eedf3a44e282161"><div class="ttname"><a href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a></div><div class="ttdeci">bool lt(double a, double b=0.0) noexcept</div><div class="ttdoc">判断第一个浮点数是否小于第二个浮点数</div><div class="ttdef"><b>Definition</b> <a href="decimal_8h_source.html#l00069">decimal.h:69</a></div></div>
<div class="ttc" id="anamespacedecimal_html_a9acf2c0f2cb49024df804e7464472774"><div class="ttname"><a href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a></div><div class="ttdeci">bool eq(double a, double b=0.0) noexcept</div><div class="ttdoc">判断两个浮点数是否相等</div><div class="ttdef"><b>Definition</b> <a href="decimal_8h_source.html#l00045">decimal.h:45</a></div></div>
<div class="ttc" id="anamespacefmtutil_html_a5bfccdc4da1277f2585e7b31c6395bb3"><div class="ttname"><a href="namespacefmtutil.html#a5bfccdc4da1277f2585e7b31c6395bb3">fmtutil::format_to</a></div><div class="ttdeci">char * format_to(char *buffer, const char *format, const Args &amp;...args)</div><div class="ttdoc">格式化字符串并输出到指定缓冲区</div><div class="ttdef"><b>Definition</b> <a href="fmtlib_8h_source.html#l00031">fmtlib.h:31</a></div></div>
<div class="ttc" id="astructCodeHelper_1_1__CodeInfo_html"><div class="ttname"><a href="structCodeHelper_1_1__CodeInfo.html">CodeHelper::_CodeInfo</a></div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00036">CodeHelper.hpp:37</a></div></div>
<div class="ttc" id="astructCodeHelper_1_1__CodeInfo_html_a0cad1c91fd711a8217a024eb8b538d9d"><div class="ttname"><a href="structCodeHelper_1_1__CodeInfo.html#a0cad1c91fd711a8217a024eb8b538d9d">CodeHelper::_CodeInfo::_ruletag</a></div><div class="ttdeci">char _ruletag[MAX_INSTRUMENT_LENGTH]</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00041">CodeHelper.hpp:41</a></div></div>
<div class="ttc" id="astructCodeHelper_1_1__CodeInfo_html_a15662a84163642bec01647acd73456c4"><div class="ttname"><a href="structCodeHelper_1_1__CodeInfo.html#a15662a84163642bec01647acd73456c4">CodeHelper::_CodeInfo::_code</a></div><div class="ttdeci">char _code[MAX_INSTRUMENT_LENGTH]</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00038">CodeHelper.hpp:38</a></div></div>
<div class="ttc" id="astructCodeHelper_1_1__CodeInfo_html_a18eb7decf582a282082809a7d26b460d"><div class="ttname"><a href="structCodeHelper_1_1__CodeInfo.html#a18eb7decf582a282082809a7d26b460d">CodeHelper::_CodeInfo::hasRule</a></div><div class="ttdeci">bool hasRule() const</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00091">CodeHelper.hpp:91</a></div></div>
<div class="ttc" id="astructCodeHelper_1_1__CodeInfo_html_a1d4f7a6320d180db879340b763224bbf"><div class="ttname"><a href="structCodeHelper_1_1__CodeInfo.html#a1d4f7a6320d180db879340b763224bbf">CodeHelper::_CodeInfo::_product</a></div><div class="ttdeci">char _product[MAX_INSTRUMENT_LENGTH]</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00040">CodeHelper.hpp:40</a></div></div>
<div class="ttc" id="astructCodeHelper_1_1__CodeInfo_html_aa13a243f0cd0f40c859242b5c524a9a4"><div class="ttname"><a href="structCodeHelper_1_1__CodeInfo.html#aa13a243f0cd0f40c859242b5c524a9a4">CodeHelper::_CodeInfo::stdCommID</a></div><div class="ttdeci">const char * stdCommID()</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00072">CodeHelper.hpp:72</a></div></div>
<div class="ttc" id="astructCodeHelper_1_1__CodeInfo_html_aaabd8541e08f9491f0d19d7968854e2b"><div class="ttname"><a href="structCodeHelper_1_1__CodeInfo.html#aaabd8541e08f9491f0d19d7968854e2b">CodeHelper::_CodeInfo::_exchg</a></div><div class="ttdeci">char _exchg[MAX_INSTRUMENT_LENGTH]</div><div class="ttdef"><b>Definition</b> <a href="CodeHelper_8hpp_source.html#l00039">CodeHelper.hpp:39</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__DetailInfo_html"><div class="ttname"><a href="structWtEngine_1_1__DetailInfo.html">WtEngine::_DetailInfo</a></div><div class="ttdoc">持仓明细信息结构体</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00793">WtEngine.h:794</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__DetailInfo_html_a0e7160b054cfdb7c021bd24cabef3ad1"><div class="ttname"><a href="structWtEngine_1_1__DetailInfo.html#a0e7160b054cfdb7c021bd24cabef3ad1">WtEngine::_DetailInfo::_long</a></div><div class="ttdeci">bool _long</div><div class="ttdoc">持仓方向，true为多头，false为空头</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00795">WtEngine.h:795</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__DetailInfo_html_a135542065915637f14386c4eb14a8c90"><div class="ttname"><a href="structWtEngine_1_1__DetailInfo.html#a135542065915637f14386c4eb14a8c90">WtEngine::_DetailInfo::_volume</a></div><div class="ttdeci">double _volume</div><div class="ttdoc">持仓数量</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00797">WtEngine.h:797</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__DetailInfo_html_a1ae6167143760b3a562f1aba03e0c049"><div class="ttname"><a href="structWtEngine_1_1__DetailInfo.html#a1ae6167143760b3a562f1aba03e0c049">WtEngine::_DetailInfo::_price</a></div><div class="ttdeci">double _price</div><div class="ttdoc">开仓价格</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00796">WtEngine.h:796</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__DetailInfo_html_a4bb172995fd3cbb4a852123ef14b9eb3"><div class="ttname"><a href="structWtEngine_1_1__DetailInfo.html#a4bb172995fd3cbb4a852123ef14b9eb3">WtEngine::_DetailInfo::_opentime</a></div><div class="ttdeci">uint64_t _opentime</div><div class="ttdoc">开仓时间戳</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00798">WtEngine.h:798</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__DetailInfo_html_a70a4ac93cfa1a2abd30d1d7920327c19"><div class="ttname"><a href="structWtEngine_1_1__DetailInfo.html#a70a4ac93cfa1a2abd30d1d7920327c19">WtEngine::_DetailInfo::_profit</a></div><div class="ttdeci">double _profit</div><div class="ttdoc">当前持仓的浮动盈亏</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00800">WtEngine.h:800</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__DetailInfo_html_af014064a77bdaa2adf7c0950e3a552d7"><div class="ttname"><a href="structWtEngine_1_1__DetailInfo.html#af014064a77bdaa2adf7c0950e3a552d7">WtEngine::_DetailInfo::_opentdate</a></div><div class="ttdeci">uint32_t _opentdate</div><div class="ttdoc">开仓日期</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00799">WtEngine.h:799</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__FeeItem_html"><div class="ttname"><a href="structWtEngine_1_1__FeeItem.html">WtEngine::_FeeItem</a></div><div class="ttdoc">手续费项目结构体</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00736">WtEngine.h:737</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__FeeItem_html_a84034290bc5695ade05ae3395d247b4c"><div class="ttname"><a href="structWtEngine_1_1__FeeItem.html#a84034290bc5695ade05ae3395d247b4c">WtEngine::_FeeItem::_close</a></div><div class="ttdeci">double _close</div><div class="ttdoc">平仓手续费率</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00746">WtEngine.h:746</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__FeeItem_html_aa5a0dde57240a86963f4aa129d4768ab"><div class="ttname"><a href="structWtEngine_1_1__FeeItem.html#aa5a0dde57240a86963f4aa129d4768ab">WtEngine::_FeeItem::_close_today</a></div><div class="ttdeci">double _close_today</div><div class="ttdoc">平今手续费率</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00751">WtEngine.h:751</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__FeeItem_html_ac96429edbc80400202b1118936784db3"><div class="ttname"><a href="structWtEngine_1_1__FeeItem.html#ac96429edbc80400202b1118936784db3">WtEngine::_FeeItem::_by_volume</a></div><div class="ttdeci">bool _by_volume</div><div class="ttdoc">是否按手数计算</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00757">WtEngine.h:757</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__FeeItem_html_aedc9935f6f316885e870dcdc296b8380"><div class="ttname"><a href="structWtEngine_1_1__FeeItem.html#aedc9935f6f316885e870dcdc296b8380">WtEngine::_FeeItem::_open</a></div><div class="ttdeci">double _open</div><div class="ttdoc">开仓手续费率</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00741">WtEngine.h:741</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__PosInfo_html"><div class="ttname"><a href="structWtEngine_1_1__PosInfo.html">WtEngine::_PosInfo</a></div><div class="ttdoc">持仓信息结构体</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00816">WtEngine.h:817</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__RiskMonFactInfo_html_a0e5379c2785570ff52da7b09f6c93778"><div class="ttname"><a href="structWtEngine_1_1__RiskMonFactInfo.html#a0e5379c2785570ff52da7b09f6c93778">WtEngine::_RiskMonFactInfo::_module_inst</a></div><div class="ttdeci">DllHandle _module_inst</div><div class="ttdoc">动态库实例句柄</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00866">WtEngine.h:866</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__RiskMonFactInfo_html_a4619a924c5d6528fc343f3a8f43ab395"><div class="ttname"><a href="structWtEngine_1_1__RiskMonFactInfo.html#a4619a924c5d6528fc343f3a8f43ab395">WtEngine::_RiskMonFactInfo::_fact</a></div><div class="ttdeci">IRiskMonitorFact * _fact</div><div class="ttdoc">风控工厂对象指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00867">WtEngine.h:867</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__RiskMonFactInfo_html_a89cc876e8037797912c7272d0fe2f20c"><div class="ttname"><a href="structWtEngine_1_1__RiskMonFactInfo.html#a89cc876e8037797912c7272d0fe2f20c">WtEngine::_RiskMonFactInfo::_module_path</a></div><div class="ttdeci">std::string _module_path</div><div class="ttdoc">风控动态库路径</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00865">WtEngine.h:865</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__RiskMonFactInfo_html_ae2013754599ebdb8ce875a2f271145af"><div class="ttname"><a href="structWtEngine_1_1__RiskMonFactInfo.html#ae2013754599ebdb8ce875a2f271145af">WtEngine::_RiskMonFactInfo::_remover</a></div><div class="ttdeci">FuncDeleteRiskMonFact _remover</div><div class="ttdoc">销毁工厂方法指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00869">WtEngine.h:869</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__RiskMonFactInfo_html_afd68dc1a855b31894f68ca2210a5678e"><div class="ttname"><a href="structWtEngine_1_1__RiskMonFactInfo.html#afd68dc1a855b31894f68ca2210a5678e">WtEngine::_RiskMonFactInfo::_creator</a></div><div class="ttdeci">FuncCreateRiskMonFact _creator</div><div class="ttdoc">创建工厂方法指针</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00868">WtEngine.h:868</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__SigInfo_html"><div class="ttname"><a href="structWtEngine_1_1__SigInfo.html">WtEngine::_SigInfo</a></div><div class="ttdoc">已废弃的代码注释</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00685">WtEngine.h:686</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__SigInfo_html_a2c8fd5df10de9b10311327dbf0878167"><div class="ttname"><a href="structWtEngine_1_1__SigInfo.html#a2c8fd5df10de9b10311327dbf0878167">WtEngine::_SigInfo::_volume</a></div><div class="ttdeci">double _volume</div><div class="ttdoc">交易数量</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00690">WtEngine.h:690</a></div></div>
<div class="ttc" id="astructWtEngine_1_1__SigInfo_html_aa0f12a7afa24e182f6069e5e9f55e382"><div class="ttname"><a href="structWtEngine_1_1__SigInfo.html#aa0f12a7afa24e182f6069e5e9f55e382">WtEngine::_SigInfo::_gentime</a></div><div class="ttdeci">uint64_t _gentime</div><div class="ttdoc">信号生成时间</div><div class="ttdef"><b>Definition</b> <a href="WtEngine_8h_source.html#l00695">WtEngine.h:695</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_1_1__DynBalPair_html_a9e275356642c508fd297f5e9eaf55ab4"><div class="ttname"><a href="struct__WTSFundStruct_1_1__DynBalPair.html#a9e275356642c508fd297f5e9eaf55ab4">_WTSFundStruct::_DynBalPair::_date</a></div><div class="ttdeci">uint32_t _date</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00122">WTSRiskDef.hpp:122</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_1_1__DynBalPair_html_ac9e215c0a9a64a87a58b3348e1d5ac06"><div class="ttname"><a href="struct__WTSFundStruct_1_1__DynBalPair.html#ac9e215c0a9a64a87a58b3348e1d5ac06">_WTSFundStruct::_DynBalPair::_dyn_balance</a></div><div class="ttdeci">double _dyn_balance</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00123">WTSRiskDef.hpp:123</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html"><div class="ttname"><a href="struct__WTSFundStruct.html">_WTSFundStruct</a></div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00103">WTSRiskDef.hpp:104</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a31eb696bfa5ceee2c5fec680b858debb"><div class="ttname"><a href="struct__WTSFundStruct.html#a31eb696bfa5ceee2c5fec680b858debb">_WTSFundStruct::_fees</a></div><div class="ttdeci">double _fees</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00110">WTSRiskDef.hpp:110</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a353c06ccf3e55f35cd44f47a389facb2"><div class="ttname"><a href="struct__WTSFundStruct.html#a353c06ccf3e55f35cd44f47a389facb2">_WTSFundStruct::_max_time</a></div><div class="ttdeci">uint32_t _max_time</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00114">WTSRiskDef.hpp:114</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a4cb52624d7cece31e756bc8b41348ea3"><div class="ttname"><a href="struct__WTSFundStruct.html#a4cb52624d7cece31e756bc8b41348ea3">_WTSFundStruct::_prebalance</a></div><div class="ttdeci">double _prebalance</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00106">WTSRiskDef.hpp:106</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a588c43df3e1818b0048b84588854d7d4"><div class="ttname"><a href="struct__WTSFundStruct.html#a588c43df3e1818b0048b84588854d7d4">_WTSFundStruct::_predynbal</a></div><div class="ttdeci">double _predynbal</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00105">WTSRiskDef.hpp:105</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a65c5b3a2707d3b6b8a5f08d9140a5ec7"><div class="ttname"><a href="struct__WTSFundStruct.html#a65c5b3a2707d3b6b8a5f08d9140a5ec7">_WTSFundStruct::_min_md_dyn_bal</a></div><div class="ttdeci">DynBalPair _min_md_dyn_bal</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00132">WTSRiskDef.hpp:132</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a6d46b5bc738180c5db41a9f7c705b977"><div class="ttname"><a href="struct__WTSFundStruct.html#a6d46b5bc738180c5db41a9f7c705b977">_WTSFundStruct::_balance</a></div><div class="ttdeci">double _balance</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00107">WTSRiskDef.hpp:107</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a8d898e75e1ecf3be5c1ed9776c3b9b1b"><div class="ttname"><a href="struct__WTSFundStruct.html#a8d898e75e1ecf3be5c1ed9776c3b9b1b">_WTSFundStruct::_update_time</a></div><div class="ttdeci">int64_t _update_time</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00118">WTSRiskDef.hpp:118</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a90def687e499e865a61b42e8b3d43794"><div class="ttname"><a href="struct__WTSFundStruct.html#a90def687e499e865a61b42e8b3d43794">_WTSFundStruct::_profit</a></div><div class="ttdeci">double _profit</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00108">WTSRiskDef.hpp:108</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a962d2195dc5d9f6bede0e0e77330d788"><div class="ttname"><a href="struct__WTSFundStruct.html#a962d2195dc5d9f6bede0e0e77330d788">_WTSFundStruct::_max_dyn_bal</a></div><div class="ttdeci">double _max_dyn_bal</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00113">WTSRiskDef.hpp:113</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a97e24bebe9da68b2c2597c6c68aa1626"><div class="ttname"><a href="struct__WTSFundStruct.html#a97e24bebe9da68b2c2597c6c68aa1626">_WTSFundStruct::_min_dyn_bal</a></div><div class="ttdeci">double _min_dyn_bal</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00115">WTSRiskDef.hpp:115</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_a9e72f305a3309a7e94df5a8239512c61"><div class="ttname"><a href="struct__WTSFundStruct.html#a9e72f305a3309a7e94df5a8239512c61">_WTSFundStruct::_max_md_dyn_bal</a></div><div class="ttdeci">DynBalPair _max_md_dyn_bal</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00131">WTSRiskDef.hpp:131</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_ab0b87a191365ccb2e793f14b44866975"><div class="ttname"><a href="struct__WTSFundStruct.html#ab0b87a191365ccb2e793f14b44866975">_WTSFundStruct::_dynprofit</a></div><div class="ttdeci">double _dynprofit</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00109">WTSRiskDef.hpp:109</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_adcdb4d61e8d3fbc43dc32a8957fdac91"><div class="ttname"><a href="struct__WTSFundStruct.html#adcdb4d61e8d3fbc43dc32a8957fdac91">_WTSFundStruct::_min_time</a></div><div class="ttdeci">uint32_t _min_time</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00116">WTSRiskDef.hpp:116</a></div></div>
<div class="ttc" id="astruct__WTSFundStruct_html_af31ce96ef3973ddb049d1717978c219e"><div class="ttname"><a href="struct__WTSFundStruct.html#af31ce96ef3973ddb049d1717978c219e">_WTSFundStruct::_last_date</a></div><div class="ttdeci">uint32_t _last_date</div><div class="ttdef"><b>Definition</b> <a href="WTSRiskDef_8hpp_source.html#l00111">WTSRiskDef.hpp:111</a></div></div>
<div class="ttc" id="atypes_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00295">types.h:295</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_3ce996bf6400c0a215df0636043a382c.html">WtCore</a></li><li class="navelem"><a class="el" href="WtEngine_8cpp.html">WtEngine.cpp</a></li>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
