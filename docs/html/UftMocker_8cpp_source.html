<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WonderTrader: src/WtBtCore/UftMocker.cpp 源文件</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">WonderTrader<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">高性能量化交易平台</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('UftMocker_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">UftMocker.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="UftMocker_8cpp.html">浏览该文件的文档.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="UftMocker_8h.html">UftMocker.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="WtUftCore_2WtHelper_8h.html">WtHelper.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;stdarg.h&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;boost/filesystem.hpp&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;../Includes/WTSVariant.hpp&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;../Includes/WTSContractInfo.hpp&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;../Share/decimal.h&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;../Share/TimeUtils.hpp&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;../Share/StrUtil.hpp&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;../WTSTools/WTSLogger.h&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keyword">extern</span> uint32_t <a class="code hl_function" href="UftMocker_8cpp.html#a53cef3aa4a728448c19e95d927d87329">makeLocalOrderID</a>();</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="foldopen" id="foldopen00032" data-start="{" data-end="};">
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">   32</a></span><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">OFFSET_NAMES</a>[] =</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>{</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    <span class="stringliteral">&quot;OPEN&quot;</span>,</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    <span class="stringliteral">&quot;CLOSE&quot;</span>,</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    <span class="stringliteral">&quot;CLOSET&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>};</div>
</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="keyword">extern</span> std::vector&lt;uint32_t&gt; <a class="code hl_function" href="UftMocker_8cpp.html#aeb6e1032b880b336183cbcbe7384b4d4">splitVolume</a>(uint32_t vol);</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="keyword">extern</span> std::vector&lt;double&gt; <a class="code hl_function" href="UftMocker_8cpp.html#aeb6e1032b880b336183cbcbe7384b4d4">splitVolume</a>(<span class="keywordtype">double</span> vol, <span class="keywordtype">double</span> minQty = 1.0, <span class="keywordtype">double</span> maxQty = 100.0, <span class="keywordtype">double</span> qtyTick = 1.0);</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="keyword">extern</span> uint32_t <a class="code hl_function" href="UftMocker_8cpp.html#a3f0f810d84c27185f9ec1851c8eac82b">genRand</a>(uint32_t maxVal = 10000);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="foldopen" id="foldopen00073" data-start="{" data-end="}">
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno"><a class="line" href="UftMocker_8cpp.html#a8b4b0de9002db5a602faa0b76d5bf356">   73</a></span><span class="keyword">inline</span> uint32_t <a class="code hl_function" href="UftMocker_8cpp.html#a8b4b0de9002db5a602faa0b76d5bf356">makeUftCtxId</a>()</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>{</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="keyword">static</span> std::atomic&lt;uint32_t&gt; _auto_context_id{ 7000 };</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="keywordflow">return</span> _auto_context_id.fetch_add(1);</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>}</div>
</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="foldopen" id="foldopen00085" data-start="{" data-end="}">
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno"><a class="line" href="classUftMocker.html#a464b7eb82180d1aae010361fa925b579">   85</a></span><a class="code hl_function" href="classUftMocker.html#a464b7eb82180d1aae010361fa925b579">UftMocker::UftMocker</a>(<a class="code hl_class" href="classHisDataReplayer.html">HisDataReplayer</a>* replayer, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    : <a class="code hl_class" href="classIUftStraCtx.html">IUftStraCtx</a>(name)</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    , _replayer(replayer)</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    , _strategy(<a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    , _use_newpx(false)</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    , _error_rate(0)</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    , _match_this_tick(false)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>{</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <a class="code hl_variable" href="classUftMocker.html#a7509f9633ab5f7e986ec7ffba3ccebc3">_context_id</a> = <a class="code hl_function" href="UftMocker_8cpp.html#a8b4b0de9002db5a602faa0b76d5bf356">makeUftCtxId</a>();</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>}</div>
</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="foldopen" id="foldopen00101" data-start="{" data-end="}">
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno"><a class="line" href="classUftMocker.html#adaad164f6540f0a98a69ed3e3a1d36a2">  101</a></span><a class="code hl_function" href="classUftMocker.html#adaad164f6540f0a98a69ed3e3a1d36a2">UftMocker::~UftMocker</a>()</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>{</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    {</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#a9e8430e87a127c702e7e8e8e89732c5f">_fact</a>-&gt;<a class="code hl_function" href="classIUftStrategyFact.html#a9bea8a862e75303e752245652e7cd96c">deleteStrategy</a>(<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>);</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    }</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>}</div>
</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="foldopen" id="foldopen00114" data-start="{" data-end="}">
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno"><a class="line" href="classUftMocker.html#a10286c31e65f9cfa510b9ccb1f79c31e">  114</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a10286c31e65f9cfa510b9ccb1f79c31e">UftMocker::procTask</a>()</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>{</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#af554869084300d5227dac1639c165196">_tasks</a>.empty())</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    {</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    }</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <a class="code hl_variable" href="classUftMocker.html#a93b2fcfd0004a1f071b3b1325e3945e8">_mtx_control</a>.lock();</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span> </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="keywordflow">while</span> (!<a class="code hl_variable" href="classUftMocker.html#af554869084300d5227dac1639c165196">_tasks</a>.empty())</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    {</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>        <a class="code hl_typedef" href="classUftMocker.html#a69c54d030844fd05177700555ba7194c">Task</a>&amp; task = <a class="code hl_variable" href="classUftMocker.html#af554869084300d5227dac1639c165196">_tasks</a>.front();</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>        task();</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        {</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            std::unique_lock&lt;std::mutex&gt; lck(<a class="code hl_variable" href="classUftMocker.html#aee8af1a927e4e93da6da8ec435c5fdd6">_mtx</a>);</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>            <a class="code hl_variable" href="classUftMocker.html#af554869084300d5227dac1639c165196">_tasks</a>.pop();</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        }</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <a class="code hl_variable" href="classUftMocker.html#a93b2fcfd0004a1f071b3b1325e3945e8">_mtx_control</a>.unlock();</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>}</div>
</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="foldopen" id="foldopen00143" data-start="{" data-end="}">
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno"><a class="line" href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">  143</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">UftMocker::postTask</a>(<a class="code hl_typedef" href="classUftMocker.html#a69c54d030844fd05177700555ba7194c">Task</a> task)</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>{</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    {</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        std::unique_lock&lt;std::mutex&gt; lck(<a class="code hl_variable" href="classUftMocker.html#aee8af1a927e4e93da6da8ec435c5fdd6">_mtx</a>);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <a class="code hl_variable" href="classUftMocker.html#af554869084300d5227dac1639c165196">_tasks</a>.push(task);</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="comment">//if(_thrd == NULL)</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">//{</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="comment">//  _thrd.reset(new std::thread([this](){</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="comment">//      while (!_stopped)</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="comment">//      {</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="comment">//          if(_tasks.empty())</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="comment">//          {</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="comment">//              std::this_thread::sleep_for(std::chrono::milliseconds(1));</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">//              continue;</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">//          }</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="comment">//          _mtx_control.lock();</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="comment">//          while(!_tasks.empty())</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="comment">//          {</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="comment">//              Task&amp; task = _tasks.front();</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <span class="comment">//              task();</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="comment">//              {</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="comment">//                  std::unique_lock&lt;std::mutex&gt; lck(_mtx);</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="comment">//                  _tasks.pop();</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <span class="comment">//              }</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="comment">//          }</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="comment">//          _mtx_control.unlock();</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="comment">//      }</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <span class="comment">//  }));</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="comment">//}</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>}</div>
</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="foldopen" id="foldopen00188" data-start="{" data-end="}">
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno"><a class="line" href="classUftMocker.html#ad988622a5baae466097e196432f2d7f6">  188</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classUftMocker.html#ad988622a5baae466097e196432f2d7f6">UftMocker::init_uft_factory</a>(<a class="code hl_class" href="classWTSVariant.html">WTSVariant</a>* cfg)</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>{</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="keywordflow">if</span> (cfg == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">module</span> = cfg-&gt;getCString(&quot;module&quot;);</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <a class="code hl_variable" href="classUftMocker.html#a1d59cab79c09ef3ad3831fcb68b1d8e1">_use_newpx</a> = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a597bf32bfe71fb040721dc65dc786df6">getBoolean</a>(<span class="stringliteral">&quot;use_newpx&quot;</span>);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <a class="code hl_variable" href="classUftMocker.html#a2e277763d6fab9e14a2fd72b10b543af">_error_rate</a> = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a9c09f146129a4f35dc04b490fef8887c">getUInt32</a>(<span class="stringliteral">&quot;error_rate&quot;</span>);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <a class="code hl_variable" href="classUftMocker.html#a991d3586964063f36305956b95fd9b92">_match_this_tick</a> = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a597bf32bfe71fb040721dc65dc786df6">getBoolean</a>(<span class="stringliteral">&quot;match_this_tick&quot;</span>);</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <a class="code hl_function" href="classUftMocker.html#a7add808e8aa139bb00ce608772ff674d">log_info</a>(<span class="stringliteral">&quot;UFT match params: use_newpx-{}, error_rate-{}, match_this_tick-{}&quot;</span>, <a class="code hl_variable" href="classUftMocker.html#a1d59cab79c09ef3ad3831fcb68b1d8e1">_use_newpx</a>, <a class="code hl_variable" href="classUftMocker.html#a2e277763d6fab9e14a2fd72b10b543af">_error_rate</a>, <a class="code hl_variable" href="classUftMocker.html#a991d3586964063f36305956b95fd9b92">_match_this_tick</a>);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <a class="code hl_typedef" href="DLLHelper_8hpp.html#a40972742af38c16d3ab2f521abf0ca8a">DllHandle</a> hInst = <a class="code hl_function" href="classDLLHelper.html#ac5d55450ea114206242d9ccbfd65ac82">DLLHelper::load_library</a>(module);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="keywordflow">if</span> (hInst == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <a class="code hl_typedef" href="UftStrategyDefs_8h.html#afbb7f624f81cc2bb8d42d16f0fd64ad5">FuncCreateUftStraFact</a> creator = (<a class="code hl_typedef" href="UftStrategyDefs_8h.html#afbb7f624f81cc2bb8d42d16f0fd64ad5">FuncCreateUftStraFact</a>)<a class="code hl_function" href="classDLLHelper.html#ae01c3a299dd418d0298d29fa5f5f9b2c">DLLHelper::get_symbol</a>(hInst, <span class="stringliteral">&quot;createStrategyFact&quot;</span>);</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="keywordflow">if</span> (creator == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    {</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        <a class="code hl_function" href="classDLLHelper.html#adbde89a530ae734c57506bf9639ccc65">DLLHelper::free_library</a>(hInst);</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    }</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#a275caaf80fd6d84140bf65fe92bb1591">_module_inst</a> = hInst;</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#a497600ec7f3950cc35188e2e4c5574a6">_module_path</a> = <span class="keyword">module</span>;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#ac8f06f9886f84533031bd8dad6fd6d17">_creator</a> = creator;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#a1e5095209d21343aa059cbeba9dc8b0b">_remover</a> = (<a class="code hl_typedef" href="UftStrategyDefs_8h.html#ad725e1d21fa13366664a6a3c56677272">FuncDeleteUftStraFact</a>)<a class="code hl_function" href="classDLLHelper.html#ae01c3a299dd418d0298d29fa5f5f9b2c">DLLHelper::get_symbol</a>(hInst, <span class="stringliteral">&quot;deleteStrategyFact&quot;</span>);</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#a9e8430e87a127c702e7e8e8e89732c5f">_fact</a> = <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#ac8f06f9886f84533031bd8dad6fd6d17">_creator</a>();</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <a class="code hl_class" href="classWTSVariant.html">WTSVariant</a>* cfgStra = cfg-&gt;<a class="code hl_function" href="classWTSVariant.html#a4dacb2b4afd195d05dedb5323d7982f3">get</a>(<span class="stringliteral">&quot;strategy&quot;</span>);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="keywordflow">if</span>(cfgStra)</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    {</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a> = <a class="code hl_variable" href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">_factory</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFactInfo.html#a9e8430e87a127c702e7e8e8e89732c5f">_fact</a>-&gt;<a class="code hl_function" href="classIUftStrategyFact.html#a0c6b7a8ecfa7c0ebe990a2ce8bcbdd30">createStrategy</a>(cfgStra-&gt;<a class="code hl_function" href="classWTSVariant.html#a830db11fc8daceff409fdbebaa7bea8a">getCString</a>(<span class="stringliteral">&quot;name&quot;</span>), <span class="stringliteral">&quot;uft&quot;</span>);</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a87eea5fd7b5d63e52a0019f164a1c234">init</a>(cfgStra-&gt;<a class="code hl_function" href="classWTSVariant.html#a4dacb2b4afd195d05dedb5323d7982f3">get</a>(<span class="stringliteral">&quot;params&quot;</span>));</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>}</div>
</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="foldopen" id="foldopen00237" data-start="{" data-end="}">
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno"><a class="line" href="classUftMocker.html#ab69fde97b863030a99ba736f46dd64a1">  237</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ab69fde97b863030a99ba736f46dd64a1">UftMocker::handle_tick</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* curTick, uint32_t pxType)</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>{</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <a class="code hl_function" href="classUftMocker.html#ac83dda60dfa0874931852c13362eec54">on_tick</a>(stdCode, curTick);</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>}</div>
</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span> </div>
<div class="foldopen" id="foldopen00248" data-start="{" data-end="}">
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno"><a class="line" href="classUftMocker.html#a72e899a1ed9ac09ce26a11c90cbb5cb1">  248</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a72e899a1ed9ac09ce26a11c90cbb5cb1">UftMocker::handle_order_detail</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSOrdDtlData.html">WTSOrdDtlData</a>* curOrdDtl)</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>{</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <a class="code hl_function" href="classUftMocker.html#a55646aca3a8637d8cbb31087077af2f0">on_order_detail</a>(stdCode, curOrdDtl);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>}</div>
</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="foldopen" id="foldopen00259" data-start="{" data-end="}">
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno"><a class="line" href="classUftMocker.html#a44413fc9146e581a4ffafa1c6195613b">  259</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a44413fc9146e581a4ffafa1c6195613b">UftMocker::handle_order_queue</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSOrdQueData.html">WTSOrdQueData</a>* curOrdQue)</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>{</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <a class="code hl_function" href="classUftMocker.html#a7bd43e347f7143ea260a63a2650c9884">on_order_queue</a>(stdCode, curOrdQue);</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>}</div>
</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="foldopen" id="foldopen00270" data-start="{" data-end="}">
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno"><a class="line" href="classUftMocker.html#ae091f6c4053a526d76df2a9bac52b1b5">  270</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ae091f6c4053a526d76df2a9bac52b1b5">UftMocker::handle_transaction</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTransData.html">WTSTransData</a>* curTrans)</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>{</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <a class="code hl_function" href="classUftMocker.html#ab86556731170989deaf8223afc3f59b0">on_transaction</a>(stdCode, curTrans);</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>}</div>
</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="foldopen" id="foldopen00283" data-start="{" data-end="}">
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno"><a class="line" href="classUftMocker.html#a671e6ebc483bcead9afdc9ba5252ff61">  283</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a671e6ebc483bcead9afdc9ba5252ff61">UftMocker::handle_bar_close</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keyword">const</span> <span class="keywordtype">char</span>* period, uint32_t times, <a class="code hl_struct" href="structWTSBarStruct.html">WTSBarStruct</a>* newBar)</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>{</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    <a class="code hl_function" href="classUftMocker.html#a1c6db7dabeb1297eae8787929c05b60a">on_bar</a>(stdCode, period, times, newBar);</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>}</div>
</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="foldopen" id="foldopen00293" data-start="{" data-end="}">
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno"><a class="line" href="classUftMocker.html#a2eb6c21fa2f765e719b0344b54833d15">  293</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a2eb6c21fa2f765e719b0344b54833d15">UftMocker::handle_init</a>()</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>{</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <a class="code hl_function" href="classUftMocker.html#ae9ab1bbb74eaf6ecf0e493517078e1a1">on_init</a>();</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <a class="code hl_function" href="classUftMocker.html#aaab672033c90dc3bc142c2037b5ab7c4">on_channel_ready</a>();</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>}</div>
</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="foldopen" id="foldopen00305" data-start="{" data-end="}">
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno"><a class="line" href="classUftMocker.html#a80404593eb7d4a14500cd4e3a13458c8">  305</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a80404593eb7d4a14500cd4e3a13458c8">UftMocker::handle_schedule</a>(uint32_t uDate, uint32_t uTime)</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>{</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="comment">//on_schedule(uDate, uTime);</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>}</div>
</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="foldopen" id="foldopen00315" data-start="{" data-end="}">
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="classUftMocker.html#abdc7f2fe277c08e0f82a8f857430148d">  315</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#abdc7f2fe277c08e0f82a8f857430148d">UftMocker::handle_session_begin</a>(uint32_t curTDate)</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>{</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    <a class="code hl_function" href="classUftMocker.html#a9576a3a77dd3cefde8ddcba3e941f4a6">on_session_begin</a>(curTDate);</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>}</div>
</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="foldopen" id="foldopen00325" data-start="{" data-end="}">
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno"><a class="line" href="classUftMocker.html#aa4dae33dafe0108c778f8f0939dd22e5">  325</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#aa4dae33dafe0108c778f8f0939dd22e5">UftMocker::handle_session_end</a>(uint32_t curTDate)</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>{</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    <a class="code hl_function" href="classUftMocker.html#ad3147ad051ffc059fc356c2c8221ae30">on_session_end</a>(curTDate);</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>}</div>
</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span> </div>
<div class="foldopen" id="foldopen00335" data-start="{" data-end="}">
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno"><a class="line" href="classUftMocker.html#a96bcaf32225f45c8553d9a992caf3c82">  335</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a96bcaf32225f45c8553d9a992caf3c82">UftMocker::handle_replay_done</a>()</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>{</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <a class="code hl_function" href="classUftMocker.html#ad4285e507d7c8ff86b75e4cfdae7e76a">dump_outputs</a>();</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    this-&gt;<a class="code hl_function" href="classIUftStraCtx.html#ab470dc72c32d6717788cf853eb70f6c3">on_bactest_end</a>();</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>}</div>
</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="foldopen" id="foldopen00350" data-start="{" data-end="}">
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno"><a class="line" href="classUftMocker.html#a1c6db7dabeb1297eae8787929c05b60a">  350</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a1c6db7dabeb1297eae8787929c05b60a">UftMocker::on_bar</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keyword">const</span> <span class="keywordtype">char</span>* period, uint32_t times, <a class="code hl_struct" href="structWTSBarStruct.html">WTSBarStruct</a>* newBar)</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>{</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a07685764a6c3c024ddcf4bbc13865761">on_bar</a>(<span class="keyword">this</span>, stdCode, period, times, newBar);</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>}</div>
</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="foldopen" id="foldopen00365" data-start="{" data-end="}">
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno"><a class="line" href="classUftMocker.html#ac83dda60dfa0874931852c13362eec54">  365</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ac83dda60dfa0874931852c13362eec54">UftMocker::on_tick</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* newTick)</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>{</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <a class="code hl_variable" href="classUftMocker.html#a3d3d44e1f3370b3bb655d5a7d25ae46b">_price_map</a>[stdCode] = newTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>();</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    {</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        std::unique_lock&lt;std::recursive_mutex&gt; lck(<a class="code hl_variable" href="classUftMocker.html#a93b2fcfd0004a1f071b3b1325e3945e8">_mtx_control</a>);</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    }</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <a class="code hl_function" href="classUftMocker.html#a1d0403941dd029f7e26c45f5faffda21">update_dyn_profit</a>(stdCode, newTick);</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <span class="comment">//如果开启了同tick撮合，则先触发策略的ontick，再处理订单</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    <span class="comment">//如果没开启同tick撮合，则先处理订单，再触发策略的ontick</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classUftMocker.html#a991d3586964063f36305956b95fd9b92">_match_this_tick</a>)</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        <a class="code hl_function" href="classUftMocker.html#acc3cc7b1b3141a71be1e197c6dfe7bc6">on_tick_updated</a>(stdCode, newTick);</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        <a class="code hl_function" href="classUftMocker.html#a10286c31e65f9cfa510b9ccb1f79c31e">procTask</a>();</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span> </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.empty())</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>            <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> ids;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.begin(); it != <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.end(); it++)</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>            {</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>                uint32_t localid = it-&gt;first;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>                ids.emplace_back(localid);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>            }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>            <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> to_erase;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>            <span class="keywordflow">for</span> (uint32_t localid : ids)</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>            {</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                <span class="keywordtype">bool</span> bNeedErase = <a class="code hl_function" href="classUftMocker.html#ad43d8223a63e34c1a43b1ade2e861c3a">procOrder</a>(localid);</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                <span class="keywordflow">if</span> (bNeedErase)</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                    to_erase.emplace_back(localid);</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>            }</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            <span class="keywordflow">for</span> (uint32_t localid : to_erase)</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>            {</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                <span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.find(localid);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.erase(it);</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>            }</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        }</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    }</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    {</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.empty())</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        {</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>            <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> ids;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.begin(); it != <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.end(); it++)</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>            {</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>                uint32_t localid = it-&gt;first;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>                <span class="keywordtype">bool</span> bNeedErase = <a class="code hl_function" href="classUftMocker.html#ad43d8223a63e34c1a43b1ade2e861c3a">procOrder</a>(localid);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>                <span class="keywordflow">if</span> (bNeedErase)</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>                    ids.emplace_back(localid);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>            }</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>            <span class="keywordflow">for</span> (uint32_t localid : ids)</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>            {</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>                <span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.find(localid);</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>                <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.erase(it);</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>            }</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>        }</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        <a class="code hl_function" href="classUftMocker.html#acc3cc7b1b3141a71be1e197c6dfe7bc6">on_tick_updated</a>(stdCode, newTick);</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        <a class="code hl_function" href="classUftMocker.html#a10286c31e65f9cfa510b9ccb1f79c31e">procTask</a>();</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    }</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>}</div>
</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span> </div>
<div class="foldopen" id="foldopen00439" data-start="{" data-end="}">
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno"><a class="line" href="classUftMocker.html#acc3cc7b1b3141a71be1e197c6dfe7bc6">  439</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#acc3cc7b1b3141a71be1e197c6dfe7bc6">UftMocker::on_tick_updated</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* newTick)</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>{</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a2392a6d5b1ce2fe3b14f9c8f10668c87">_tick_subs</a>.find(stdCode);</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="keywordflow">if</span> (it == <a class="code hl_variable" href="classUftMocker.html#a2392a6d5b1ce2fe3b14f9c8f10668c87">_tick_subs</a>.end())</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#aae1adc53245ba4955572c46fc38858e8">on_tick</a>(<span class="keyword">this</span>, stdCode, newTick);</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>}</div>
</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="foldopen" id="foldopen00455" data-start="{" data-end="}">
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno"><a class="line" href="classUftMocker.html#a7bd43e347f7143ea260a63a2650c9884">  455</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a7bd43e347f7143ea260a63a2650c9884">UftMocker::on_order_queue</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSOrdQueData.html">WTSOrdQueData</a>* newOrdQue)</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>{</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <a class="code hl_function" href="classUftMocker.html#a8b3921b1fe9e74af9aead5161065316e">on_ordque_updated</a>(stdCode, newOrdQue);</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>}</div>
</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span> </div>
<div class="foldopen" id="foldopen00466" data-start="{" data-end="}">
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno"><a class="line" href="classUftMocker.html#a8b3921b1fe9e74af9aead5161065316e">  466</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a8b3921b1fe9e74af9aead5161065316e">UftMocker::on_ordque_updated</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSOrdQueData.html">WTSOrdQueData</a>* newOrdQue)</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>{</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a88591358174dd9461cca04f201cf1aa4">on_order_queue</a>(<span class="keyword">this</span>, stdCode, newOrdQue);</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>}</div>
</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span> </div>
<div class="foldopen" id="foldopen00478" data-start="{" data-end="}">
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno"><a class="line" href="classUftMocker.html#a55646aca3a8637d8cbb31087077af2f0">  478</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a55646aca3a8637d8cbb31087077af2f0">UftMocker::on_order_detail</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSOrdDtlData.html">WTSOrdDtlData</a>* newOrdDtl)</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>{</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    <a class="code hl_function" href="classUftMocker.html#a3a11453469b65ee280d68d5f61ae3f37">on_orddtl_updated</a>(stdCode, newOrdDtl);</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>}</div>
</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="foldopen" id="foldopen00489" data-start="{" data-end="}">
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno"><a class="line" href="classUftMocker.html#a3a11453469b65ee280d68d5f61ae3f37">  489</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a3a11453469b65ee280d68d5f61ae3f37">UftMocker::on_orddtl_updated</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSOrdDtlData.html">WTSOrdDtlData</a>* newOrdDtl)</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>{</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a9cf8f2f604cb403ad13e5b71004e934d">on_order_detail</a>(<span class="keyword">this</span>, stdCode, newOrdDtl);</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>}</div>
</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span> </div>
<div class="foldopen" id="foldopen00501" data-start="{" data-end="}">
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno"><a class="line" href="classUftMocker.html#ab86556731170989deaf8223afc3f59b0">  501</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ab86556731170989deaf8223afc3f59b0">UftMocker::on_transaction</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTransData.html">WTSTransData</a>* newTrans)</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>{</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <a class="code hl_function" href="classUftMocker.html#a5c61fb0db4b2645df23b85025fada9a7">on_trans_updated</a>(stdCode, newTrans);</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>}</div>
</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="foldopen" id="foldopen00512" data-start="{" data-end="}">
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno"><a class="line" href="classUftMocker.html#a5c61fb0db4b2645df23b85025fada9a7">  512</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a5c61fb0db4b2645df23b85025fada9a7">UftMocker::on_trans_updated</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTransData.html">WTSTransData</a>* newTrans)</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>{</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a19053a3ce1b415f5a0ab502820dd7c76">on_transaction</a>(<span class="keyword">this</span>, stdCode, newTrans);</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>}</div>
</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="foldopen" id="foldopen00523" data-start="{" data-end="}">
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno"><a class="line" href="classUftMocker.html#abb3853101bf75b4cdd0f81b7d5a9608c">  523</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#abb3853101bf75b4cdd0f81b7d5a9608c">UftMocker::id</a>()</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>{</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#a7509f9633ab5f7e986ec7ffba3ccebc3">_context_id</a>;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>}</div>
</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="foldopen" id="foldopen00532" data-start="{" data-end="}">
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno"><a class="line" href="classUftMocker.html#ae9ab1bbb74eaf6ecf0e493517078e1a1">  532</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ae9ab1bbb74eaf6ecf0e493517078e1a1">UftMocker::on_init</a>()</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>{</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a8af8a93d09a2b86e1fcaf76c0ae1c3cd">on_init</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>}</div>
</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="foldopen" id="foldopen00544" data-start="{" data-end="}">
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno"><a class="line" href="classUftMocker.html#a9576a3a77dd3cefde8ddcba3e941f4a6">  544</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a9576a3a77dd3cefde8ddcba3e941f4a6">UftMocker::on_session_begin</a>(uint32_t curTDate)</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>{</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="comment">//每个交易日开始，要把冻结持仓置零</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; it : <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>)</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    {</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>        <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode = it.first.c_str();</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pInfo = (<a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp;)it.second;</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(pInfo.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a527cc37fe66d31082889d268ffb89201">frozen</a>(), 0))</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>        {</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>            <a class="code hl_function" href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">log_debug</a>(<span class="stringliteral">&quot;{} frozen of {} released on {}&quot;</span>, pInfo.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a527cc37fe66d31082889d268ffb89201">frozen</a>(), stdCode, curTDate);</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>            pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#ab0c72ae56c149e4a2235920d1da3a080">_prevol</a> += pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a>;</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>            pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a> = pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#ab0c72ae56c149e4a2235920d1da3a080">_prevol</a>;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span> </div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>            pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a> = 0;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>            pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> = 0;</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        }</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    }</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a615cb54b12e29a2a9842b3cd9dc19fbf">on_session_begin</a>(<span class="keyword">this</span>, curTDate);</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>}</div>
</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span> </div>
<div class="foldopen" id="foldopen00572" data-start="{" data-end="}">
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno"><a class="line" href="classUftMocker.html#ad3147ad051ffc059fc356c2c8221ae30">  572</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ad3147ad051ffc059fc356c2c8221ae30">UftMocker::on_session_end</a>(uint32_t curTDate)</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>{</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a03cb318bec5fda26243f8e08504ff30c">on_session_end</a>(<span class="keyword">this</span>, curTDate);</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span> </div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    uint32_t curDate = curTDate;<span class="comment">// _replayer-&gt;get_trading_date();</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="keywordtype">double</span> total_profit = 0;</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="keywordtype">double</span> total_dynprofit = 0;</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span> </div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>.begin(); it != <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>.end(); it++)</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    {</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode = it-&gt;first.c_str();</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = it-&gt;second;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        total_profit += pInfo.<a class="code hl_function" href="structUftMocker_1_1__PosInfo.html#a57418808c10ebce5ec37d09abed26103">closeprofit</a>();</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        total_dynprofit += pInfo.<a class="code hl_function" href="structUftMocker_1_1__PosInfo.html#a3d25c0fc4948708303ef56f39e1b1fc8">dynprofit</a>();</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>(), 0.0))</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            <a class="code hl_variable" href="classUftMocker.html#a074d811c5a8ecaf5dbba6e2f6ec4e282">_pos_logs</a> &lt;&lt; fmt::format(<span class="stringliteral">&quot;{},{},LONG,{},{:.2f},{:.2f}\n&quot;</span>, curTDate, stdCode, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>(), pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aabd6cea7cdfcb46fc78881afecd27416">_closeprofit</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a>);</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>(), 0.0))</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>            <a class="code hl_variable" href="classUftMocker.html#a074d811c5a8ecaf5dbba6e2f6ec4e282">_pos_logs</a> &lt;&lt; fmt::format(<span class="stringliteral">&quot;{},{},LONG,{},{:.2f},{:.2f}\n&quot;</span>, curTDate, stdCode, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>(), pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aabd6cea7cdfcb46fc78881afecd27416">_closeprofit</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a>);</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    }</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    <a class="code hl_variable" href="classUftMocker.html#a8e63abbbd43a222d3f5dbff64cfad3c0">_fund_logs</a> &lt;&lt; fmt::format(<span class="stringliteral">&quot;{},{:.2f},{:.2f},{:.2f},{:.2f}\n&quot;</span>, curDate,</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>        <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af1e40ea145db43d10cef779ea032d3c5">_total_profit</a>, <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#a47a46c2dcf1437e74271e28e4280bf46">_total_dynprofit</a>,</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af1e40ea145db43d10cef779ea032d3c5">_total_profit</a> + <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#a47a46c2dcf1437e74271e28e4280bf46">_total_dynprofit</a> - <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af030f8da92d1eae43249aa1302731d77">_total_fees</a>, <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af030f8da92d1eae43249aa1302731d77">_total_fees</a>);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>}</div>
</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="foldopen" id="foldopen00607" data-start="{" data-end="}">
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno"><a class="line" href="classUftMocker.html#ae8cc5f82941a13e61dbdd8cd10ae157b">  607</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classUftMocker.html#ae8cc5f82941a13e61dbdd8cd10ae157b">UftMocker::stra_get_undone</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>{</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    <span class="keywordtype">double</span> ret = 0;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.begin(); it != <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.end(); it++)</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    {</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp; ordInfo = it-&gt;second;</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="keywordflow">if</span> (strcmp(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, stdCode) == 0)</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        {</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            ret += ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> * ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> ? 1 : -1;</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        }</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    }</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span> </div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>}</div>
</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span> </div>
<div class="foldopen" id="foldopen00633" data-start="{" data-end="}">
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno"><a class="line" href="classUftMocker.html#a0b14656f5386b6213a6661cdfeba631a">  633</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classUftMocker.html#a0b14656f5386b6213a6661cdfeba631a">UftMocker::stra_cancel</a>(uint32_t localid)</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>{</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    <a class="code hl_function" href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">postTask</a>([<span class="keyword">this</span>, localid](){</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.find(localid);</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        <span class="keywordflow">if</span> (it == <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.end())</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        <a class="code hl_class" href="classStdLocker.html">StdLocker&lt;StdRecurMutex&gt;</a> lock(<a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>);</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>        <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp; ordInfo = (<a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp;)it-&gt;second;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>        </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        <span class="keywordflow">if</span> (ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a> != 0)</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        {</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>            <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>];</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> ? pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a> : pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>            <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>);</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>            <span class="keywordflow">if</span>(commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a1fe9a4acdce011c67dfcee7b0c7c8117">getCoverMode</a>() == <a class="code hl_enumvalue" href="WTSTypes_8h.html#a5749fa649fc95e5e117ad7002b77bb2ba0b35236fa9a83b8fb1e8f4ed203f3bdd">CM_CoverToday</a>)</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>            {</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>                <span class="keywordflow">if</span> (ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a> == 2)</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>                    pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> += ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>;</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>                    pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a> += ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>;</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>            }</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            {</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                <span class="comment">//如果不分平昨平今，则先释放今仓</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>                <span class="keywordtype">double</span> maxQty = std::min(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a> - pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a>);</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>                pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> += maxQty;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>                pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a> += ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> - maxQty;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>            }</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        }</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>        <a class="code hl_function" href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">log_debug</a>(<span class="stringliteral">&quot;Order {} canceled, action: {} {} @ {}({})&quot;</span>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6b89253114d64c114fd65e9fde0e6319">_localid</a>, <a class="code hl_variable" href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">OFFSET_NAMES</a>[ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>], ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a>?<span class="stringliteral">&quot;long&quot;</span>:<span class="stringliteral">&quot;short&quot;</span>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>);</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> = 0;</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>        <a class="code hl_function" href="classUftMocker.html#a305c7de64825fb5f5644709931768025">on_order</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.erase(it);</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>    });</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>}</div>
</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="foldopen" id="foldopen00680" data-start="{" data-end="}">
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno"><a class="line" href="classUftMocker.html#aa15f8fa21f867d8ad1e8af76ca9e81a3">  680</a></span><a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> <a class="code hl_function" href="classUftMocker.html#aa15f8fa21f867d8ad1e8af76ca9e81a3">UftMocker::stra_cancel_all</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>{</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> ret;</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    uint32_t cnt = 0;</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.begin(); it != <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.end(); it++)</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    {</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp; ordInfo = it-&gt;second;</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        <span class="keywordflow">if</span>(strcmp(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, stdCode) == 0)</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>        {</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>            <a class="code hl_function" href="classUftMocker.html#a0b14656f5386b6213a6661cdfeba631a">stra_cancel</a>(it-&gt;first);</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        }</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>    }</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span> </div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>}</div>
</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span> </div>
<div class="foldopen" id="foldopen00709" data-start="{" data-end="}">
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno"><a class="line" href="classUftMocker.html#a9e1509a8885e226a573b53a9d59cd3f1">  709</a></span><a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> <a class="code hl_function" href="classUftMocker.html#a9e1509a8885e226a573b53a9d59cd3f1">UftMocker::stra_buy</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">int</span> flag <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>{</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    {</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Cannot find corresponding commodity info of {}&quot;</span>, stdCode);</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a>();</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>    }</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a6de5f873ba0191bdd61bf1870cd18b81">decimal::le</a>(qty, 0))</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>    {</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: qty {} &lt;= 0&quot;</span>, qty);</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a>();</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    }</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span> </div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>    <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> ids;</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>    <span class="keywordtype">double</span> left = qty;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>    <span class="comment">//先检查空头</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>;</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>(), 0.0))</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    {</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>        <span class="keywordflow">if</span>(commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a1fe9a4acdce011c67dfcee7b0c7c8117">getCoverMode</a>() != <a class="code hl_enumvalue" href="WTSTypes_8h.html#a5749fa649fc95e5e117ad7002b77bb2ba0b35236fa9a83b8fb1e8f4ed203f3bdd">CM_CoverToday</a>)</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>        {</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>            <span class="keywordtype">double</span> maxQty = std::min(left, pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>());</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(maxQty, 0.0))</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>            {</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                uint32_t localid = <a class="code hl_function" href="classUftMocker.html#a371afcdbcc32aa313051398f10069ae1">stra_exit_short</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, maxQty, <span class="keyword">false</span>, 0);</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                <span class="keywordflow">if</span> (localid != 0) ids.emplace_back(localid);</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>            }</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>            left -= maxQty;</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        }</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>        {</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>            <span class="keywordtype">double</span> maxQty = std::min(left, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>);</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(maxQty, 0.0))</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>            {</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>                uint32_t localid = <a class="code hl_function" href="classUftMocker.html#a371afcdbcc32aa313051398f10069ae1">stra_exit_short</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, maxQty, <span class="keyword">false</span>, 0);</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                <span class="keywordflow">if</span> (localid != 0) ids.emplace_back(localid);</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>            }</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>            left -= maxQty;</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span> </div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>            maxQty = std::min(left, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a>);</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(maxQty, 0.0))</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>            {</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                uint32_t localid = <a class="code hl_function" href="classUftMocker.html#a371afcdbcc32aa313051398f10069ae1">stra_exit_short</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, maxQty, <span class="keyword">true</span>, 0);</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>                <span class="keywordflow">if</span> (localid != 0) ids.emplace_back(localid);</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>            }</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>            left -= maxQty;</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>        }</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    }</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span> </div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    <span class="comment">//还有剩余则开仓</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(left, 0.0))</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>    {</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>        ids.emplace_back(<a class="code hl_function" href="classUftMocker.html#a8002fb17cc11e7bb3ec4cb467a34f150">stra_enter_long</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, left));</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>    }</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span> </div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    <span class="keywordflow">return</span> ids;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>}</div>
</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span> </div>
<div class="foldopen" id="foldopen00783" data-start="{" data-end="}">
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno"><a class="line" href="classUftMocker.html#afed7220165228852ce704691a3fca182">  783</a></span><a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> <a class="code hl_function" href="classUftMocker.html#afed7220165228852ce704691a3fca182">UftMocker::stra_sell</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">int</span> flag <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>{</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>    {</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Cannot find corresponding commodity info of {}&quot;</span>, stdCode);</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a>();</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    }</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span> </div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a6de5f873ba0191bdd61bf1870cd18b81">decimal::le</a>(qty, 0))</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>    {</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: qty {} &lt;= 0&quot;</span>, qty);</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a>();</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    }</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span> </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    <a class="code hl_typedef" href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a> ids;</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span> </div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    <span class="keywordtype">double</span> left = qty;</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    <span class="comment">//先检查空头</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>;</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>(), 0.0))</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>    {</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        <span class="keywordflow">if</span> (commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a1fe9a4acdce011c67dfcee7b0c7c8117">getCoverMode</a>() != <a class="code hl_enumvalue" href="WTSTypes_8h.html#a5749fa649fc95e5e117ad7002b77bb2ba0b35236fa9a83b8fb1e8f4ed203f3bdd">CM_CoverToday</a>)</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        {</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            <span class="keywordtype">double</span> maxQty = std::min(left, pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>());</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(maxQty, 0.0))</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>            {</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                uint32_t localid = <a class="code hl_function" href="classUftMocker.html#a03dfc265a143669b643a83132aeb329b">stra_exit_long</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, maxQty, <span class="keyword">false</span>, 0);</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                <span class="keywordflow">if</span> (localid != 0) ids.emplace_back(localid);</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>            }</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span> </div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>            left -= maxQty;</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        }</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>        {</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>            <span class="keywordtype">double</span> maxQty = std::min(left, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>);</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(maxQty, 0.0))</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>            {</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>                uint32_t localid = <a class="code hl_function" href="classUftMocker.html#a03dfc265a143669b643a83132aeb329b">stra_exit_long</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, maxQty, <span class="keyword">false</span>, 0);</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>                <span class="keywordflow">if</span> (localid != 0) ids.emplace_back(localid);</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>            }</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>            left -= maxQty;</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span> </div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>            maxQty = std::min(left, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a>);</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(maxQty, 0.0))</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>            {</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>                uint32_t localid = <a class="code hl_function" href="classUftMocker.html#a03dfc265a143669b643a83132aeb329b">stra_exit_long</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, maxQty, <span class="keyword">true</span>, 0);</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>                <span class="keywordflow">if</span> (localid != 0) ids.emplace_back(localid);</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>            }</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>            left -= maxQty;</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        }</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>    }</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span> </div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    <span class="comment">//还有剩余则开仓</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(left, 0.0))</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    {</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>        ids.emplace_back(<a class="code hl_function" href="classUftMocker.html#af755aba192acae21e4ec196fcdd2c4b4">stra_enter_short</a>(stdCode, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, left));</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    }</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span> </div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>    <span class="keywordflow">return</span> ids;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>}</div>
</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span> </div>
<div class="foldopen" id="foldopen00857" data-start="{" data-end="}">
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno"><a class="line" href="classUftMocker.html#a8002fb17cc11e7bb3ec4cb467a34f150">  857</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#a8002fb17cc11e7bb3ec4cb467a34f150">UftMocker::stra_enter_long</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">int</span> flag <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>{</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>    <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    {</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Cannot find corresponding commodity info of {}&quot;</span>, stdCode);</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    }</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span> </div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a6de5f873ba0191bdd61bf1870cd18b81">decimal::le</a>(qty, 0))</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    {</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: qty {} &lt;= 0&quot;</span>, qty);</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    }</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span> </div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    uint32_t localid = <a class="code hl_function" href="ExecMocker_8cpp.html#a53cef3aa4a728448c19e95d927d87329">makeLocalOrderID</a>();</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a> order;</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6b89253114d64c114fd65e9fde0e6319">_localid</a> = localid;</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>    strcpy(order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, stdCode);</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a> = 0;</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a> = <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>;</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a> = qty;</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> = qty;</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span> </div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>    {</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.lock();</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>        <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid] = order;</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.unlock();</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>    }</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span> </div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>    <a class="code hl_function" href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">postTask</a>([<span class="keyword">this</span>, localid]() {</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp; ordInfo = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid];</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>        <a class="code hl_function" href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">log_debug</a>(<span class="stringliteral">&quot;order placed: open long of {} @ {} by {}&quot;</span>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>);</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>        <a class="code hl_function" href="classUftMocker.html#af674be55e62dc791cfb68ba36335d6de">on_entrust</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, <span class="keyword">true</span>, <span class="stringliteral">&quot;entrust success&quot;</span>);</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>    });</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    <span class="keywordflow">return</span> localid;</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>}</div>
</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span> </div>
<div class="foldopen" id="foldopen00909" data-start="{" data-end="}">
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno"><a class="line" href="classUftMocker.html#af755aba192acae21e4ec196fcdd2c4b4">  909</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#af755aba192acae21e4ec196fcdd2c4b4">UftMocker::stra_enter_short</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">int</span> flag <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>{</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>    {</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Cannot find corresponding commodity info of {}&quot;</span>, stdCode);</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    }</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span> </div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a6de5f873ba0191bdd61bf1870cd18b81">decimal::le</a>(qty, 0))</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>    {</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>        <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: qty {} &lt;= 0&quot;</span>, qty);</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    }</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span> </div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>    uint32_t localid = <a class="code hl_function" href="ExecMocker_8cpp.html#a53cef3aa4a728448c19e95d927d87329">makeLocalOrderID</a>();</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span> </div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a> order;</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6b89253114d64c114fd65e9fde0e6319">_localid</a> = localid;</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>    strcpy(order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, stdCode);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a> = 0;</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a> = <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>;</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a> = qty;</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> = qty;</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span> </div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>    {</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.lock();</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>        <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid] = order;</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.unlock();</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>    }</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>    <a class="code hl_function" href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">postTask</a>([<span class="keyword">this</span>, localid]() {</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp; ordInfo = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid];</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>        <a class="code hl_function" href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">log_debug</a>(<span class="stringliteral">&quot;order placed: open short of {} @ {} by {}&quot;</span>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>);</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>        <a class="code hl_function" href="classUftMocker.html#af674be55e62dc791cfb68ba36335d6de">on_entrust</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, <span class="keyword">true</span>, <span class="stringliteral">&quot;entrust success&quot;</span>);</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    });</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span> </div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    <span class="keywordflow">return</span> localid;</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>}</div>
</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span> </div>
<div class="foldopen" id="foldopen00963" data-start="{" data-end="}">
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno"><a class="line" href="classUftMocker.html#a03dfc265a143669b643a83132aeb329b">  963</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#a03dfc265a143669b643a83132aeb329b">UftMocker::stra_exit_long</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">bool</span> isToday <span class="comment">/* = false */</span>, <span class="keywordtype">int</span> flag <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>{</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>    <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>    <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>;</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    uint32_t offset = 1;</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>    <span class="keywordflow">if</span>(commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a1fe9a4acdce011c67dfcee7b0c7c8117">getCoverMode</a>() != <a class="code hl_enumvalue" href="WTSTypes_8h.html#a5749fa649fc95e5e117ad7002b77bb2ba0b35236fa9a83b8fb1e8f4ed203f3bdd">CM_CoverToday</a>)</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    {</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>        <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>(), qty))</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>        {</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>            <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: no enough available position&quot;</span>);</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>        }</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>        <span class="keywordtype">double</span> maxQty = std::min(qty, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>);</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a> -= maxQty;</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> -= qty - maxQty;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    }</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    {</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>        <span class="keywordflow">if</span> (isToday) offset = 2;</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>        <span class="keywordtype">double</span> valid = isToday ? pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> : pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(valid, qty))</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>        {</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>            <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: no enough available {} position&quot;</span>, isToday?<span class="stringliteral">&quot;new&quot;</span>:<span class="stringliteral">&quot;old&quot;</span>);</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>        }</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span> </div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>        <span class="keywordflow">if</span> (isToday)</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> -= qty;</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a> -= qty;</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>    }</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span> </div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    uint32_t localid = <a class="code hl_function" href="ExecMocker_8cpp.html#a53cef3aa4a728448c19e95d927d87329">makeLocalOrderID</a>();</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a> order;</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6b89253114d64c114fd65e9fde0e6319">_localid</a> = localid;</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    strcpy(order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, stdCode);</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a> = offset;</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a> = <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a> = qty;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> = qty;</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span> </div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    {</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.lock();</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid] = order;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.unlock();</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    }</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span> </div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <a class="code hl_function" href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">postTask</a>([<span class="keyword">this</span>, localid]() {</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp; ordInfo = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid];</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>        <a class="code hl_function" href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">log_debug</a>(<span class="stringliteral">&quot;order placed: {} long of {} @ {} by {}&quot;</span>, <a class="code hl_variable" href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">OFFSET_NAMES</a>[ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>], ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>);</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        <a class="code hl_function" href="classUftMocker.html#af674be55e62dc791cfb68ba36335d6de">on_entrust</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, <span class="keyword">true</span>, <span class="stringliteral">&quot;entrust success&quot;</span>);</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    });</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span> </div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <span class="keywordflow">return</span> localid;</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>}</div>
</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span> </div>
<div class="foldopen" id="foldopen01037" data-start="{" data-end="}">
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"><a class="line" href="classUftMocker.html#a371afcdbcc32aa313051398f10069ae1"> 1037</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#a371afcdbcc32aa313051398f10069ae1">UftMocker::stra_exit_short</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">bool</span> isToday <span class="comment">/* = false */</span>, <span class="keywordtype">int</span> flag <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>{</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>    uint32_t offset = 1;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>    <span class="keywordflow">if</span> (commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a1fe9a4acdce011c67dfcee7b0c7c8117">getCoverMode</a>() != <a class="code hl_enumvalue" href="WTSTypes_8h.html#a5749fa649fc95e5e117ad7002b77bb2ba0b35236fa9a83b8fb1e8f4ed203f3bdd">CM_CoverToday</a>)</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    {</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>(), qty))</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>        {</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>            <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: no enough available position&quot;</span>);</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>        }</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span> </div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>        <span class="keywordtype">double</span> maxQty = std::min(qty, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>);</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a> -= maxQty;</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> -= qty - maxQty;</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    }</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>    {</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>        <span class="keywordflow">if</span> (isToday) offset = 2;</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span> </div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>        <span class="keywordtype">double</span> valid = isToday ? pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> : pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>;</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(valid, qty))</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>        {</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>            <a class="code hl_function" href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">log_error</a>(<span class="stringliteral">&quot;Entrust error: no enough available {} position&quot;</span>, isToday ? <span class="stringliteral">&quot;new&quot;</span> : <span class="stringliteral">&quot;old&quot;</span>);</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>        }</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span> </div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>        <span class="keywordflow">if</span> (isToday)</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> -= qty;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a> -= qty;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    }</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    uint32_t localid = <a class="code hl_function" href="ExecMocker_8cpp.html#a53cef3aa4a728448c19e95d927d87329">makeLocalOrderID</a>();</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span> </div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a> order;</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6b89253114d64c114fd65e9fde0e6319">_localid</a> = localid;</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    strcpy(order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, stdCode);</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a> = offset;</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a> = <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>;</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a> = qty;</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>    order.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> = qty;</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span> </div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    {</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.lock();</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>        <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid] = order;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>        <a class="code hl_variable" href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">_mtx_ords</a>.unlock();</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    }</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span> </div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    <a class="code hl_function" href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">postTask</a>([<span class="keyword">this</span>, localid]() {</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp; ordInfo = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>[localid];</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>        <a class="code hl_function" href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">log_debug</a>(<span class="stringliteral">&quot;order placed: {} short of {} @ {} by {}&quot;</span>, <a class="code hl_variable" href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">OFFSET_NAMES</a>[ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>], ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>);</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>        <a class="code hl_function" href="classUftMocker.html#af674be55e62dc791cfb68ba36335d6de">on_entrust</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, <span class="keyword">true</span>, <span class="stringliteral">&quot;entrust success&quot;</span>);</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    });</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span> </div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    <span class="keywordflow">return</span> localid;</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>}</div>
</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span> </div>
<div class="foldopen" id="foldopen01111" data-start="{" data-end="}">
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"><a class="line" href="classUftMocker.html#a305c7de64825fb5f5644709931768025"> 1111</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a305c7de64825fb5f5644709931768025">UftMocker::on_order</a>(uint32_t localid, <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> isLong, uint32_t offset, <span class="keywordtype">double</span> totalQty, <span class="keywordtype">double</span> leftQty, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">bool</span> isCanceled)</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>{</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a0dfcc40aebad51e8278c03f04d53fde3">on_order</a>(<span class="keyword">this</span>, localid, stdCode, isLong, offset, totalQty, leftQty, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, isCanceled);</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>}</div>
</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="foldopen" id="foldopen01128" data-start="{" data-end="}">
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"><a class="line" href="classUftMocker.html#adf95fedcd2a528aa0e54b4865220553f"> 1128</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#adf95fedcd2a528aa0e54b4865220553f">UftMocker::on_trade</a>(uint32_t localid, <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> isLong, uint32_t offset, <span class="keywordtype">double</span> vol, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>)</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>{</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    <span class="comment">//PosInfo&amp; posInfo = _pos_map[stdCode];</span></div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    <span class="comment">//PosItem&amp; posItem = isLong ? posInfo._long : posInfo._short;</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>    <a class="code hl_function" href="classUftMocker.html#af040581dfbad9adea966486ee63748cd">update_position</a>(stdCode, isLong, offset, vol, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>);</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#af31f56e653b3007f5e15ec20850e8497">on_trade</a>(<span class="keyword">this</span>, localid, stdCode, isLong, offset, vol, <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>);</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>}</div>
</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span> </div>
<div class="foldopen" id="foldopen01147" data-start="{" data-end="}">
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"><a class="line" href="classUftMocker.html#af674be55e62dc791cfb68ba36335d6de"> 1147</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#af674be55e62dc791cfb68ba36335d6de">UftMocker::on_entrust</a>(uint32_t localid, <span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> bSuccess, <span class="keyword">const</span> <span class="keywordtype">char</span>* message)</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>{</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#aabc6588308e279c287dd2f6bd6ea5768">on_entrust</a>(localid, bSuccess, message);</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>}</div>
</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span> </div>
<div class="foldopen" id="foldopen01160" data-start="{" data-end="}">
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"><a class="line" href="classUftMocker.html#aaab672033c90dc3bc142c2037b5ab7c4"> 1160</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#aaab672033c90dc3bc142c2037b5ab7c4">UftMocker::on_channel_ready</a>()</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>{</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>)</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#a7cc05494f8b238d263e4e9c7ea9750b1">on_channel_ready</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>}</div>
</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span> </div>
<div class="foldopen" id="foldopen01176" data-start="{" data-end="}">
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"><a class="line" href="classUftMocker.html#a1d0403941dd029f7e26c45f5faffda21"> 1176</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a1d0403941dd029f7e26c45f5faffda21">UftMocker::update_dyn_profit</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* newTick)</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>{</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>    <span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>.find(stdCode);</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>    <span class="keywordflow">if</span> (it != <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>.end())</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>    {</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>        <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>        <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = (<a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp;)it-&gt;second;</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        {</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>            <span class="keywordtype">bool</span> isLong = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>            <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>;</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>            <span class="keywordflow">if</span> (pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>() == 0)</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>                pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a> = 0;</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>            {</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>                <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> = isLong ? newTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a803d1804cb06e32d69064ecd253f1c9d">bidprice</a>(0) : newTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a235e2995d16b634c5edd5d4a45308302">askprice</a>(0);</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>                <span class="keywordtype">double</span> dynprofit = 0;</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>                <span class="keywordflow">for</span> (<span class="keyword">auto</span> pit = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.begin(); pit != pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end(); pit++)</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>                {</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span> </div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>                    <a class="code hl_struct" href="structUftMocker_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo = *pit;</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>                    dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a> = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>*(<a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> - dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">_price</a>)*commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">getVolScale</a>();</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>                    <span class="keywordflow">if</span> (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a> &gt; 0)</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>                        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a> = max(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a>, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a>);</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a> &lt; 0)</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>                        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a> = min(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a>, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a>);</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span> </div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>                    dynprofit += dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a>;</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>                }</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span> </div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>                pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a> = dynprofit;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>            }</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>        }</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span> </div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>        {</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>            <span class="keywordtype">bool</span> isLong = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>            <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>;</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>            <span class="keywordflow">if</span> (pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>() == 0)</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>                pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a> = 0;</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>            {</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>                <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> = isLong ? newTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a803d1804cb06e32d69064ecd253f1c9d">bidprice</a>(0) : newTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a235e2995d16b634c5edd5d4a45308302">askprice</a>(0);</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>                <span class="keywordtype">double</span> dynprofit = 0;</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>                <span class="keywordflow">for</span> (<span class="keyword">auto</span> pit = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.begin(); pit != pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end(); pit++)</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>                {</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span> </div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>                    <a class="code hl_struct" href="structUftMocker_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo = *pit;</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>                    dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a> = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>*(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">_price</a> - <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>)*commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">getVolScale</a>();</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>                    <span class="keywordflow">if</span> (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a> &gt; 0)</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>                        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a> = max(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a>, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a>);</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a> &lt; 0)</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>                        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a> = min(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a>, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a>);</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span> </div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>                    dynprofit += dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a>;</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>                }</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span> </div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>                pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a> = dynprofit;</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>            }</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>        }</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>    }</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>}</div>
</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span> </div>
<div class="foldopen" id="foldopen01246" data-start="{" data-end="}">
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"><a class="line" href="classUftMocker.html#ad43d8223a63e34c1a43b1ade2e861c3a"> 1246</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classUftMocker.html#ad43d8223a63e34c1a43b1ade2e861c3a">UftMocker::procOrder</a>(uint32_t localid)</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>{</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>    <span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.find(localid);</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    <span class="keywordflow">if</span> (it == <a class="code hl_variable" href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">_orders</a>.end())</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span> </div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>    <a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a> ordInfo = (<a class="code hl_struct" href="structUftMocker_1_1__OrderInfo.html">OrderInfo</a>&amp;)it-&gt;second;</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span> </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>    <span class="comment">//第一步,如果在撤单概率中,则执行撤单</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classUftMocker.html#a2e277763d6fab9e14a2fd72b10b543af">_error_rate</a>&gt;0 &amp;&amp; <a class="code hl_function" href="HftMocker_8cpp.html#a3f0f810d84c27185f9ec1851c8eac82b">genRand</a>(10000)&lt;=<a class="code hl_variable" href="classUftMocker.html#a2e277763d6fab9e14a2fd72b10b543af">_error_rate</a>)</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>    {</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>        <a class="code hl_function" href="classUftMocker.html#a305c7de64825fb5f5644709931768025">on_order</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>        <a class="code hl_function" href="classUftMocker.html#a7add808e8aa139bb00ce608772ff674d">log_info</a>(<span class="stringliteral">&quot;Random error order: {}&quot;</span>, localid);</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>    }</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>    {</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>        <a class="code hl_function" href="classUftMocker.html#a305c7de64825fb5f5644709931768025">on_order</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>    }</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span> </div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>    <a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* curTick = <a class="code hl_function" href="classUftMocker.html#ae6c7e021d7fac27b4cd076dcaa9a1dc3">stra_get_last_tick</a>(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>);</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>    <span class="keywordflow">if</span> (curTick == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span> </div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>    <span class="keywordtype">double</span> curPx = curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">price</a>();</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>    <span class="keywordtype">double</span> orderQty = ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> ? curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a2c374d0964b76835c0eaf1450a488302">askqty</a>(0) : curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a1428afc0bb0e6d1bb01be62bc5743631">bidqty</a>(0);    <span class="comment">//看对手盘的数量</span></div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(orderQty, 0.0))</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span> </div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classUftMocker.html#a1d59cab79c09ef3ad3831fcb68b1d8e1">_use_newpx</a>)</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>    {</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>        curPx = ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> ? curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a235e2995d16b634c5edd5d4a45308302">askprice</a>(0) : curTick-&gt;<a class="code hl_function" href="classWTSTickData.html#a803d1804cb06e32d69064ecd253f1c9d">bidprice</a>(0);</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>        <span class="comment">//if (curPx == 0.0)</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>        <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(curPx, 0.0))</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>        {</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>            curTick-&gt;<a class="code hl_function" href="classWTSPoolObject.html#a868f127b3ccc31cba6b077803cb00951">release</a>();</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>        }</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>    }</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>    curTick-&gt;<a class="code hl_function" href="classWTSPoolObject.html#a868f127b3ccc31cba6b077803cb00951">release</a>();</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span> </div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>    <span class="comment">//如果没有成交条件,则退出逻辑</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>    <span class="keywordflow">if</span>(!<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, 0.0))</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>    {</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>        <span class="keywordflow">if</span>(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> &amp;&amp; <a class="code hl_function" href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a>(curPx, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>))</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>        {</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>            <span class="comment">//买单,但是当前价大于限价,不成交</span></div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>        }</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span> </div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>        <span class="keywordflow">if</span> (!ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a> &amp;&amp; <a class="code hl_function" href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a>(curPx, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>))</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>        {</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>            <span class="comment">//卖单,但是当前价小于限价,不成交</span></div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>        }</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>    }</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span> </div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span><span class="comment">     *  下面就要模拟成交了</span></div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span><span class="comment">     */</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>    <span class="keywordtype">double</span> maxQty = min(orderQty, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>);</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>    <span class="keyword">auto</span> vols = <a class="code hl_function" href="TraderMocker_8cpp.html#a746d9fe0268c4f5fc9b934d7277ecdcf">splitVolume</a>((uint32_t)maxQty);</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>    <span class="keywordflow">for</span>(uint32_t curQty : vols)</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>    {</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        <a class="code hl_function" href="classUftMocker.html#adf95fedcd2a528aa0e54b4865220553f">on_trade</a>(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6b89253114d64c114fd65e9fde0e6319">_localid</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>, curQty, curPx);</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span> </div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>        ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a> -= curQty;</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>        <a class="code hl_function" href="classUftMocker.html#a305c7de64825fb5f5644709931768025">on_order</a>(localid, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">_code</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">_isLong</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">_offset</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">_total</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>, ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">_price</a>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>    }</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span> </div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>    <span class="comment">//if(ordInfo._left == 0)</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(ordInfo.<a class="code hl_variable" href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">_left</a>, 0.0))</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>    {</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>    }</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span> </div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>}</div>
</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span> </div>
<div class="foldopen" id="foldopen01333" data-start="{" data-end="}">
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"><a class="line" href="classUftMocker.html#a05e1c75a11fa4ccba9640d7d4b350f80"> 1333</a></span><a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* <a class="code hl_function" href="classUftMocker.html#a05e1c75a11fa4ccba9640d7d4b350f80">UftMocker::stra_get_comminfo</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>{</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>}</div>
</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span> </div>
<div class="foldopen" id="foldopen01348" data-start="{" data-end="}">
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"><a class="line" href="classUftMocker.html#a2aa8d6e9b8f35c00cfdec015c8326802"> 1348</a></span><a class="code hl_class" href="classWTSKlineSlice.html">WTSKlineSlice</a>* <a class="code hl_function" href="classUftMocker.html#a2aa8d6e9b8f35c00cfdec015c8326802">UftMocker::stra_get_bars</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keyword">const</span> <span class="keywordtype">char</span>* period, uint32_t count)</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>{</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>    <span class="keyword">thread_local</span> <span class="keyword">static</span> <span class="keywordtype">char</span> basePeriod[2] = { 0 };</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>    basePeriod[0] = period[0];</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>    uint32_t times = 1;</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>    <span class="keywordflow">if</span> (strlen(period) &gt; 1)</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>        times = strtoul(period + 1, <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 10);</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span> </div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#aaaaa628e5b7950600be0cf5c23cf8e15">get_kline_slice</a>(stdCode, basePeriod, count, times);</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>}</div>
</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span> </div>
<div class="foldopen" id="foldopen01368" data-start="{" data-end="}">
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"><a class="line" href="classUftMocker.html#a406c47b169ea834f36f18edaa4171270"> 1368</a></span><a class="code hl_class" href="classWTSTickSlice.html">WTSTickSlice</a>* <a class="code hl_function" href="classUftMocker.html#a406c47b169ea834f36f18edaa4171270">UftMocker::stra_get_ticks</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, uint32_t count)</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>{</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a7e48f49f5c773e035e14c28d7e7e788d">get_tick_slice</a>(stdCode, count);</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>}</div>
</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span> </div>
<div class="foldopen" id="foldopen01382" data-start="{" data-end="}">
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"><a class="line" href="classUftMocker.html#a27db324d73c9177e7f5df2b5e8e63b82"> 1382</a></span><a class="code hl_class" href="classWTSOrdQueSlice.html">WTSOrdQueSlice</a>* <a class="code hl_function" href="classUftMocker.html#a27db324d73c9177e7f5df2b5e8e63b82">UftMocker::stra_get_order_queue</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, uint32_t count)</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>{</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#abf6f57d003f95488cbcd570e4d447e0f">get_order_queue_slice</a>(stdCode, count);</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>}</div>
</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span> </div>
<div class="foldopen" id="foldopen01396" data-start="{" data-end="}">
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"><a class="line" href="classUftMocker.html#a7c3a8a2153ca7534ca8a8d39c87c9045"> 1396</a></span><a class="code hl_class" href="classWTSOrdDtlSlice.html">WTSOrdDtlSlice</a>* <a class="code hl_function" href="classUftMocker.html#a7c3a8a2153ca7534ca8a8d39c87c9045">UftMocker::stra_get_order_detail</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, uint32_t count)</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>{</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a4e0fcbe9c4f1d73e72e847279d5ef7a7">get_order_detail_slice</a>(stdCode, count);</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>}</div>
</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span> </div>
<div class="foldopen" id="foldopen01410" data-start="{" data-end="}">
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"><a class="line" href="classUftMocker.html#a696f7b3357c99ad6fed6cbb2711e6d8d"> 1410</a></span><a class="code hl_class" href="classWTSTransSlice.html">WTSTransSlice</a>* <a class="code hl_function" href="classUftMocker.html#a696f7b3357c99ad6fed6cbb2711e6d8d">UftMocker::stra_get_transaction</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, uint32_t count)</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>{</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a61ef55bd86a3382b4adb4d6c7bc7a697">get_transaction_slice</a>(stdCode, count);</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>}</div>
</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span> </div>
<div class="foldopen" id="foldopen01423" data-start="{" data-end="}">
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"><a class="line" href="classUftMocker.html#ae6c7e021d7fac27b4cd076dcaa9a1dc3"> 1423</a></span><a class="code hl_class" href="classWTSTickData.html">WTSTickData</a>* <a class="code hl_function" href="classUftMocker.html#ae6c7e021d7fac27b4cd076dcaa9a1dc3">UftMocker::stra_get_last_tick</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>{</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#af81f7e3dda539f1818746b14d7439f9b">get_last_tick</a>(stdCode);</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>}</div>
</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span> </div>
<div class="foldopen" id="foldopen01438" data-start="{" data-end="}">
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"><a class="line" href="classUftMocker.html#af14be14492ee692c7c7fbcdc91c17e98"> 1438</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classUftMocker.html#af14be14492ee692c7c7fbcdc91c17e98">UftMocker::stra_get_position</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> bOnlyValid <span class="comment">/* = false */</span>, int32_t iFlag <span class="comment">/* = 3 */</span>)</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>{</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; posInfo = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>    <span class="keywordflow">if</span> (iFlag == 1)</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>        <span class="keywordflow">return</span> bOnlyValid ? posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>() : posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>();</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iFlag == 2)</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>        <span class="keywordflow">return</span> bOnlyValid ? posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>() : posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>();</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>        <span class="keywordflow">return</span> bOnlyValid ? (posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>() - posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">valid</a>()) : (posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>() - posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>());</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>}</div>
</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span> </div>
<div class="foldopen" id="foldopen01457" data-start="{" data-end="}">
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"><a class="line" href="classUftMocker.html#a567d68634eec841482af2b7cfa657f57"> 1457</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classUftMocker.html#a567d68634eec841482af2b7cfa657f57">UftMocker::stra_get_local_position</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>{</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; posInfo = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode];</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>    <span class="keywordflow">return</span> posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>() - posInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>();</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>}</div>
</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span> </div>
<div class="foldopen" id="foldopen01472" data-start="{" data-end="}">
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"><a class="line" href="classUftMocker.html#a57ef443692088bb95f18b53fd1ae3016"> 1472</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classUftMocker.html#a57ef443692088bb95f18b53fd1ae3016">UftMocker::stra_enum_position</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>{</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>    uint32_t tdate = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a5d42715da75afc23e7ecdc45837d43c2">get_trading_date</a>();</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>    <span class="keywordtype">double</span> ret = 0;</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>    <span class="keywordtype">bool</span> bAll = (strlen(stdCode) == 0);</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>.begin(); it != <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>.end(); it++)</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>    {</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>        <span class="keywordflow">if</span> (!bAll &amp;&amp; strcmp(it-&gt;first.c_str(), stdCode) != 0)</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__PosInfo.html">PosInfo</a>&amp; pInfo = it-&gt;second;</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#ada54cf5bdcf7ee22eb8279ba6590e3cb">on_position</a>(<span class="keyword">this</span>, stdCode, <span class="keyword">true</span>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#ab0c72ae56c149e4a2235920d1da3a080">_prevol</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a>);</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>        <a class="code hl_variable" href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">_strategy</a>-&gt;<a class="code hl_function" href="classUftStrategy.html#ada54cf5bdcf7ee22eb8279ba6590e3cb">on_position</a>(<span class="keyword">this</span>, stdCode, <span class="keyword">false</span>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#ab0c72ae56c149e4a2235920d1da3a080">_prevol</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">_preavail</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a>, pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a>);</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>        ret += pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">_long</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>() + pInfo.<a class="code hl_variable" href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">_short</a>.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>();</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>    }</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span> </div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>}</div>
</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span> </div>
<div class="foldopen" id="foldopen01498" data-start="{" data-end="}">
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"><a class="line" href="classUftMocker.html#a2e737ba6a3d46a5bb42cf911c0ebfadf"> 1498</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="classUftMocker.html#a2e737ba6a3d46a5bb42cf911c0ebfadf">UftMocker::stra_get_price</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>{</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a369689db8151eebd6d6d7d052a335b9c">get_cur_price</a>(stdCode);</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>}</div>
</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span> </div>
<div class="foldopen" id="foldopen01509" data-start="{" data-end="}">
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"><a class="line" href="classUftMocker.html#ae10b6149214e4a56619655a636c3bc7b"> 1509</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#ae10b6149214e4a56619655a636c3bc7b">UftMocker::stra_get_date</a>()</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>{</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a7a78f4e7eb164fa4c9d91f9ecf822015">get_date</a>();</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>}</div>
</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span> </div>
<div class="foldopen" id="foldopen01520" data-start="{" data-end="}">
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"><a class="line" href="classUftMocker.html#add0ee20334abc39f251cbccbfd2b6aac"> 1520</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#add0ee20334abc39f251cbccbfd2b6aac">UftMocker::stra_get_time</a>()</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>{</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a41c299a560b162bc96f54951775c619e">get_raw_time</a>();</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>}</div>
</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span> </div>
<div class="foldopen" id="foldopen01531" data-start="{" data-end="}">
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"><a class="line" href="classUftMocker.html#a96d10bb6a3cc8a5da4c00a973e2161c2"> 1531</a></span>uint32_t <a class="code hl_function" href="classUftMocker.html#a96d10bb6a3cc8a5da4c00a973e2161c2">UftMocker::stra_get_secs</a>()</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>{</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a5cd7520000aa08b42574b4cee869f8ef">get_secs</a>();</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>}</div>
</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span> </div>
<div class="foldopen" id="foldopen01543" data-start="{" data-end="}">
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"><a class="line" href="classUftMocker.html#aa83b6c6a8b142b7cb254da2e56c627c0"> 1543</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#aa83b6c6a8b142b7cb254da2e56c627c0">UftMocker::stra_sub_ticks</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>{</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span><span class="comment">     *  By Wesley @ 2022.03.01</span></div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span><span class="comment">     *  主动订阅tick会在本地记一下</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span><span class="comment">     *  tick数据回调的时候先检查一下</span></div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span><span class="comment">     */</span></div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>    <a class="code hl_variable" href="classUftMocker.html#a2392a6d5b1ce2fe3b14f9c8f10668c87">_tick_subs</a>.insert(stdCode);</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span> </div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>    <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a5444808e4f99dec3f5ca4c0508067baa">sub_tick</a>(<a class="code hl_variable" href="classUftMocker.html#a7509f9633ab5f7e986ec7ffba3ccebc3">_context_id</a>, stdCode);</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>}</div>
</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span> </div>
<div class="foldopen" id="foldopen01562" data-start="{" data-end="}">
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"><a class="line" href="classUftMocker.html#a47540e87d498b01a28fb0e880eaf53b6"> 1562</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a47540e87d498b01a28fb0e880eaf53b6">UftMocker::stra_sub_order_queues</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>{</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>    <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a7045dff81590641cc1778120a3fb4042">sub_order_queue</a>(<a class="code hl_variable" href="classUftMocker.html#a7509f9633ab5f7e986ec7ffba3ccebc3">_context_id</a>, stdCode);</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>}</div>
</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span> </div>
<div class="foldopen" id="foldopen01574" data-start="{" data-end="}">
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"><a class="line" href="classUftMocker.html#a5c0b3c998cb22f277ef18d08f3f3d0e4"> 1574</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a5c0b3c998cb22f277ef18d08f3f3d0e4">UftMocker::stra_sub_order_details</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>{</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>    <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a874f13774223633c4b6650ad326dd131">sub_order_detail</a>(<a class="code hl_variable" href="classUftMocker.html#a7509f9633ab5f7e986ec7ffba3ccebc3">_context_id</a>, stdCode);</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>}</div>
</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span> </div>
<div class="foldopen" id="foldopen01586" data-start="{" data-end="}">
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"><a class="line" href="classUftMocker.html#aa1b33e622a3294496f2224542f172b3b"> 1586</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#aa1b33e622a3294496f2224542f172b3b">UftMocker::stra_sub_transactions</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode)</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>{</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>    <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a2d2ab351e0393c8548e9943fce834c51">sub_transaction</a>(<a class="code hl_variable" href="classUftMocker.html#a7509f9633ab5f7e986ec7ffba3ccebc3">_context_id</a>, stdCode);</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>}</div>
</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span> </div>
<div class="foldopen" id="foldopen01598" data-start="{" data-end="}">
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"><a class="line" href="classUftMocker.html#a25b1dd38e16c329f753ef7e8ba0f42ba"> 1598</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a25b1dd38e16c329f753ef7e8ba0f42ba">UftMocker::stra_log_info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* message)</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>{</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>    <a class="code hl_function" href="classWTSLogger.html#ae4cde1222e609623189a4be2b345680a">WTSLogger::log_dyn_raw</a>(<span class="stringliteral">&quot;strategy&quot;</span>, <a class="code hl_variable" href="classIUftStraCtx.html#a3d6d72eef9a27c5324d6339491cdb664">_name</a>.c_str(), <a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba3d0aabc1a000a1668922ab44aeca5771">LL_INFO</a>, message);</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>}</div>
</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span> </div>
<div class="foldopen" id="foldopen01610" data-start="{" data-end="}">
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"><a class="line" href="classUftMocker.html#a9cd9fd8db52f99fb492ddc437af5e447"> 1610</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a9cd9fd8db52f99fb492ddc437af5e447">UftMocker::stra_log_debug</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* message)</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>{</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>    <a class="code hl_function" href="classWTSLogger.html#ae4cde1222e609623189a4be2b345680a">WTSLogger::log_dyn_raw</a>(<span class="stringliteral">&quot;strategy&quot;</span>, <a class="code hl_variable" href="classIUftStraCtx.html#a3d6d72eef9a27c5324d6339491cdb664">_name</a>.c_str(), <a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba4739b8d0b3d22bcb07c145601a79c358">LL_DEBUG</a>, message);</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>}</div>
</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span> </div>
<div class="foldopen" id="foldopen01622" data-start="{" data-end="}">
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"><a class="line" href="classUftMocker.html#aae5925a1b644093bb852704ee1cec5a5"> 1622</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#aae5925a1b644093bb852704ee1cec5a5">UftMocker::stra_log_error</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* message)</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>{</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>    <a class="code hl_function" href="classWTSLogger.html#ae4cde1222e609623189a4be2b345680a">WTSLogger::log_dyn_raw</a>(<span class="stringliteral">&quot;strategy&quot;</span>, <a class="code hl_variable" href="classIUftStraCtx.html#a3d6d72eef9a27c5324d6339491cdb664">_name</a>.c_str(), <a class="code hl_enumvalue" href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba50717458baf49c204bb0645418e0da15">LL_ERROR</a>, message);</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>}</div>
</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span> </div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span> </div>
<div class="foldopen" id="foldopen01638" data-start="{" data-end="}">
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"><a class="line" href="classUftMocker.html#ad4285e507d7c8ff86b75e4cfdae7e76a"> 1638</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#ad4285e507d7c8ff86b75e4cfdae7e76a">UftMocker::dump_outputs</a>()</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>{</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>    std::string folder = <a class="code hl_function" href="classWtHelper.html#ae245ba819e4637d80f4326b05e494e15">WtHelper::getOutputDir</a>();</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>    folder += <a class="code hl_variable" href="classIUftStraCtx.html#a3d6d72eef9a27c5324d6339491cdb664">_name</a>;</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>    folder += <span class="stringliteral">&quot;/&quot;</span>;</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>    boost::filesystem::create_directories(folder.c_str());</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span> </div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>    std::string filename = folder + <span class="stringliteral">&quot;trades.csv&quot;</span>;</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>    std::string content = <span class="stringliteral">&quot;code,time,direct,action,price,qty,fee,usertag\n&quot;</span>;</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>    content += <a class="code hl_variable" href="classUftMocker.html#a1f56e451de15b544e8e6f3a4e95a6720">_trade_logs</a>.str();</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>    <a class="code hl_function" href="classStdFile.html#a1c5c12097662380ad58ae3d8a877fe3a">StdFile::write_file_content</a>(filename.c_str(), (<span class="keywordtype">void</span>*)content.c_str(), content.size());</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span> </div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>    filename = folder + <span class="stringliteral">&quot;closes.csv&quot;</span>;</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>    content = <span class="stringliteral">&quot;code,direct,opentime,openprice,closetime,closeprice,qty,profit,maxprofit,maxloss,totalprofit,entertag,exittag\n&quot;</span>;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>    content += <a class="code hl_variable" href="classUftMocker.html#ab5fe80527477d3615665768afe88986c">_close_logs</a>.str();</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>    <a class="code hl_function" href="classStdFile.html#a1c5c12097662380ad58ae3d8a877fe3a">StdFile::write_file_content</a>(filename.c_str(), (<span class="keywordtype">void</span>*)content.c_str(), content.size());</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span> </div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span> </div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>    filename = folder + <span class="stringliteral">&quot;funds.csv&quot;</span>;</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>    content = <span class="stringliteral">&quot;date,closeprofit,positionprofit,dynbalance,fee\n&quot;</span>;</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>    content += <a class="code hl_variable" href="classUftMocker.html#a8e63abbbd43a222d3f5dbff64cfad3c0">_fund_logs</a>.str();</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>    <a class="code hl_function" href="classStdFile.html#a1c5c12097662380ad58ae3d8a877fe3a">StdFile::write_file_content</a>(filename.c_str(), (<span class="keywordtype">void</span>*)content.c_str(), content.size());</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span> </div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>    filename = folder + <span class="stringliteral">&quot;positions.csv&quot;</span>;</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>    content = <span class="stringliteral">&quot;date,code,direct,volume,closeprofit,dynprofit\n&quot;</span>;</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classUftMocker.html#a074d811c5a8ecaf5dbba6e2f6ec4e282">_pos_logs</a>.str().empty()) content += <a class="code hl_variable" href="classUftMocker.html#a074d811c5a8ecaf5dbba6e2f6ec4e282">_pos_logs</a>.str();</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>    <a class="code hl_function" href="classStdFile.html#a1c5c12097662380ad58ae3d8a877fe3a">StdFile::write_file_content</a>(filename.c_str(), (<span class="keywordtype">void</span>*)content.c_str(), content.size());</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>}</div>
</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span> </div>
<div class="foldopen" id="foldopen01680" data-start="{" data-end="}">
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"><a class="line" href="classUftMocker.html#aa59afdde809ae55c213d95ab34dd37b9"> 1680</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#aa59afdde809ae55c213d95ab34dd37b9">UftMocker::log_trade</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> isLong, uint32_t offset, uint64_t curTime, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, <span class="keywordtype">double</span> qty, <span class="keywordtype">double</span> fee)</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>{</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>    <a class="code hl_variable" href="classUftMocker.html#a1f56e451de15b544e8e6f3a4e95a6720">_trade_logs</a> &lt;&lt; stdCode &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; curTime &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; (isLong ? <span class="stringliteral">&quot;LONG&quot;</span> : <span class="stringliteral">&quot;SHORT&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code hl_variable" href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">OFFSET_NAMES</a>[offset]</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>        &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; qty &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fee  &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>}</div>
</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span> </div>
<div class="foldopen" id="foldopen01704" data-start="{" data-end="}">
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"><a class="line" href="classUftMocker.html#a57a329c44fadd6fd2ad1db1039899b7a"> 1704</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#a57a329c44fadd6fd2ad1db1039899b7a">UftMocker::log_close</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> isLong, uint64_t openTime, <span class="keywordtype">double</span> openpx, uint64_t closeTime, <span class="keywordtype">double</span> closepx, <span class="keywordtype">double</span> qty, <span class="keywordtype">double</span> profit, <span class="keywordtype">double</span> maxprofit, <span class="keywordtype">double</span> maxloss,</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>    <span class="keywordtype">double</span> totalprofit <span class="comment">/* = 0 */</span>)</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>{</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    <a class="code hl_variable" href="classUftMocker.html#ab5fe80527477d3615665768afe88986c">_close_logs</a> &lt;&lt; stdCode &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; (isLong ? <span class="stringliteral">&quot;LONG&quot;</span> : <span class="stringliteral">&quot;SHORT&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; openTime &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; openpx</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>        &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; closeTime &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; closepx &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; qty &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; profit &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; maxprofit &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; maxloss &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>        &lt;&lt; totalprofit &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>}</div>
</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span> </div>
<div class="foldopen" id="foldopen01726" data-start="{" data-end="}">
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"><a class="line" href="classUftMocker.html#af040581dfbad9adea966486ee63748cd"> 1726</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classUftMocker.html#af040581dfbad9adea966486ee63748cd">UftMocker::update_position</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* stdCode, <span class="keywordtype">bool</span> isLong, uint32_t offset, <span class="keywordtype">double</span> qty, <span class="keywordtype">double</span> <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a> <span class="comment">/* = 0.0 */</span>)</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>{</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>    <a class="code hl_struct" href="structUftMocker_1_1__PosItem.html">PosItem</a>&amp; pItem = isLong ? <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode]._long : <a class="code hl_variable" href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">_pos_map</a>[stdCode]._short;</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span> </div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>    <span class="comment">//先确定成交价格</span></div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>    <span class="keywordtype">double</span> curPx = <a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>;</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(<a class="code hl_variable" href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a>, 0.0))</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>        curPx = <a class="code hl_variable" href="classUftMocker.html#a3d3d44e1f3370b3bb655d5a7d25ae46b">_price_map</a>[stdCode];</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span> </div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* pos_dir = isLong ? <span class="stringliteral">&quot;long&quot;</span> : <span class="stringliteral">&quot;short&quot;</span>;</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span> </div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>    <span class="comment">//获取时间</span></div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>    uint64_t curTm = (uint64_t)<a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a7a78f4e7eb164fa4c9d91f9ecf822015">get_date</a>() * 1000000000 + (uint64_t)<a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#ac054d48af98ef89c625a723863444841">get_min_time</a>()*100000 + <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a5cd7520000aa08b42574b4cee869f8ef">get_secs</a>();</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>    uint32_t curTDate = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a5d42715da75afc23e7ecdc45837d43c2">get_trading_date</a>();</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span> </div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>    <a class="code hl_class" href="classWTSCommodityInfo.html">WTSCommodityInfo</a>* commInfo = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">get_commodity_info</a>(stdCode);</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>    <span class="keywordflow">if</span> (commInfo == <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span> </div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>    <span class="comment">//成交价</span></div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>    <span class="keywordtype">double</span> trdPx = curPx;</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span> </div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>    <span class="keywordflow">if</span> (offset == 0)</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>    {</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>        <span class="comment">//如果是开仓，则直接增加明细即可</span></div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a> += qty;</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>        <span class="comment">//如果T+1，则冻结仓位要增加</span></div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>        <span class="keywordflow">if</span> (commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#ade755d23541016a1cd823035f850b92b">isT1</a>())</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>        {</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>            <span class="comment">//ASSERT(diff&gt;0);</span></div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>            <a class="code hl_function" href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">log_debug</a>(<span class="stringliteral">&quot;{} position of {} frozen up to {}&quot;</span>, pos_dir, stdCode, pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a527cc37fe66d31082889d268ffb89201">frozen</a>());</div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>        }</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>        {</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">_newavail</a> += qty;</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>        }</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span> </div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>        <a class="code hl_struct" href="structUftMocker_1_1__DetailInfo.html">DetailInfo</a> dInfo;</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">_price</a> = trdPx;</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> = qty;</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a89479eac92e8f588d7c2c3ca5a224007">_opentime</a> = curTm;</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>        dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#ac092997f67f47809a247026a26a74574">_opentdate</a> = curTDate;</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.emplace_back(dInfo);</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span> </div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>        <span class="keywordtype">double</span> fee = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#af81a7e7e7c94ab2508decf4a8f69ad60">calc_fee</a>(stdCode, trdPx, qty, 0);</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>        <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af030f8da92d1eae43249aa1302731d77">_total_fees</a> += fee;</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span> </div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>        <a class="code hl_function" href="classUftMocker.html#aa59afdde809ae55c213d95ab34dd37b9">log_trade</a>(stdCode, isLong, 0, curTm, trdPx, qty, fee);</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>    }</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(offset == 1)</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>    {</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>        <span class="comment">//如果是平仓（平昨也是这个），则根据明细的时间先后处理平仓</span></div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>        <span class="keywordtype">double</span> maxQty = min(pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#ab0c72ae56c149e4a2235920d1da3a080">_prevol</a>, qty);</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#ab0c72ae56c149e4a2235920d1da3a080">_prevol</a> -= maxQty;</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a> -= qty - maxQty;</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span> </div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>        std::vector&lt;DetailInfo&gt;::iterator eit = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end();</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>        <span class="keywordtype">double</span> left = qty;</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.begin(); it != pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end(); it++)</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>        {</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>            <a class="code hl_struct" href="structUftMocker_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo = *it;</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>            <span class="keywordtype">double</span> maxQty = min(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>, left);</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(maxQty, 0))</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span> </div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>            <span class="keywordtype">double</span> maxProf = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a> * maxQty / dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>;</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>            <span class="keywordtype">double</span> maxLoss = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a> * maxQty / dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>;</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span> </div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>            dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> -= maxQty;</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>            left -= maxQty;</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span> </div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>, 0))</div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>                eit = it;</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span> </div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>            <span class="keywordtype">double</span> profit = (trdPx - dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">_price</a>) * maxQty * commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">getVolScale</a>();</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>            <span class="keywordflow">if</span> (isLong)</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>                profit *= -1;</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aabd6cea7cdfcb46fc78881afecd27416">_closeprofit</a> += profit;</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span> </div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>            <span class="comment">//等比缩放明细的相关浮盈</span></div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>            dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a> = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">_profit</a>*dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> / (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> + maxQty);</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>            dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a> = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a>*dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> / (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> + maxQty);</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>            dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a> = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a>*dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> / (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> + maxQty);</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>            <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af1e40ea145db43d10cef779ea032d3c5">_total_profit</a> += profit;</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>            <span class="keywordtype">double</span> fee = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#af81a7e7e7c94ab2508decf4a8f69ad60">calc_fee</a>(stdCode, trdPx, maxQty, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#ac092997f67f47809a247026a26a74574">_opentdate</a> == curTDate ? 2 : 1);</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>            <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af030f8da92d1eae43249aa1302731d77">_total_fees</a> += fee;</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>            <span class="comment">//这里写成交记录</span></div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>            <a class="code hl_function" href="classUftMocker.html#aa59afdde809ae55c213d95ab34dd37b9">log_trade</a>(stdCode, isLong, offset, curTm, trdPx, maxQty, fee);</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>            <span class="comment">//这里写平仓记录</span></div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>            <a class="code hl_function" href="classUftMocker.html#a57a329c44fadd6fd2ad1db1039899b7a">log_close</a>(stdCode, isLong, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a89479eac92e8f588d7c2c3ca5a224007">_opentime</a>, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">_price</a>, curTm, trdPx, maxQty, profit, maxProf, maxLoss, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aabd6cea7cdfcb46fc78881afecd27416">_closeprofit</a>);</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span> </div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>            <span class="keywordflow">if</span> (left == 0)</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>        }</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span> </div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>        <span class="comment">//需要清理掉已经平仓完的明细</span></div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>        <span class="keywordflow">if</span> (eit != pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end())</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.erase(pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.begin(), eit);</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span> </div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>    }</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (offset == 2)</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>    {</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>        <span class="comment">//如果是平今，只更新今仓，先找到今仓起始的位置，再开始处理</span></div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>        pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">_newvol</a> -= qty;</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>        std::vector&lt;DetailInfo&gt;::iterator sit = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end();</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>        std::vector&lt;DetailInfo&gt;::iterator eit = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end();</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span> </div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>        uint32_t count = 0;</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>        <span class="keywordtype">double</span> left = qty;</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.begin(); it != pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end(); it++)</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>        {</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>            <a class="code hl_struct" href="structUftMocker_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo = *it;</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>            <span class="comment">//如果不是今仓，就直接跳过</span></div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>            <span class="keywordflow">if</span>(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#ac092997f67f47809a247026a26a74574">_opentdate</a> != curTDate)</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span> </div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>            <span class="keywordtype">double</span> maxQty = min(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>, left);</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(maxQty, 0))</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span> </div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>            <span class="keywordflow">if</span> (sit == pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end())</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>                sit = it;</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span> </div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>            eit = it;</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span> </div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>            <span class="keywordtype">double</span> maxProf = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">_max_profit</a> * maxQty / dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>;</div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>            <span class="keywordtype">double</span> maxLoss = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">_max_loss</a> * maxQty / dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>;</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span> </div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>            dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> -= maxQty;</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>            left -= maxQty;</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span> </div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a>(dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a>, 0))</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>                count++;</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span> </div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>            <span class="keywordtype">double</span> profit = (trdPx - dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">_price</a>) * maxQty * commInfo-&gt;<a class="code hl_function" href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">getVolScale</a>();</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>            <span class="keywordflow">if</span> (!isLong)</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>                profit *= -1;</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aabd6cea7cdfcb46fc78881afecd27416">_closeprofit</a> += profit;</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a> = pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a>*dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> / (dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">_volume</a> + maxQty);<span class="comment">//浮盈也要做等比缩放</span></div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>            <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af1e40ea145db43d10cef779ea032d3c5">_total_profit</a> += profit;</div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span> </div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>            uint32_t offset = dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#ac092997f67f47809a247026a26a74574">_opentdate</a> == curTDate ? 2 : 1;</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>            <span class="keywordtype">double</span> fee = <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#af81a7e7e7c94ab2508decf4a8f69ad60">calc_fee</a>(stdCode, trdPx, maxQty, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#ac092997f67f47809a247026a26a74574">_opentdate</a> == curTDate ? 2 : 1);</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>            <a class="code hl_variable" href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">_fund_info</a>.<a class="code hl_variable" href="structUftMocker_1_1__StraFundInfo.html#af030f8da92d1eae43249aa1302731d77">_total_fees</a> += fee;</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>            <span class="comment">//这里写成交记录</span></div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>            <a class="code hl_function" href="classUftMocker.html#aa59afdde809ae55c213d95ab34dd37b9">log_trade</a>(stdCode, isLong, offset, curTm, trdPx, maxQty, fee);</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>            <span class="comment">//这里写平仓记录</span></div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>            <a class="code hl_function" href="classUftMocker.html#a57a329c44fadd6fd2ad1db1039899b7a">log_close</a>(stdCode, isLong, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a89479eac92e8f588d7c2c3ca5a224007">_opentime</a>, dInfo.<a class="code hl_variable" href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">_price</a>, curTm, trdPx, maxQty, profit, maxProf, maxLoss, pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aabd6cea7cdfcb46fc78881afecd27416">_closeprofit</a>);</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span> </div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span>            <span class="keywordflow">if</span> (left == 0)</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>        }</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span> </div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>        <span class="comment">//需要清理掉已经平仓完的明细</span></div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>        <span class="keywordflow">if</span> (sit != pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.end())</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span>            pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>.erase(sit, eit);</div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span>    }</div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span> </div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>    <a class="code hl_function" href="classUftMocker.html#a7add808e8aa139bb00ce608772ff674d">log_info</a>(<span class="stringliteral">&quot;[{:04d}.{:05d}] {} position of {} updated: {} {} to {}&quot;</span>, <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#ac054d48af98ef89c625a723863444841">get_min_time</a>(), <a class="code hl_variable" href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">_replayer</a>-&gt;<a class="code hl_function" href="classHisDataReplayer.html#a5cd7520000aa08b42574b4cee869f8ef">get_secs</a>(), pos_dir, stdCode, <a class="code hl_variable" href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">OFFSET_NAMES</a>[offset], qty, pItem.<a class="code hl_function" href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">volume</a>());</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span> </div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>    <span class="keywordtype">double</span> dynprofit = 0;</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code hl_struct" href="structUftMocker_1_1__DetailInfo.html">DetailInfo</a>&amp; dInfo : pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">_details</a>)</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>    {</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>        dynprofit += dInfo._profit;</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>    }</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>    pItem.<a class="code hl_variable" href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">_dynprofit</a> = dynprofit;</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>}</div>
</div>
<div class="ttc" id="aDLLHelper_8hpp_html_a40972742af38c16d3ab2f521abf0ca8a"><div class="ttname"><a href="DLLHelper_8hpp.html#a40972742af38c16d3ab2f521abf0ca8a">DllHandle</a></div><div class="ttdeci">void * DllHandle</div><div class="ttdoc">动态库句柄类型（非Windows平台）</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00032">DLLHelper.hpp:32</a></div></div>
<div class="ttc" id="aExecMocker_8cpp_html_a53cef3aa4a728448c19e95d927d87329"><div class="ttname"><a href="ExecMocker_8cpp.html#a53cef3aa4a728448c19e95d927d87329">makeLocalOrderID</a></div><div class="ttdeci">uint32_t makeLocalOrderID()</div><div class="ttdoc">生成本地订单ID</div><div class="ttdef"><b>Definition</b> <a href="HftMocker_8cpp_source.html#l00038">HftMocker.cpp:38</a></div></div>
<div class="ttc" id="aExecuteDefs_8h_html_a5956353808ff4eea2def6475db30bc0d"><div class="ttname"><a href="ExecuteDefs_8h.html#a5956353808ff4eea2def6475db30bc0d">OrderIDs</a></div><div class="ttdeci">std::vector&lt; uint32_t &gt; OrderIDs</div><div class="ttdef"><b>Definition</b> <a href="ExecuteDefs_8h_source.html#l00021">ExecuteDefs.h:21</a></div></div>
<div class="ttc" id="aHftMocker_8cpp_html_a3f0f810d84c27185f9ec1851c8eac82b"><div class="ttname"><a href="HftMocker_8cpp.html#a3f0f810d84c27185f9ec1851c8eac82b">genRand</a></div><div class="ttdeci">uint32_t genRand(uint32_t maxVal=10000)</div><div class="ttdoc">生成随机数</div><div class="ttdef"><b>Definition</b> <a href="HftMocker_8cpp_source.html#l00138">HftMocker.cpp:138</a></div></div>
<div class="ttc" id="aTraderMocker_8cpp_html_a746d9fe0268c4f5fc9b934d7277ecdcf"><div class="ttname"><a href="TraderMocker_8cpp.html#a746d9fe0268c4f5fc9b934d7277ecdcf">splitVolume</a></div><div class="ttdeci">std::vector&lt; uint32_t &gt; splitVolume(uint32_t vol, uint32_t minQty=1, uint32_t maxQty=100)</div><div class="ttdef"><b>Definition</b> <a href="TraderMocker_8cpp_source.html#l00052">TraderMocker.cpp:52</a></div></div>
<div class="ttc" id="aUftMocker_8cpp_html_a3f0f810d84c27185f9ec1851c8eac82b"><div class="ttname"><a href="UftMocker_8cpp.html#a3f0f810d84c27185f9ec1851c8eac82b">genRand</a></div><div class="ttdeci">uint32_t genRand(uint32_t maxVal=10000)</div><div class="ttdoc">生成随机数</div><div class="ttdef"><b>Definition</b> <a href="HftMocker_8cpp_source.html#l00138">HftMocker.cpp:138</a></div></div>
<div class="ttc" id="aUftMocker_8cpp_html_a53cef3aa4a728448c19e95d927d87329"><div class="ttname"><a href="UftMocker_8cpp.html#a53cef3aa4a728448c19e95d927d87329">makeLocalOrderID</a></div><div class="ttdeci">uint32_t makeLocalOrderID()</div><div class="ttdoc">生成序列号自增的本地订单ID</div><div class="ttdef"><b>Definition</b> <a href="HftMocker_8cpp_source.html#l00038">HftMocker.cpp:38</a></div></div>
<div class="ttc" id="aUftMocker_8cpp_html_a8b4b0de9002db5a602faa0b76d5bf356"><div class="ttname"><a href="UftMocker_8cpp.html#a8b4b0de9002db5a602faa0b76d5bf356">makeUftCtxId</a></div><div class="ttdeci">uint32_t makeUftCtxId()</div><div class="ttdoc">生成UFT策略上下文ID</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00073">UftMocker.cpp:73</a></div></div>
<div class="ttc" id="aUftMocker_8cpp_html_ab5dbdbf908e451e5fcb0957d4f58c631"><div class="ttname"><a href="UftMocker_8cpp.html#ab5dbdbf908e451e5fcb0957d4f58c631">OFFSET_NAMES</a></div><div class="ttdeci">const char * OFFSET_NAMES[]</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00032">UftMocker.cpp:32</a></div></div>
<div class="ttc" id="aUftMocker_8cpp_html_aeb6e1032b880b336183cbcbe7384b4d4"><div class="ttname"><a href="UftMocker_8cpp.html#aeb6e1032b880b336183cbcbe7384b4d4">splitVolume</a></div><div class="ttdeci">std::vector&lt; uint32_t &gt; splitVolume(uint32_t vol)</div><div class="ttdoc">将交易量分拆成多个小单</div><div class="ttdef"><b>Definition</b> <a href="HftMocker_8cpp_source.html#l00057">HftMocker.cpp:57</a></div></div>
<div class="ttc" id="aUftMocker_8h_html"><div class="ttname"><a href="UftMocker_8h.html">UftMocker.h</a></div><div class="ttdoc">UFT策略回测模拟器头文件</div></div>
<div class="ttc" id="aUftStrategyDefs_8h_html_ad725e1d21fa13366664a6a3c56677272"><div class="ttname"><a href="UftStrategyDefs_8h.html#ad725e1d21fa13366664a6a3c56677272">FuncDeleteUftStraFact</a></div><div class="ttdeci">void(* FuncDeleteUftStraFact)(IUftStrategyFact *&amp;fact)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00207">UftStrategyDefs.h:207</a></div></div>
<div class="ttc" id="aUftStrategyDefs_8h_html_afbb7f624f81cc2bb8d42d16f0fd64ad5"><div class="ttname"><a href="UftStrategyDefs_8h.html#afbb7f624f81cc2bb8d42d16f0fd64ad5">FuncCreateUftStraFact</a></div><div class="ttdeci">IUftStrategyFact *(* FuncCreateUftStraFact)()</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00205">UftStrategyDefs.h:205</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_a5749fa649fc95e5e117ad7002b77bb2ba0b35236fa9a83b8fb1e8f4ed203f3bdd"><div class="ttname"><a href="WTSTypes_8h.html#a5749fa649fc95e5e117ad7002b77bb2ba0b35236fa9a83b8fb1e8f4ed203f3bdd">CM_CoverToday</a></div><div class="ttdeci">@ CM_CoverToday</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00056">WTSTypes.h:56</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_aed5503152b508c68a90229e513a8e15ba3d0aabc1a000a1668922ab44aeca5771"><div class="ttname"><a href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba3d0aabc1a000a1668922ab44aeca5771">LL_INFO</a></div><div class="ttdeci">@ LL_INFO</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00129">WTSTypes.h:129</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_aed5503152b508c68a90229e513a8e15ba4739b8d0b3d22bcb07c145601a79c358"><div class="ttname"><a href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba4739b8d0b3d22bcb07c145601a79c358">LL_DEBUG</a></div><div class="ttdeci">@ LL_DEBUG</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00128">WTSTypes.h:128</a></div></div>
<div class="ttc" id="aWTSTypes_8h_html_aed5503152b508c68a90229e513a8e15ba50717458baf49c204bb0645418e0da15"><div class="ttname"><a href="WTSTypes_8h.html#aed5503152b508c68a90229e513a8e15ba50717458baf49c204bb0645418e0da15">LL_ERROR</a></div><div class="ttdeci">@ LL_ERROR</div><div class="ttdef"><b>Definition</b> <a href="WTSTypes_8h_source.html#l00131">WTSTypes.h:131</a></div></div>
<div class="ttc" id="aWtUftCore_2WtHelper_8h_html"><div class="ttname"><a href="WtUftCore_2WtHelper_8h.html">WtHelper.h</a></div><div class="ttdoc">WonderTrader辅助工具类头文件</div></div>
<div class="ttc" id="aclassDLLHelper_html_ac5d55450ea114206242d9ccbfd65ac82"><div class="ttname"><a href="classDLLHelper.html#ac5d55450ea114206242d9ccbfd65ac82">DLLHelper::load_library</a></div><div class="ttdeci">static DllHandle load_library(const char *filename)</div><div class="ttdoc">加载动态库</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00058">DLLHelper.hpp:58</a></div></div>
<div class="ttc" id="aclassDLLHelper_html_adbde89a530ae734c57506bf9639ccc65"><div class="ttname"><a href="classDLLHelper.html#adbde89a530ae734c57506bf9639ccc65">DLLHelper::free_library</a></div><div class="ttdeci">static void free_library(DllHandle handle)</div><div class="ttdoc">释放动态库</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00085">DLLHelper.hpp:85</a></div></div>
<div class="ttc" id="aclassDLLHelper_html_ae01c3a299dd418d0298d29fa5f5f9b2c"><div class="ttname"><a href="classDLLHelper.html#ae01c3a299dd418d0298d29fa5f5f9b2c">DLLHelper::get_symbol</a></div><div class="ttdeci">static ProcHandle get_symbol(DllHandle handle, const char *name)</div><div class="ttdoc">获取动态库中的符号（函数或变量）</div><div class="ttdef"><b>Definition</b> <a href="DLLHelper_8hpp_source.html#l00107">DLLHelper.hpp:107</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html"><div class="ttname"><a href="classHisDataReplayer.html">HisDataReplayer</a></div><div class="ttdoc">历史数据回放器类</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8h_source.html#l00255">HisDataReplayer.h:256</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a0fb9b287adb7ab6a849aaa6a2ad7cb88"><div class="ttname"><a href="classHisDataReplayer.html#a0fb9b287adb7ab6a849aaa6a2ad7cb88">HisDataReplayer::get_commodity_info</a></div><div class="ttdeci">WTSCommodityInfo * get_commodity_info(const char *stdCode)</div><div class="ttdoc">获取商品信息</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03250">HisDataReplayer.cpp:3250</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a2d2ab351e0393c8548e9943fce834c51"><div class="ttname"><a href="classHisDataReplayer.html#a2d2ab351e0393c8548e9943fce834c51">HisDataReplayer::sub_transaction</a></div><div class="ttdeci">void sub_transaction(uint32_t sid, const char *stdCode)</div><div class="ttdoc">订阅成交数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03581">HisDataReplayer.cpp:3581</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a369689db8151eebd6d6d7d052a335b9c"><div class="ttname"><a href="classHisDataReplayer.html#a369689db8151eebd6d6d7d052a335b9c">HisDataReplayer::get_cur_price</a></div><div class="ttdeci">double get_cur_price(const char *stdCode)</div><div class="ttdoc">获取当前价格</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03406">HisDataReplayer.cpp:3406</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a41c299a560b162bc96f54951775c619e"><div class="ttname"><a href="classHisDataReplayer.html#a41c299a560b162bc96f54951775c619e">HisDataReplayer::get_raw_time</a></div><div class="ttdeci">uint32_t get_raw_time() const</div><div class="ttdoc">获取原始时间</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8h_source.html#l00901">HisDataReplayer.h:901</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a4e0fcbe9c4f1d73e72e847279d5ef7a7"><div class="ttname"><a href="classHisDataReplayer.html#a4e0fcbe9c4f1d73e72e847279d5ef7a7">HisDataReplayer::get_order_detail_slice</a></div><div class="ttdeci">WTSOrdDtlSlice * get_order_detail_slice(const char *stdCode, uint32_t count, uint64_t etime=0)</div><div class="ttdoc">获取委托明细切片数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l02782">HisDataReplayer.cpp:2782</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a5444808e4f99dec3f5ca4c0508067baa"><div class="ttname"><a href="classHisDataReplayer.html#a5444808e4f99dec3f5ca4c0508067baa">HisDataReplayer::sub_tick</a></div><div class="ttdeci">void sub_tick(uint32_t sid, const char *stdCode)</div><div class="ttdoc">订阅Tick数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03494">HisDataReplayer.cpp:3494</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a5cd7520000aa08b42574b4cee869f8ef"><div class="ttname"><a href="classHisDataReplayer.html#a5cd7520000aa08b42574b4cee869f8ef">HisDataReplayer::get_secs</a></div><div class="ttdeci">uint32_t get_secs() const</div><div class="ttdoc">获取当前秒数</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8h_source.html#l00908">HisDataReplayer.h:908</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a5d42715da75afc23e7ecdc45837d43c2"><div class="ttname"><a href="classHisDataReplayer.html#a5d42715da75afc23e7ecdc45837d43c2">HisDataReplayer::get_trading_date</a></div><div class="ttdeci">uint32_t get_trading_date() const</div><div class="ttdoc">获取当前交易日</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8h_source.html#l00915">HisDataReplayer.h:915</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a61ef55bd86a3382b4adb4d6c7bc7a697"><div class="ttname"><a href="classHisDataReplayer.html#a61ef55bd86a3382b4adb4d6c7bc7a697">HisDataReplayer::get_transaction_slice</a></div><div class="ttdeci">WTSTransSlice * get_transaction_slice(const char *stdCode, uint32_t count, uint64_t etime=0)</div><div class="ttdoc">获取成交明细切片数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l02902">HisDataReplayer.cpp:2902</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a7045dff81590641cc1778120a3fb4042"><div class="ttname"><a href="classHisDataReplayer.html#a7045dff81590641cc1778120a3fb4042">HisDataReplayer::sub_order_queue</a></div><div class="ttdeci">void sub_order_queue(uint32_t sid, const char *stdCode)</div><div class="ttdoc">订阅委托队列数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03554">HisDataReplayer.cpp:3554</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a7a78f4e7eb164fa4c9d91f9ecf822015"><div class="ttname"><a href="classHisDataReplayer.html#a7a78f4e7eb164fa4c9d91f9ecf822015">HisDataReplayer::get_date</a></div><div class="ttdeci">uint32_t get_date() const</div><div class="ttdoc">获取当前日期</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8h_source.html#l00887">HisDataReplayer.h:887</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a7e48f49f5c773e035e14c28d7e7e788d"><div class="ttname"><a href="classHisDataReplayer.html#a7e48f49f5c773e035e14c28d7e7e788d">HisDataReplayer::get_tick_slice</a></div><div class="ttdeci">WTSTickSlice * get_tick_slice(const char *stdCode, uint32_t count, uint64_t etime=0)</div><div class="ttdoc">获取Tick切片数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l02693">HisDataReplayer.cpp:2693</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_a874f13774223633c4b6650ad326dd131"><div class="ttname"><a href="classHisDataReplayer.html#a874f13774223633c4b6650ad326dd131">HisDataReplayer::sub_order_detail</a></div><div class="ttdeci">void sub_order_detail(uint32_t sid, const char *stdCode)</div><div class="ttdoc">订阅委托明细数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03527">HisDataReplayer.cpp:3527</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_aaaaa628e5b7950600be0cf5c23cf8e15"><div class="ttname"><a href="classHisDataReplayer.html#aaaaa628e5b7950600be0cf5c23cf8e15">HisDataReplayer::get_kline_slice</a></div><div class="ttdeci">WTSKlineSlice * get_kline_slice(const char *stdCode, const char *period, uint32_t count, uint32_t times=1, bool isMain=false)</div><div class="ttdoc">获取K线切片数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l02373">HisDataReplayer.cpp:2373</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_abf6f57d003f95488cbcd570e4d447e0f"><div class="ttname"><a href="classHisDataReplayer.html#abf6f57d003f95488cbcd570e4d447e0f">HisDataReplayer::get_order_queue_slice</a></div><div class="ttdeci">WTSOrdQueSlice * get_order_queue_slice(const char *stdCode, uint32_t count, uint64_t etime=0)</div><div class="ttdoc">获取委托队列切片数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l02842">HisDataReplayer.cpp:2842</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_ac054d48af98ef89c625a723863444841"><div class="ttname"><a href="classHisDataReplayer.html#ac054d48af98ef89c625a723863444841">HisDataReplayer::get_min_time</a></div><div class="ttdeci">uint32_t get_min_time() const</div><div class="ttdoc">获取当前分钟时间</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8h_source.html#l00894">HisDataReplayer.h:894</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_af81a7e7e7c94ab2508decf4a8f69ad60"><div class="ttname"><a href="classHisDataReplayer.html#af81a7e7e7c94ab2508decf4a8f69ad60">HisDataReplayer::calc_fee</a></div><div class="ttdeci">double calc_fee(const char *stdCode, double price, double qty, uint32_t offset)</div><div class="ttdoc">计算交易费用</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03361">HisDataReplayer.cpp:3361</a></div></div>
<div class="ttc" id="aclassHisDataReplayer_html_af81f7e3dda539f1818746b14d7439f9b"><div class="ttname"><a href="classHisDataReplayer.html#af81f7e3dda539f1818746b14d7439f9b">HisDataReplayer::get_last_tick</a></div><div class="ttdeci">WTSTickData * get_last_tick(const char *stdCode)</div><div class="ttdoc">获取最新的Tick数据</div><div class="ttdef"><b>Definition</b> <a href="HisDataReplayer_8cpp_source.html#l03206">HisDataReplayer.cpp:3206</a></div></div>
<div class="ttc" id="aclassIUftStraCtx_html"><div class="ttname"><a href="classIUftStraCtx.html">IUftStraCtx</a></div><div class="ttdef"><b>Definition</b> <a href="IUftStraCtx_8h_source.html#l00031">IUftStraCtx.h:32</a></div></div>
<div class="ttc" id="aclassIUftStraCtx_html_a3d6d72eef9a27c5324d6339491cdb664"><div class="ttname"><a href="classIUftStraCtx.html#a3d6d72eef9a27c5324d6339491cdb664">IUftStraCtx::_name</a></div><div class="ttdeci">std::string _name</div><div class="ttdef"><b>Definition</b> <a href="IUftStraCtx_8h_source.html#l00267">IUftStraCtx.h:267</a></div></div>
<div class="ttc" id="aclassIUftStraCtx_html_ab470dc72c32d6717788cf853eb70f6c3"><div class="ttname"><a href="classIUftStraCtx.html#ab470dc72c32d6717788cf853eb70f6c3">IUftStraCtx::on_bactest_end</a></div><div class="ttdeci">virtual void on_bactest_end()</div><div class="ttdef"><b>Definition</b> <a href="IUftStraCtx_8h_source.html#l00057">IUftStraCtx.h:57</a></div></div>
<div class="ttc" id="aclassIUftStrategyFact_html_a0c6b7a8ecfa7c0ebe990a2ce8bcbdd30"><div class="ttname"><a href="classIUftStrategyFact.html#a0c6b7a8ecfa7c0ebe990a2ce8bcbdd30">IUftStrategyFact::createStrategy</a></div><div class="ttdeci">virtual UftStrategy * createStrategy(const char *name, const char *id)=0</div></div>
<div class="ttc" id="aclassIUftStrategyFact_html_a9bea8a862e75303e752245652e7cd96c"><div class="ttname"><a href="classIUftStrategyFact.html#a9bea8a862e75303e752245652e7cd96c">IUftStrategyFact::deleteStrategy</a></div><div class="ttdeci">virtual bool deleteStrategy(UftStrategy *stra)=0</div></div>
<div class="ttc" id="aclassStdFile_html_a1c5c12097662380ad58ae3d8a877fe3a"><div class="ttname"><a href="classStdFile.html#a1c5c12097662380ad58ae3d8a877fe3a">StdFile::write_file_content</a></div><div class="ttdeci">static void write_file_content(const char *filename, const std::string &amp;content)</div><div class="ttdoc">将字符串内容写入文件</div><div class="ttdef"><b>Definition</b> <a href="StdUtils_8hpp_source.html#l00192">StdUtils.hpp:192</a></div></div>
<div class="ttc" id="aclassStdLocker_html"><div class="ttname"><a href="classStdLocker.html">StdLocker</a></div><div class="ttdoc">通用锁包装器模板类</div><div class="ttdef"><b>Definition</b> <a href="StdUtils_8hpp_source.html#l00085">StdUtils.hpp:86</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a02de1e268e424e0ddd354c9c321f5d44"><div class="ttname"><a href="classUftMocker.html#a02de1e268e424e0ddd354c9c321f5d44">UftMocker::_factory</a></div><div class="ttdeci">StraFactInfo _factory</div><div class="ttdoc">UFT策略工厂实例</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00775">UftMocker.h:775</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a03dfc265a143669b643a83132aeb329b"><div class="ttname"><a href="classUftMocker.html#a03dfc265a143669b643a83132aeb329b">UftMocker::stra_exit_long</a></div><div class="ttdeci">virtual uint32_t stra_exit_long(const char *stdCode, double price, double qty, bool isToday=false, int flag=0) override</div><div class="ttdoc">平多仓交易</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00963">UftMocker.cpp:963</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a05e1c75a11fa4ccba9640d7d4b350f80"><div class="ttname"><a href="classUftMocker.html#a05e1c75a11fa4ccba9640d7d4b350f80">UftMocker::stra_get_comminfo</a></div><div class="ttdeci">virtual WTSCommodityInfo * stra_get_comminfo(const char *stdCode) override</div><div class="ttdoc">获取合约基础信息</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01333">UftMocker.cpp:1333</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a074d811c5a8ecaf5dbba6e2f6ec4e282"><div class="ttname"><a href="classUftMocker.html#a074d811c5a8ecaf5dbba6e2f6ec4e282">UftMocker::_pos_logs</a></div><div class="ttdeci">std::stringstream _pos_logs</div><div class="ttdoc">持仓日志流</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01113">UftMocker.h:1113</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a0b14656f5386b6213a6661cdfeba631a"><div class="ttname"><a href="classUftMocker.html#a0b14656f5386b6213a6661cdfeba631a">UftMocker::stra_cancel</a></div><div class="ttdeci">virtual bool stra_cancel(uint32_t localid) override</div><div class="ttdoc">撤销订单</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00633">UftMocker.cpp:633</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a10286c31e65f9cfa510b9ccb1f79c31e"><div class="ttname"><a href="classUftMocker.html#a10286c31e65f9cfa510b9ccb1f79c31e">UftMocker::procTask</a></div><div class="ttdeci">void procTask()</div><div class="ttdoc">处理任务队列中的任务</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00114">UftMocker.cpp:114</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a1c6db7dabeb1297eae8787929c05b60a"><div class="ttname"><a href="classUftMocker.html#a1c6db7dabeb1297eae8787929c05b60a">UftMocker::on_bar</a></div><div class="ttdeci">virtual void on_bar(const char *stdCode, const char *period, uint32_t times, WTSBarStruct *newBar) override</div><div class="ttdoc">K线数据回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00350">UftMocker.cpp:350</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a1d0403941dd029f7e26c45f5faffda21"><div class="ttname"><a href="classUftMocker.html#a1d0403941dd029f7e26c45f5faffda21">UftMocker::update_dyn_profit</a></div><div class="ttdeci">void update_dyn_profit(const char *stdCode, WTSTickData *newTick)</div><div class="ttdoc">更新动态收益</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01176">UftMocker.cpp:1176</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a1d59cab79c09ef3ad3831fcb68b1d8e1"><div class="ttname"><a href="classUftMocker.html#a1d59cab79c09ef3ad3831fcb68b1d8e1">UftMocker::_use_newpx</a></div><div class="ttdeci">bool _use_newpx</div><div class="ttdoc">是否使用最新价格标志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00688">UftMocker.h:688</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a1f56e451de15b544e8e6f3a4e95a6720"><div class="ttname"><a href="classUftMocker.html#a1f56e451de15b544e8e6f3a4e95a6720">UftMocker::_trade_logs</a></div><div class="ttdeci">std::stringstream _trade_logs</div><div class="ttdoc">交易日志流</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01095">UftMocker.h:1095</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a2392a6d5b1ce2fe3b14f9c8f10668c87"><div class="ttname"><a href="classUftMocker.html#a2392a6d5b1ce2fe3b14f9c8f10668c87">UftMocker::_tick_subs</a></div><div class="ttdeci">wt_hashset&lt; std::string &gt; _tick_subs</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01159">UftMocker.h:1159</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a25b1dd38e16c329f753ef7e8ba0f42ba"><div class="ttname"><a href="classUftMocker.html#a25b1dd38e16c329f753ef7e8ba0f42ba">UftMocker::stra_log_info</a></div><div class="ttdeci">virtual void stra_log_info(const char *message) override</div><div class="ttdoc">输出信息级别日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01598">UftMocker.cpp:1598</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a27a2a1ec1fb7922a4ba4ae4a2a2a74c1"><div class="ttname"><a href="classUftMocker.html#a27a2a1ec1fb7922a4ba4ae4a2a2a74c1">UftMocker::_pos_map</a></div><div class="ttdeci">PositionMap _pos_map</div><div class="ttdoc">持仓映射容器</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01089">UftMocker.h:1089</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a27db324d73c9177e7f5df2b5e8e63b82"><div class="ttname"><a href="classUftMocker.html#a27db324d73c9177e7f5df2b5e8e63b82">UftMocker::stra_get_order_queue</a></div><div class="ttdeci">virtual WTSOrdQueSlice * stra_get_order_queue(const char *stdCode, uint32_t count) override</div><div class="ttdoc">获取委托队列切片数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01382">UftMocker.cpp:1382</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a2aa8d6e9b8f35c00cfdec015c8326802"><div class="ttname"><a href="classUftMocker.html#a2aa8d6e9b8f35c00cfdec015c8326802">UftMocker::stra_get_bars</a></div><div class="ttdeci">virtual WTSKlineSlice * stra_get_bars(const char *stdCode, const char *period, uint32_t count) override</div><div class="ttdoc">获取K线切片数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01348">UftMocker.cpp:1348</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a2e277763d6fab9e14a2fd72b10b543af"><div class="ttname"><a href="classUftMocker.html#a2e277763d6fab9e14a2fd72b10b543af">UftMocker::_error_rate</a></div><div class="ttdeci">uint32_t _error_rate</div><div class="ttdoc">错误率设置</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00694">UftMocker.h:694</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a2e737ba6a3d46a5bb42cf911c0ebfadf"><div class="ttname"><a href="classUftMocker.html#a2e737ba6a3d46a5bb42cf911c0ebfadf">UftMocker::stra_get_price</a></div><div class="ttdeci">virtual double stra_get_price(const char *stdCode) override</div><div class="ttdoc">获取合约当前价格</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01498">UftMocker.cpp:1498</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a2eb6c21fa2f765e719b0344b54833d15"><div class="ttname"><a href="classUftMocker.html#a2eb6c21fa2f765e719b0344b54833d15">UftMocker::handle_init</a></div><div class="ttdeci">virtual void handle_init() override</div><div class="ttdoc">处理初始化事件</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00293">UftMocker.cpp:293</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a305c7de64825fb5f5644709931768025"><div class="ttname"><a href="classUftMocker.html#a305c7de64825fb5f5644709931768025">UftMocker::on_order</a></div><div class="ttdeci">virtual void on_order(uint32_t localid, const char *stdCode, bool isLong, uint32_t offset, double totalQty, double leftQty, double price, bool isCanceled)</div><div class="ttdoc">委托状态回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01111">UftMocker.cpp:1111</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a371afcdbcc32aa313051398f10069ae1"><div class="ttname"><a href="classUftMocker.html#a371afcdbcc32aa313051398f10069ae1">UftMocker::stra_exit_short</a></div><div class="ttdeci">virtual uint32_t stra_exit_short(const char *stdCode, double price, double qty, bool isToday=false, int flag=0) override</div><div class="ttdoc">平空仓交易</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01037">UftMocker.cpp:1037</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a3a11453469b65ee280d68d5f61ae3f37"><div class="ttname"><a href="classUftMocker.html#a3a11453469b65ee280d68d5f61ae3f37">UftMocker::on_orddtl_updated</a></div><div class="ttdeci">virtual void on_orddtl_updated(const char *stdCode, WTSOrdDtlData *newOrdDtl) override</div><div class="ttdoc">当委托明细数据更新时的回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00489">UftMocker.cpp:489</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a3d3d44e1f3370b3bb655d5a7d25ae46b"><div class="ttname"><a href="classUftMocker.html#a3d3d44e1f3370b3bb655d5a7d25ae46b">UftMocker::_price_map</a></div><div class="ttdeci">PriceMap _price_map</div><div class="ttdoc">价格映射表</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00712">UftMocker.h:712</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a406c47b169ea834f36f18edaa4171270"><div class="ttname"><a href="classUftMocker.html#a406c47b169ea834f36f18edaa4171270">UftMocker::stra_get_ticks</a></div><div class="ttdeci">virtual WTSTickSlice * stra_get_ticks(const char *stdCode, uint32_t count) override</div><div class="ttdoc">获取Tick切片数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01368">UftMocker.cpp:1368</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a44413fc9146e581a4ffafa1c6195613b"><div class="ttname"><a href="classUftMocker.html#a44413fc9146e581a4ffafa1c6195613b">UftMocker::handle_order_queue</a></div><div class="ttdeci">virtual void handle_order_queue(const char *stdCode, WTSOrdQueData *curOrdQue) override</div><div class="ttdoc">处理委托队列数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00259">UftMocker.cpp:259</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a464b7eb82180d1aae010361fa925b579"><div class="ttname"><a href="classUftMocker.html#a464b7eb82180d1aae010361fa925b579">UftMocker::UftMocker</a></div><div class="ttdeci">UftMocker(HisDataReplayer *replayer, const char *name)</div><div class="ttdoc">UFT策略回测模拟器构造函数</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00085">UftMocker.cpp:85</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a47540e87d498b01a28fb0e880eaf53b6"><div class="ttname"><a href="classUftMocker.html#a47540e87d498b01a28fb0e880eaf53b6">UftMocker::stra_sub_order_queues</a></div><div class="ttdeci">virtual void stra_sub_order_queues(const char *stdCode) override</div><div class="ttdoc">订阅委托队列数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01562">UftMocker.cpp:1562</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a55646aca3a8637d8cbb31087077af2f0"><div class="ttname"><a href="classUftMocker.html#a55646aca3a8637d8cbb31087077af2f0">UftMocker::on_order_detail</a></div><div class="ttdeci">virtual void on_order_detail(const char *stdCode, WTSOrdDtlData *newOrdDtl) override</div><div class="ttdoc">委托明细数据回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00478">UftMocker.cpp:478</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a567d68634eec841482af2b7cfa657f57"><div class="ttname"><a href="classUftMocker.html#a567d68634eec841482af2b7cfa657f57">UftMocker::stra_get_local_position</a></div><div class="ttdeci">virtual double stra_get_local_position(const char *stdCode) override</div><div class="ttdoc">获取本地持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01457">UftMocker.cpp:1457</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a57a329c44fadd6fd2ad1db1039899b7a"><div class="ttname"><a href="classUftMocker.html#a57a329c44fadd6fd2ad1db1039899b7a">UftMocker::log_close</a></div><div class="ttdeci">void log_close(const char *stdCode, bool isLong, uint64_t openTime, double openpx, uint64_t closeTime, double closepx, double qty, double profit, double maxprofit, double maxloss, double totalprofit)</div><div class="ttdoc">记录平仓日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01704">UftMocker.cpp:1704</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a57ef443692088bb95f18b53fd1ae3016"><div class="ttname"><a href="classUftMocker.html#a57ef443692088bb95f18b53fd1ae3016">UftMocker::stra_enum_position</a></div><div class="ttdeci">virtual double stra_enum_position(const char *stdCode) override</div><div class="ttdoc">枚举指定合约的持仓</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01472">UftMocker.cpp:1472</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a5c0b3c998cb22f277ef18d08f3f3d0e4"><div class="ttname"><a href="classUftMocker.html#a5c0b3c998cb22f277ef18d08f3f3d0e4">UftMocker::stra_sub_order_details</a></div><div class="ttdeci">virtual void stra_sub_order_details(const char *stdCode) override</div><div class="ttdoc">订阅委托明细数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01574">UftMocker.cpp:1574</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a5c61fb0db4b2645df23b85025fada9a7"><div class="ttname"><a href="classUftMocker.html#a5c61fb0db4b2645df23b85025fada9a7">UftMocker::on_trans_updated</a></div><div class="ttdeci">virtual void on_trans_updated(const char *stdCode, WTSTransData *newTrans) override</div><div class="ttdoc">当逐笔成交数据更新时的回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00512">UftMocker.cpp:512</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a671e6ebc483bcead9afdc9ba5252ff61"><div class="ttname"><a href="classUftMocker.html#a671e6ebc483bcead9afdc9ba5252ff61">UftMocker::handle_bar_close</a></div><div class="ttdeci">virtual void handle_bar_close(const char *stdCode, const char *period, uint32_t times, WTSBarStruct *newBar) override</div><div class="ttdoc">处理K线闭合事件</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00283">UftMocker.cpp:283</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a696f7b3357c99ad6fed6cbb2711e6d8d"><div class="ttname"><a href="classUftMocker.html#a696f7b3357c99ad6fed6cbb2711e6d8d">UftMocker::stra_get_transaction</a></div><div class="ttdeci">virtual WTSTransSlice * stra_get_transaction(const char *stdCode, uint32_t count) override</div><div class="ttdoc">获取逐笔成交切片数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01410">UftMocker.cpp:1410</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a69c54d030844fd05177700555ba7194c"><div class="ttname"><a href="classUftMocker.html#a69c54d030844fd05177700555ba7194c">UftMocker::Task</a></div><div class="ttdeci">std::function&lt; void()&gt; Task</div><div class="ttdoc">任务类型定义</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00599">UftMocker.h:599</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a72e899a1ed9ac09ce26a11c90cbb5cb1"><div class="ttname"><a href="classUftMocker.html#a72e899a1ed9ac09ce26a11c90cbb5cb1">UftMocker::handle_order_detail</a></div><div class="ttdeci">virtual void handle_order_detail(const char *stdCode, WTSOrdDtlData *curOrdDtl) override</div><div class="ttdoc">处理委托明细数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00248">UftMocker.cpp:248</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a7509f9633ab5f7e986ec7ffba3ccebc3"><div class="ttname"><a href="classUftMocker.html#a7509f9633ab5f7e986ec7ffba3ccebc3">UftMocker::_context_id</a></div><div class="ttdeci">uint32_t _context_id</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01156">UftMocker.h:1156</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a7add808e8aa139bb00ce608772ff674d"><div class="ttname"><a href="classUftMocker.html#a7add808e8aa139bb00ce608772ff674d">UftMocker::log_info</a></div><div class="ttdeci">void log_info(const char *format, const Args &amp;...args)</div><div class="ttdoc">记录信息级别的日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00080">UftMocker.h:80</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a7bd43e347f7143ea260a63a2650c9884"><div class="ttname"><a href="classUftMocker.html#a7bd43e347f7143ea260a63a2650c9884">UftMocker::on_order_queue</a></div><div class="ttdeci">virtual void on_order_queue(const char *stdCode, WTSOrdQueData *newOrdQue) override</div><div class="ttdoc">委托队列数据回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00455">UftMocker.cpp:455</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a7c3a8a2153ca7534ca8a8d39c87c9045"><div class="ttname"><a href="classUftMocker.html#a7c3a8a2153ca7534ca8a8d39c87c9045">UftMocker::stra_get_order_detail</a></div><div class="ttdeci">virtual WTSOrdDtlSlice * stra_get_order_detail(const char *stdCode, uint32_t count) override</div><div class="ttdoc">获取委托明细切片数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01396">UftMocker.cpp:1396</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a7e8f668d850021c131649a040b87850c"><div class="ttname"><a href="classUftMocker.html#a7e8f668d850021c131649a040b87850c">UftMocker::_mtx_ords</a></div><div class="ttdeci">StdRecurMutex _mtx_ords</div><div class="ttdoc">订单管理的互斥锁</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00872">UftMocker.h:872</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a8002fb17cc11e7bb3ec4cb467a34f150"><div class="ttname"><a href="classUftMocker.html#a8002fb17cc11e7bb3ec4cb467a34f150">UftMocker::stra_enter_long</a></div><div class="ttdeci">virtual uint32_t stra_enter_long(const char *stdCode, double price, double qty, int flag=0) override</div><div class="ttdoc">开多仓交易</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00857">UftMocker.cpp:857</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a80404593eb7d4a14500cd4e3a13458c8"><div class="ttname"><a href="classUftMocker.html#a80404593eb7d4a14500cd4e3a13458c8">UftMocker::handle_schedule</a></div><div class="ttdeci">virtual void handle_schedule(uint32_t uDate, uint32_t uTime) override</div><div class="ttdoc">处理定时事件</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00305">UftMocker.cpp:305</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a88d76b0afa2e03f0ac63eefe551d5d63"><div class="ttname"><a href="classUftMocker.html#a88d76b0afa2e03f0ac63eefe551d5d63">UftMocker::_orders</a></div><div class="ttdeci">Orders _orders</div><div class="ttdoc">订单容器</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00878">UftMocker.h:878</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a8b3921b1fe9e74af9aead5161065316e"><div class="ttname"><a href="classUftMocker.html#a8b3921b1fe9e74af9aead5161065316e">UftMocker::on_ordque_updated</a></div><div class="ttdeci">virtual void on_ordque_updated(const char *stdCode, WTSOrdQueData *newOrdQue) override</div><div class="ttdoc">当委托队列数据更新时的回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00466">UftMocker.cpp:466</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a8e63abbbd43a222d3f5dbff64cfad3c0"><div class="ttname"><a href="classUftMocker.html#a8e63abbbd43a222d3f5dbff64cfad3c0">UftMocker::_fund_logs</a></div><div class="ttdeci">std::stringstream _fund_logs</div><div class="ttdoc">资金日志流</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01107">UftMocker.h:1107</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a93b2fcfd0004a1f071b3b1325e3945e8"><div class="ttname"><a href="classUftMocker.html#a93b2fcfd0004a1f071b3b1325e3945e8">UftMocker::_mtx_control</a></div><div class="ttdeci">StdRecurMutex _mtx_control</div><div class="ttdoc">递归互斥锁</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00801">UftMocker.h:801</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a9576a3a77dd3cefde8ddcba3e941f4a6"><div class="ttname"><a href="classUftMocker.html#a9576a3a77dd3cefde8ddcba3e941f4a6">UftMocker::on_session_begin</a></div><div class="ttdeci">virtual void on_session_begin(uint32_t curTDate) override</div><div class="ttdoc">交易日开始回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00544">UftMocker.cpp:544</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a96bcaf32225f45c8553d9a992caf3c82"><div class="ttname"><a href="classUftMocker.html#a96bcaf32225f45c8553d9a992caf3c82">UftMocker::handle_replay_done</a></div><div class="ttdeci">virtual void handle_replay_done() override</div><div class="ttdoc">处理回放完成事件</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00335">UftMocker.cpp:335</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a96d10bb6a3cc8a5da4c00a973e2161c2"><div class="ttname"><a href="classUftMocker.html#a96d10bb6a3cc8a5da4c00a973e2161c2">UftMocker::stra_get_secs</a></div><div class="ttdeci">virtual uint32_t stra_get_secs() override</div><div class="ttdoc">获取当前时间秒数</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01531">UftMocker.cpp:1531</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a991d3586964063f36305956b95fd9b92"><div class="ttname"><a href="classUftMocker.html#a991d3586964063f36305956b95fd9b92">UftMocker::_match_this_tick</a></div><div class="ttdeci">bool _match_this_tick</div><div class="ttdoc">当前tick撮合标志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00700">UftMocker.h:700</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a9cd9fd8db52f99fb492ddc437af5e447"><div class="ttname"><a href="classUftMocker.html#a9cd9fd8db52f99fb492ddc437af5e447">UftMocker::stra_log_debug</a></div><div class="ttdeci">virtual void stra_log_debug(const char *message) override</div><div class="ttdoc">输出调试级别日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01610">UftMocker.cpp:1610</a></div></div>
<div class="ttc" id="aclassUftMocker_html_a9e1509a8885e226a573b53a9d59cd3f1"><div class="ttname"><a href="classUftMocker.html#a9e1509a8885e226a573b53a9d59cd3f1">UftMocker::stra_buy</a></div><div class="ttdeci">virtual OrderIDs stra_buy(const char *stdCode, double price, double qty, int flag=0) override</div><div class="ttdoc">买入交易</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00709">UftMocker.cpp:709</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aa15f8fa21f867d8ad1e8af76ca9e81a3"><div class="ttname"><a href="classUftMocker.html#aa15f8fa21f867d8ad1e8af76ca9e81a3">UftMocker::stra_cancel_all</a></div><div class="ttdeci">virtual OrderIDs stra_cancel_all(const char *stdCode) override</div><div class="ttdoc">撤销指定合约的所有活跃订单</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00680">UftMocker.cpp:680</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aa1b33e622a3294496f2224542f172b3b"><div class="ttname"><a href="classUftMocker.html#aa1b33e622a3294496f2224542f172b3b">UftMocker::stra_sub_transactions</a></div><div class="ttdeci">virtual void stra_sub_transactions(const char *stdCode) override</div><div class="ttdoc">订阅逐笔成交数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01586">UftMocker.cpp:1586</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aa4dae33dafe0108c778f8f0939dd22e5"><div class="ttname"><a href="classUftMocker.html#aa4dae33dafe0108c778f8f0939dd22e5">UftMocker::handle_session_end</a></div><div class="ttdeci">virtual void handle_session_end(uint32_t curTDate) override</div><div class="ttdoc">处理交易日结束事件</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00325">UftMocker.cpp:325</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aa59afdde809ae55c213d95ab34dd37b9"><div class="ttname"><a href="classUftMocker.html#aa59afdde809ae55c213d95ab34dd37b9">UftMocker::log_trade</a></div><div class="ttdeci">void log_trade(const char *stdCode, bool isLong, uint32_t offset, uint64_t curTime, double price, double qty, double fee)</div><div class="ttdoc">记录交易日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01680">UftMocker.cpp:1680</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aa83b6c6a8b142b7cb254da2e56c627c0"><div class="ttname"><a href="classUftMocker.html#aa83b6c6a8b142b7cb254da2e56c627c0">UftMocker::stra_sub_ticks</a></div><div class="ttdeci">virtual void stra_sub_ticks(const char *stdCode) override</div><div class="ttdoc">订阅Tick数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01543">UftMocker.cpp:1543</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aaab672033c90dc3bc142c2037b5ab7c4"><div class="ttname"><a href="classUftMocker.html#aaab672033c90dc3bc142c2037b5ab7c4">UftMocker::on_channel_ready</a></div><div class="ttdeci">virtual void on_channel_ready()</div><div class="ttdoc">通道就绪回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01160">UftMocker.cpp:1160</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aab4828872447a8ca8c3566c7a52e16fe"><div class="ttname"><a href="classUftMocker.html#aab4828872447a8ca8c3566c7a52e16fe">UftMocker::_strategy</a></div><div class="ttdeci">UftStrategy * _strategy</div><div class="ttdoc">UFT策略实例指针</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00781">UftMocker.h:781</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aae5925a1b644093bb852704ee1cec5a5"><div class="ttname"><a href="classUftMocker.html#aae5925a1b644093bb852704ee1cec5a5">UftMocker::stra_log_error</a></div><div class="ttdeci">virtual void stra_log_error(const char *message) override</div><div class="ttdoc">输出错误级别日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01622">UftMocker.cpp:1622</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ab12cdaf6e524e508e8040b46ca967879"><div class="ttname"><a href="classUftMocker.html#ab12cdaf6e524e508e8040b46ca967879">UftMocker::_fund_info</a></div><div class="ttdeci">StraFundInfo _fund_info</div><div class="ttdoc">策略资金信息</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01153">UftMocker.h:1153</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ab5fe80527477d3615665768afe88986c"><div class="ttname"><a href="classUftMocker.html#ab5fe80527477d3615665768afe88986c">UftMocker::_close_logs</a></div><div class="ttdeci">std::stringstream _close_logs</div><div class="ttdoc">平仓日志流</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01101">UftMocker.h:1101</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ab69fde97b863030a99ba736f46dd64a1"><div class="ttname"><a href="classUftMocker.html#ab69fde97b863030a99ba736f46dd64a1">UftMocker::handle_tick</a></div><div class="ttdeci">virtual void handle_tick(const char *stdCode, WTSTickData *curTick, uint32_t pxType) override</div><div class="ttdoc">处理Tick数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00237">UftMocker.cpp:237</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ab86556731170989deaf8223afc3f59b0"><div class="ttname"><a href="classUftMocker.html#ab86556731170989deaf8223afc3f59b0">UftMocker::on_transaction</a></div><div class="ttdeci">virtual void on_transaction(const char *stdCode, WTSTransData *newTrans) override</div><div class="ttdoc">逐笔成交数据回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00501">UftMocker.cpp:501</a></div></div>
<div class="ttc" id="aclassUftMocker_html_abb3853101bf75b4cdd0f81b7d5a9608c"><div class="ttname"><a href="classUftMocker.html#abb3853101bf75b4cdd0f81b7d5a9608c">UftMocker::id</a></div><div class="ttdeci">virtual uint32_t id() override</div><div class="ttdoc">获取策略ID</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00523">UftMocker.cpp:523</a></div></div>
<div class="ttc" id="aclassUftMocker_html_abdc7f2fe277c08e0f82a8f857430148d"><div class="ttname"><a href="classUftMocker.html#abdc7f2fe277c08e0f82a8f857430148d">UftMocker::handle_session_begin</a></div><div class="ttdeci">virtual void handle_session_begin(uint32_t curTDate) override</div><div class="ttdoc">处理交易日开始事件</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00315">UftMocker.cpp:315</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ac2ca81ea36d702d2b7c6871ac2c760d2"><div class="ttname"><a href="classUftMocker.html#ac2ca81ea36d702d2b7c6871ac2c760d2">UftMocker::log_error</a></div><div class="ttdeci">void log_error(const char *format, const Args &amp;...args)</div><div class="ttdoc">记录错误级别的日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00094">UftMocker.h:94</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ac83dda60dfa0874931852c13362eec54"><div class="ttname"><a href="classUftMocker.html#ac83dda60dfa0874931852c13362eec54">UftMocker::on_tick</a></div><div class="ttdeci">virtual void on_tick(const char *stdCode, WTSTickData *newTick) override</div><div class="ttdoc">Tick数据回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00365">UftMocker.cpp:365</a></div></div>
<div class="ttc" id="aclassUftMocker_html_acc3cc7b1b3141a71be1e197c6dfe7bc6"><div class="ttname"><a href="classUftMocker.html#acc3cc7b1b3141a71be1e197c6dfe7bc6">UftMocker::on_tick_updated</a></div><div class="ttdeci">virtual void on_tick_updated(const char *stdCode, WTSTickData *newTick) override</div><div class="ttdoc">当Tick数据更新时的回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00439">UftMocker.cpp:439</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ad3147ad051ffc059fc356c2c8221ae30"><div class="ttname"><a href="classUftMocker.html#ad3147ad051ffc059fc356c2c8221ae30">UftMocker::on_session_end</a></div><div class="ttdeci">virtual void on_session_end(uint32_t curTDate) override</div><div class="ttdoc">交易日结束回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00572">UftMocker.cpp:572</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ad4285e507d7c8ff86b75e4cfdae7e76a"><div class="ttname"><a href="classUftMocker.html#ad4285e507d7c8ff86b75e4cfdae7e76a">UftMocker::dump_outputs</a></div><div class="ttdeci">void dump_outputs()</div><div class="ttdoc">输出回测结果</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01638">UftMocker.cpp:1638</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ad43d8223a63e34c1a43b1ade2e861c3a"><div class="ttname"><a href="classUftMocker.html#ad43d8223a63e34c1a43b1ade2e861c3a">UftMocker::procOrder</a></div><div class="ttdeci">bool procOrder(uint32_t localid)</div><div class="ttdoc">处理指定订单</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01246">UftMocker.cpp:1246</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ad988622a5baae466097e196432f2d7f6"><div class="ttname"><a href="classUftMocker.html#ad988622a5baae466097e196432f2d7f6">UftMocker::init_uft_factory</a></div><div class="ttdeci">bool init_uft_factory(WTSVariant *cfg)</div><div class="ttdoc">初始化UFT策略工厂</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00188">UftMocker.cpp:188</a></div></div>
<div class="ttc" id="aclassUftMocker_html_adaad164f6540f0a98a69ed3e3a1d36a2"><div class="ttname"><a href="classUftMocker.html#adaad164f6540f0a98a69ed3e3a1d36a2">UftMocker::~UftMocker</a></div><div class="ttdeci">virtual ~UftMocker()</div><div class="ttdoc">UFT策略回测模拟器析构函数</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00101">UftMocker.cpp:101</a></div></div>
<div class="ttc" id="aclassUftMocker_html_add0ee20334abc39f251cbccbfd2b6aac"><div class="ttname"><a href="classUftMocker.html#add0ee20334abc39f251cbccbfd2b6aac">UftMocker::stra_get_time</a></div><div class="ttdeci">virtual uint32_t stra_get_time() override</div><div class="ttdoc">获取当前交易时间</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01520">UftMocker.cpp:1520</a></div></div>
<div class="ttc" id="aclassUftMocker_html_adf95fedcd2a528aa0e54b4865220553f"><div class="ttname"><a href="classUftMocker.html#adf95fedcd2a528aa0e54b4865220553f">UftMocker::on_trade</a></div><div class="ttdeci">virtual void on_trade(uint32_t localid, const char *stdCode, bool isLong, uint32_t offset, double vol, double price)</div><div class="ttdoc">成交回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01128">UftMocker.cpp:1128</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ae091f6c4053a526d76df2a9bac52b1b5"><div class="ttname"><a href="classUftMocker.html#ae091f6c4053a526d76df2a9bac52b1b5">UftMocker::handle_transaction</a></div><div class="ttdeci">virtual void handle_transaction(const char *stdCode, WTSTransData *curTrans) override</div><div class="ttdoc">处理逐笔成交数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00270">UftMocker.cpp:270</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ae10b6149214e4a56619655a636c3bc7b"><div class="ttname"><a href="classUftMocker.html#ae10b6149214e4a56619655a636c3bc7b">UftMocker::stra_get_date</a></div><div class="ttdeci">virtual uint32_t stra_get_date() override</div><div class="ttdoc">获取当前交易日期</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01509">UftMocker.cpp:1509</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ae4968f9ed367c595ce2cfe4ce9f8b985"><div class="ttname"><a href="classUftMocker.html#ae4968f9ed367c595ce2cfe4ce9f8b985">UftMocker::postTask</a></div><div class="ttdeci">void postTask(Task task)</div><div class="ttdoc">提交任务到任务队列</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00143">UftMocker.cpp:143</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ae6c7e021d7fac27b4cd076dcaa9a1dc3"><div class="ttname"><a href="classUftMocker.html#ae6c7e021d7fac27b4cd076dcaa9a1dc3">UftMocker::stra_get_last_tick</a></div><div class="ttdeci">virtual WTSTickData * stra_get_last_tick(const char *stdCode) override</div><div class="ttdoc">获取最新Tick数据</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01423">UftMocker.cpp:1423</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ae73cb018d802faf69acc6af1ac92cc6c"><div class="ttname"><a href="classUftMocker.html#ae73cb018d802faf69acc6af1ac92cc6c">UftMocker::log_debug</a></div><div class="ttdeci">void log_debug(const char *format, const Args &amp;...args)</div><div class="ttdoc">记录调试级别的日志</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00066">UftMocker.h:66</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ae8cc5f82941a13e61dbdd8cd10ae157b"><div class="ttname"><a href="classUftMocker.html#ae8cc5f82941a13e61dbdd8cd10ae157b">UftMocker::stra_get_undone</a></div><div class="ttdeci">virtual double stra_get_undone(const char *stdCode) override</div><div class="ttdoc">获取未完成委托数量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00607">UftMocker.cpp:607</a></div></div>
<div class="ttc" id="aclassUftMocker_html_ae9ab1bbb74eaf6ecf0e493517078e1a1"><div class="ttname"><a href="classUftMocker.html#ae9ab1bbb74eaf6ecf0e493517078e1a1">UftMocker::on_init</a></div><div class="ttdeci">virtual void on_init() override</div><div class="ttdoc">策略初始化回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00532">UftMocker.cpp:532</a></div></div>
<div class="ttc" id="aclassUftMocker_html_aee8af1a927e4e93da6da8ec435c5fdd6"><div class="ttname"><a href="classUftMocker.html#aee8af1a927e4e93da6da8ec435c5fdd6">UftMocker::_mtx</a></div><div class="ttdeci">StdUniqueMutex _mtx</div><div class="ttdoc">线程互斥锁</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00788">UftMocker.h:788</a></div></div>
<div class="ttc" id="aclassUftMocker_html_af040581dfbad9adea966486ee63748cd"><div class="ttname"><a href="classUftMocker.html#af040581dfbad9adea966486ee63748cd">UftMocker::update_position</a></div><div class="ttdeci">void update_position(const char *stdCode, bool isLong, uint32_t offset, double qty, double price=0.0)</div><div class="ttdoc">更新持仓信息</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01726">UftMocker.cpp:1726</a></div></div>
<div class="ttc" id="aclassUftMocker_html_af09507d16b2ea6210c653cee490ed865"><div class="ttname"><a href="classUftMocker.html#af09507d16b2ea6210c653cee490ed865">UftMocker::_replayer</a></div><div class="ttdeci">HisDataReplayer * _replayer</div><div class="ttdoc">历史数据回放器指针</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00682">UftMocker.h:682</a></div></div>
<div class="ttc" id="aclassUftMocker_html_af14be14492ee692c7c7fbcdc91c17e98"><div class="ttname"><a href="classUftMocker.html#af14be14492ee692c7c7fbcdc91c17e98">UftMocker::stra_get_position</a></div><div class="ttdeci">virtual double stra_get_position(const char *stdCode, bool bOnlyValid=false, int32_t iFlag=3) override</div><div class="ttdoc">获取指定合约的持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01438">UftMocker.cpp:1438</a></div></div>
<div class="ttc" id="aclassUftMocker_html_af554869084300d5227dac1639c165196"><div class="ttname"><a href="classUftMocker.html#af554869084300d5227dac1639c165196">UftMocker::_tasks</a></div><div class="ttdeci">std::queue&lt; Task &gt; _tasks</div><div class="ttdoc">任务队列</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00794">UftMocker.h:794</a></div></div>
<div class="ttc" id="aclassUftMocker_html_af674be55e62dc791cfb68ba36335d6de"><div class="ttname"><a href="classUftMocker.html#af674be55e62dc791cfb68ba36335d6de">UftMocker::on_entrust</a></div><div class="ttdeci">virtual void on_entrust(uint32_t localid, const char *stdCode, bool bSuccess, const char *message)</div><div class="ttdoc">委托结果回调</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l01147">UftMocker.cpp:1147</a></div></div>
<div class="ttc" id="aclassUftMocker_html_af755aba192acae21e4ec196fcdd2c4b4"><div class="ttname"><a href="classUftMocker.html#af755aba192acae21e4ec196fcdd2c4b4">UftMocker::stra_enter_short</a></div><div class="ttdeci">virtual uint32_t stra_enter_short(const char *stdCode, double price, double qty, int flag=0) override</div><div class="ttdoc">开空仓交易</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00909">UftMocker.cpp:909</a></div></div>
<div class="ttc" id="aclassUftMocker_html_afed7220165228852ce704691a3fca182"><div class="ttname"><a href="classUftMocker.html#afed7220165228852ce704691a3fca182">UftMocker::stra_sell</a></div><div class="ttdeci">virtual OrderIDs stra_sell(const char *stdCode, double price, double qty, int flag=0) override</div><div class="ttdoc">卖出交易</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8cpp_source.html#l00783">UftMocker.cpp:783</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a03cb318bec5fda26243f8e08504ff30c"><div class="ttname"><a href="classUftStrategy.html#a03cb318bec5fda26243f8e08504ff30c">UftStrategy::on_session_end</a></div><div class="ttdeci">virtual void on_session_end(IUftStraCtx *ctx, uint32_t uTDate)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00071">UftStrategyDefs.h:71</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a07685764a6c3c024ddcf4bbc13865761"><div class="ttname"><a href="classUftStrategy.html#a07685764a6c3c024ddcf4bbc13865761">UftStrategy::on_bar</a></div><div class="ttdeci">virtual void on_bar(IUftStraCtx *ctx, const char *stdCode, const char *period, uint32_t times, WTSBarStruct *newBar)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00100">UftStrategyDefs.h:100</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a0dfcc40aebad51e8278c03f04d53fde3"><div class="ttname"><a href="classUftStrategy.html#a0dfcc40aebad51e8278c03f04d53fde3">UftStrategy::on_order</a></div><div class="ttdeci">virtual void on_order(IUftStraCtx *ctx, uint32_t localid, const char *stdCode, bool isLong, uint32_t offset, double totalQty, double leftQty, double price, bool isCanceled)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00140">UftStrategyDefs.h:140</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a19053a3ce1b415f5a0ab502820dd7c76"><div class="ttname"><a href="classUftStrategy.html#a19053a3ce1b415f5a0ab502820dd7c76">UftStrategy::on_transaction</a></div><div class="ttdeci">virtual void on_transaction(IUftStraCtx *ctx, const char *stdCode, WTSTransData *newTrans)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00091">UftStrategyDefs.h:91</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a615cb54b12e29a2a9842b3cd9dc19fbf"><div class="ttname"><a href="classUftStrategy.html#a615cb54b12e29a2a9842b3cd9dc19fbf">UftStrategy::on_session_begin</a></div><div class="ttdeci">virtual void on_session_begin(IUftStraCtx *ctx, uint32_t uTDate)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00066">UftStrategyDefs.h:66</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a7cc05494f8b238d263e4e9c7ea9750b1"><div class="ttname"><a href="classUftStrategy.html#a7cc05494f8b238d263e4e9c7ea9750b1">UftStrategy::on_channel_ready</a></div><div class="ttdeci">virtual void on_channel_ready(IUftStraCtx *ctx)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00145">UftStrategyDefs.h:145</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a87eea5fd7b5d63e52a0019f164a1c234"><div class="ttname"><a href="classUftStrategy.html#a87eea5fd7b5d63e52a0019f164a1c234">UftStrategy::init</a></div><div class="ttdeci">virtual bool init(WTSVariant *cfg)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00048">UftStrategyDefs.h:48</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a88591358174dd9461cca04f201cf1aa4"><div class="ttname"><a href="classUftStrategy.html#a88591358174dd9461cca04f201cf1aa4">UftStrategy::on_order_queue</a></div><div class="ttdeci">virtual void on_order_queue(IUftStraCtx *ctx, const char *stdCode, WTSOrdQueData *newOrdQue)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00081">UftStrategyDefs.h:81</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_a8af8a93d09a2b86e1fcaf76c0ae1c3cd"><div class="ttname"><a href="classUftStrategy.html#a8af8a93d09a2b86e1fcaf76c0ae1c3cd">UftStrategy::on_init</a></div><div class="ttdeci">virtual void on_init(IUftStraCtx *ctx)=0</div></div>
<div class="ttc" id="aclassUftStrategy_html_a9cf8f2f604cb403ad13e5b71004e934d"><div class="ttname"><a href="classUftStrategy.html#a9cf8f2f604cb403ad13e5b71004e934d">UftStrategy::on_order_detail</a></div><div class="ttdeci">virtual void on_order_detail(IUftStraCtx *ctx, const char *stdCode, WTSOrdDtlData *newOrdDtl)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00086">UftStrategyDefs.h:86</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_aabc6588308e279c287dd2f6bd6ea5768"><div class="ttname"><a href="classUftStrategy.html#aabc6588308e279c287dd2f6bd6ea5768">UftStrategy::on_entrust</a></div><div class="ttdeci">virtual void on_entrust(uint32_t localid, bool bSuccess, const char *message)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00160">UftStrategyDefs.h:160</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_aae1adc53245ba4955572c46fc38858e8"><div class="ttname"><a href="classUftStrategy.html#aae1adc53245ba4955572c46fc38858e8">UftStrategy::on_tick</a></div><div class="ttdeci">virtual void on_tick(IUftStraCtx *ctx, const char *stdCode, WTSTickData *newTick)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00076">UftStrategyDefs.h:76</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_ada54cf5bdcf7ee22eb8279ba6590e3cb"><div class="ttname"><a href="classUftStrategy.html#ada54cf5bdcf7ee22eb8279ba6590e3cb">UftStrategy::on_position</a></div><div class="ttdeci">virtual void on_position(IUftStraCtx *ctx, const char *stdCode, bool isLong, double prevol, double preavail, double newvol, double newavail)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00126">UftStrategyDefs.h:126</a></div></div>
<div class="ttc" id="aclassUftStrategy_html_af31f56e653b3007f5e15ec20850e8497"><div class="ttname"><a href="classUftStrategy.html#af31f56e653b3007f5e15ec20850e8497">UftStrategy::on_trade</a></div><div class="ttdeci">virtual void on_trade(IUftStraCtx *ctx, uint32_t localid, const char *stdCode, bool isLong, uint32_t offset, double vol, double price)</div><div class="ttdef"><b>Definition</b> <a href="UftStrategyDefs_8h_source.html#l00112">UftStrategyDefs.h:112</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html"><div class="ttname"><a href="classWTSCommodityInfo.html">WTSCommodityInfo</a></div><div class="ttdoc">品种信息类</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00020">WTSContractInfo.hpp:21</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_a1fe9a4acdce011c67dfcee7b0c7c8117"><div class="ttname"><a href="classWTSCommodityInfo.html#a1fe9a4acdce011c67dfcee7b0c7c8117">WTSCommodityInfo::getCoverMode</a></div><div class="ttdeci">CoverMode getCoverMode() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00063">WTSContractInfo.hpp:63</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_a3f74c34d16cd5a0702ee9c1d31681525"><div class="ttname"><a href="classWTSCommodityInfo.html#a3f74c34d16cd5a0702ee9c1d31681525">WTSCommodityInfo::getVolScale</a></div><div class="ttdeci">uint32_t getVolScale() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00058">WTSContractInfo.hpp:58</a></div></div>
<div class="ttc" id="aclassWTSCommodityInfo_html_ade755d23541016a1cd823035f850b92b"><div class="ttname"><a href="classWTSCommodityInfo.html#ade755d23541016a1cd823035f850b92b">WTSCommodityInfo::isT1</a></div><div class="ttdeci">bool isT1() const</div><div class="ttdef"><b>Definition</b> <a href="WTSContractInfo_8hpp_source.html#l00048">WTSContractInfo.hpp:48</a></div></div>
<div class="ttc" id="aclassWTSKlineSlice_html"><div class="ttname"><a href="classWTSKlineSlice.html">WTSKlineSlice</a></div><div class="ttdoc">K线数据切片类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l00295">WTSDataDef.hpp:296</a></div></div>
<div class="ttc" id="aclassWTSLogger_html_ae4cde1222e609623189a4be2b345680a"><div class="ttname"><a href="classWTSLogger.html#ae4cde1222e609623189a4be2b345680a">WTSLogger::log_dyn_raw</a></div><div class="ttdeci">static void log_dyn_raw(const char *patttern, const char *catName, WTSLogLevel ll, const char *message)</div><div class="ttdoc">使用动态分类模式输出日志消息</div><div class="ttdef"><b>Definition</b> <a href="WTSLogger_8cpp_source.html#l00495">WTSLogger.cpp:495</a></div></div>
<div class="ttc" id="aclassWTSOrdDtlData_html"><div class="ttname"><a href="classWTSOrdDtlData.html">WTSOrdDtlData</a></div><div class="ttdoc">委托明细数据类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01726">WTSDataDef.hpp:1727</a></div></div>
<div class="ttc" id="aclassWTSOrdDtlSlice_html"><div class="ttname"><a href="classWTSOrdDtlSlice.html">WTSOrdDtlSlice</a></div><div class="ttdoc">委托明细数据切片类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l02335">WTSDataDef.hpp:2336</a></div></div>
<div class="ttc" id="aclassWTSOrdQueData_html"><div class="ttname"><a href="classWTSOrdQueData.html">WTSOrdQueData</a></div><div class="ttdoc">委托队列数据类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01613">WTSDataDef.hpp:1614</a></div></div>
<div class="ttc" id="aclassWTSOrdQueSlice_html"><div class="ttname"><a href="classWTSOrdQueSlice.html">WTSOrdQueSlice</a></div><div class="ttdoc">委托队列数据切片类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l02442">WTSDataDef.hpp:2443</a></div></div>
<div class="ttc" id="aclassWTSPoolObject_html_a868f127b3ccc31cba6b077803cb00951"><div class="ttname"><a href="classWTSPoolObject.html#a868f127b3ccc31cba6b077803cb00951">WTSPoolObject::release</a></div><div class="ttdeci">virtual void release() override</div><div class="ttdef"><b>Definition</b> <a href="WTSObject_8hpp_source.html#l00092">WTSObject.hpp:92</a></div></div>
<div class="ttc" id="aclassWTSTickData_html"><div class="ttname"><a href="classWTSTickData.html">WTSTickData</a></div><div class="ttdoc">Tick数据对象</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01251">WTSDataDef.hpp:1252</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a1428afc0bb0e6d1bb01be62bc5743631"><div class="ttname"><a href="classWTSTickData.html#a1428afc0bb0e6d1bb01be62bc5743631">WTSTickData::bidqty</a></div><div class="ttdeci">double bidqty(int idx) const</div><div class="ttdoc">获取指定档位的委买量（买盘量）</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01552">WTSDataDef.hpp:1552</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a235e2995d16b634c5edd5d4a45308302"><div class="ttname"><a href="classWTSTickData.html#a235e2995d16b634c5edd5d4a45308302">WTSTickData::askprice</a></div><div class="ttdeci">double askprice(int idx) const</div><div class="ttdoc">获取指定档位的委卖价（卖盘价）</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01535">WTSDataDef.hpp:1535</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a2c374d0964b76835c0eaf1450a488302"><div class="ttname"><a href="classWTSTickData.html#a2c374d0964b76835c0eaf1450a488302">WTSTickData::askqty</a></div><div class="ttdeci">double askqty(int idx) const</div><div class="ttdoc">获取指定档位的委卖量（卖盘量）</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01569">WTSDataDef.hpp:1569</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_a803d1804cb06e32d69064ecd253f1c9d"><div class="ttname"><a href="classWTSTickData.html#a803d1804cb06e32d69064ecd253f1c9d">WTSTickData::bidprice</a></div><div class="ttdeci">double bidprice(int idx) const</div><div class="ttdoc">获取指定档位的委买价（买盘价）</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01518">WTSDataDef.hpp:1518</a></div></div>
<div class="ttc" id="aclassWTSTickData_html_ae502123e14736815e734b7f6456cfd13"><div class="ttname"><a href="classWTSTickData.html#ae502123e14736815e734b7f6456cfd13">WTSTickData::price</a></div><div class="ttdeci">double price() const</div><div class="ttdoc">获取Tick数据的最新成交价</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01338">WTSDataDef.hpp:1338</a></div></div>
<div class="ttc" id="aclassWTSTickSlice_html"><div class="ttname"><a href="classWTSTickSlice.html">WTSTickSlice</a></div><div class="ttdoc">Tick数据切片类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l02128">WTSDataDef.hpp:2129</a></div></div>
<div class="ttc" id="aclassWTSTransData_html"><div class="ttname"><a href="classWTSTransData.html">WTSTransData</a></div><div class="ttdoc">成交数据类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l01840">WTSDataDef.hpp:1841</a></div></div>
<div class="ttc" id="aclassWTSTransSlice_html"><div class="ttname"><a href="classWTSTransSlice.html">WTSTransSlice</a></div><div class="ttdoc">逐笔成交数据切片类</div><div class="ttdef"><b>Definition</b> <a href="WTSDataDef_8hpp_source.html#l02549">WTSDataDef.hpp:2550</a></div></div>
<div class="ttc" id="aclassWTSVariant_html"><div class="ttname"><a href="classWTSVariant.html">WTSVariant</a></div><div class="ttdoc">变量类</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00037">WTSVariant.hpp:38</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a4dacb2b4afd195d05dedb5323d7982f3"><div class="ttname"><a href="classWTSVariant.html#a4dacb2b4afd195d05dedb5323d7982f3">WTSVariant::get</a></div><div class="ttdeci">WTSVariant * get(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00357">WTSVariant.hpp:357</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a597bf32bfe71fb040721dc65dc786df6"><div class="ttname"><a href="classWTSVariant.html#a597bf32bfe71fb040721dc65dc786df6">WTSVariant::getBoolean</a></div><div class="ttdeci">bool getBoolean(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00348">WTSVariant.hpp:348</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a830db11fc8daceff409fdbebaa7bea8a"><div class="ttname"><a href="classWTSVariant.html#a830db11fc8daceff409fdbebaa7bea8a">WTSVariant::getCString</a></div><div class="ttdeci">const char * getCString(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00339">WTSVariant.hpp:339</a></div></div>
<div class="ttc" id="aclassWTSVariant_html_a9c09f146129a4f35dc04b490fef8887c"><div class="ttname"><a href="classWTSVariant.html#a9c09f146129a4f35dc04b490fef8887c">WTSVariant::getUInt32</a></div><div class="ttdeci">uint32_t getUInt32(const char *name) const</div><div class="ttdef"><b>Definition</b> <a href="WTSVariant_8hpp_source.html#l00294">WTSVariant.hpp:294</a></div></div>
<div class="ttc" id="aclassWtHelper_html_ae245ba819e4637d80f4326b05e494e15"><div class="ttname"><a href="classWtHelper.html#ae245ba819e4637d80f4326b05e494e15">WtHelper::getOutputDir</a></div><div class="ttdeci">static const char * getOutputDir()</div><div class="ttdoc">获取输出目录</div><div class="ttdef"><b>Definition</b> <a href="WtBtCore_2WtHelper_8cpp_source.html#l00063">WtHelper.cpp:63</a></div></div>
<div class="ttc" id="ademo__send__order_8cpp_html_a04f887fc8800d4727971dbb8eb550132"><div class="ttname"><a href="demo__send__order_8cpp.html#a04f887fc8800d4727971dbb8eb550132">price</a></div><div class="ttdeci">ATPPriceType price</div><div class="ttdef"><b>Definition</b> <a href="API_2AtpTradeApi_2demo_2all__message__demo_2main_8cpp_source.html#l00040">main.cpp:40</a></div></div>
<div class="ttc" id="anamespacedecimal_html_a1109e5cbdd666b1dd19d91d65768f9f6"><div class="ttname"><a href="namespacedecimal.html#a1109e5cbdd666b1dd19d91d65768f9f6">decimal::gt</a></div><div class="ttdeci">bool gt(double a, double b=0.0) noexcept</div><div class="ttdoc">判断第一个浮点数是否大于第二个浮点数</div><div class="ttdef"><b>Definition</b> <a href="decimal_8h_source.html#l00057">decimal.h:57</a></div></div>
<div class="ttc" id="anamespacedecimal_html_a663d923b333cced39eedf3a44e282161"><div class="ttname"><a href="namespacedecimal.html#a663d923b333cced39eedf3a44e282161">decimal::lt</a></div><div class="ttdeci">bool lt(double a, double b=0.0) noexcept</div><div class="ttdoc">判断第一个浮点数是否小于第二个浮点数</div><div class="ttdef"><b>Definition</b> <a href="decimal_8h_source.html#l00069">decimal.h:69</a></div></div>
<div class="ttc" id="anamespacedecimal_html_a6de5f873ba0191bdd61bf1870cd18b81"><div class="ttname"><a href="namespacedecimal.html#a6de5f873ba0191bdd61bf1870cd18b81">decimal::le</a></div><div class="ttdeci">bool le(double a, double b=0.0) noexcept</div><div class="ttdoc">判断第一个浮点数是否小于等于第二个浮点数</div><div class="ttdef"><b>Definition</b> <a href="decimal_8h_source.html#l00093">decimal.h:93</a></div></div>
<div class="ttc" id="anamespacedecimal_html_a9acf2c0f2cb49024df804e7464472774"><div class="ttname"><a href="namespacedecimal.html#a9acf2c0f2cb49024df804e7464472774">decimal::eq</a></div><div class="ttdeci">bool eq(double a, double b=0.0) noexcept</div><div class="ttdoc">判断两个浮点数是否相等</div><div class="ttdef"><b>Definition</b> <a href="decimal_8h_source.html#l00045">decimal.h:45</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html">UftMocker::_DetailInfo</a></div><div class="ttdoc">交易明细信息结构体</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00903">UftMocker.h:904</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html_a19b05741f015a41c5220f4e23d411442"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html#a19b05741f015a41c5220f4e23d411442">UftMocker::_DetailInfo::_max_profit</a></div><div class="ttdeci">double _max_profit</div><div class="ttdoc">最大浮盈</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00933">UftMocker.h:933</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html_a2fef0e4d70c6e20b95ca198a3d0df9ec"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html#a2fef0e4d70c6e20b95ca198a3d0df9ec">UftMocker::_DetailInfo::_price</a></div><div class="ttdeci">double _price</div><div class="ttdoc">交易价格</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00909">UftMocker.h:909</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html_a3189a2c3e83250ef544419f1a0bd6188"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html#a3189a2c3e83250ef544419f1a0bd6188">UftMocker::_DetailInfo::_profit</a></div><div class="ttdeci">double _profit</div><div class="ttdoc">实际盈亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00945">UftMocker.h:945</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html_a89479eac92e8f588d7c2c3ca5a224007"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html#a89479eac92e8f588d7c2c3ca5a224007">UftMocker::_DetailInfo::_opentime</a></div><div class="ttdeci">uint64_t _opentime</div><div class="ttdoc">开仓时间</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00921">UftMocker.h:921</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html_aa442d8a667639561d412022e79067c6e"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html#aa442d8a667639561d412022e79067c6e">UftMocker::_DetailInfo::_max_loss</a></div><div class="ttdeci">double _max_loss</div><div class="ttdoc">最大浮亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00939">UftMocker.h:939</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html_ac092997f67f47809a247026a26a74574"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html#ac092997f67f47809a247026a26a74574">UftMocker::_DetailInfo::_opentdate</a></div><div class="ttdeci">uint32_t _opentdate</div><div class="ttdoc">开仓交易日期</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00927">UftMocker.h:927</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__DetailInfo_html_aeeaccaf53e38e18f09332d43c7c0b501"><div class="ttname"><a href="structUftMocker_1_1__DetailInfo.html#aeeaccaf53e38e18f09332d43c7c0b501">UftMocker::_DetailInfo::_volume</a></div><div class="ttdeci">double _volume</div><div class="ttdoc">交易数量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00915">UftMocker.h:915</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html">UftMocker::_OrderInfo</a></div><div class="ttdoc">订单信息结构体</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00807">UftMocker.h:808</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html_a446de1b7a71c73a3f89af9b1d1f2328c"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html#a446de1b7a71c73a3f89af9b1d1f2328c">UftMocker::_OrderInfo::_code</a></div><div class="ttdeci">char _code[32]</div><div class="ttdoc">合约代码</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00819">UftMocker.h:819</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html_a586c539123e258e22b7b0aeaf2266f34"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html#a586c539123e258e22b7b0aeaf2266f34">UftMocker::_OrderInfo::_left</a></div><div class="ttdeci">double _left</div><div class="ttdoc">剩余未成交数量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00837">UftMocker.h:837</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html_a5e2eb29aa401a9e1c81647cf1c0011e0"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html#a5e2eb29aa401a9e1c81647cf1c0011e0">UftMocker::_OrderInfo::_offset</a></div><div class="ttdeci">uint32_t _offset</div><div class="ttdoc">开平标记</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00843">UftMocker.h:843</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html_a6b89253114d64c114fd65e9fde0e6319"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html#a6b89253114d64c114fd65e9fde0e6319">UftMocker::_OrderInfo::_localid</a></div><div class="ttdeci">uint32_t _localid</div><div class="ttdoc">本地订单ID</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00849">UftMocker.h:849</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html_a6e4ca6615ba83fec14c25c6499a343b8"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html#a6e4ca6615ba83fec14c25c6499a343b8">UftMocker::_OrderInfo::_price</a></div><div class="ttdeci">double _price</div><div class="ttdoc">委托价格</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00825">UftMocker.h:825</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html_a820aed8ac7b9778783463ac34416d21c"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html#a820aed8ac7b9778783463ac34416d21c">UftMocker::_OrderInfo::_total</a></div><div class="ttdeci">double _total</div><div class="ttdoc">委托总数量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00831">UftMocker.h:831</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__OrderInfo_html_a8a8ba37036596a279b9163a6bfa7ebc5"><div class="ttname"><a href="structUftMocker_1_1__OrderInfo.html#a8a8ba37036596a279b9163a6bfa7ebc5">UftMocker::_OrderInfo::_isLong</a></div><div class="ttdeci">bool _isLong</div><div class="ttdoc">是否为多头方向</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00813">UftMocker.h:813</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosInfo_html"><div class="ttname"><a href="structUftMocker_1_1__PosInfo.html">UftMocker::_PosInfo</a></div><div class="ttdoc">合约持仓信息结构体</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01052">UftMocker.h:1053</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosInfo_html_a3d25c0fc4948708303ef56f39e1b1fc8"><div class="ttname"><a href="structUftMocker_1_1__PosInfo.html#a3d25c0fc4948708303ef56f39e1b1fc8">UftMocker::_PosInfo::dynprofit</a></div><div class="ttdeci">double dynprofit() const</div><div class="ttdoc">获取浮动盈亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01077">UftMocker.h:1077</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosInfo_html_a567603694aa9a4f356a4094bd640cd1b"><div class="ttname"><a href="structUftMocker_1_1__PosInfo.html#a567603694aa9a4f356a4094bd640cd1b">UftMocker::_PosInfo::_short</a></div><div class="ttdeci">PosItem _short</div><div class="ttdoc">空头持仓信息</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01064">UftMocker.h:1064</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosInfo_html_a57418808c10ebce5ec37d09abed26103"><div class="ttname"><a href="structUftMocker_1_1__PosInfo.html#a57418808c10ebce5ec37d09abed26103">UftMocker::_PosInfo::closeprofit</a></div><div class="ttdeci">double closeprofit() const</div><div class="ttdoc">获取平仓盈亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01071">UftMocker.h:1071</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosInfo_html_ac47125131886dd4948cd5df17186c82f"><div class="ttname"><a href="structUftMocker_1_1__PosInfo.html#ac47125131886dd4948cd5df17186c82f">UftMocker::_PosInfo::_long</a></div><div class="ttdeci">PosItem _long</div><div class="ttdoc">多头持仓信息</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01058">UftMocker.h:1058</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html">UftMocker::_PosItem</a></div><div class="ttdoc">持仓项目结构体</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00961">UftMocker.h:962</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_a35f355a32103ce825b6b695ff14cd08d"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#a35f355a32103ce825b6b695ff14cd08d">UftMocker::_PosItem::valid</a></div><div class="ttdeci">double valid() const</div><div class="ttdoc">获取有效（可用）持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01031">UftMocker.h:1031</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_a467d500f57dd6beb248a26ea6e162438"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#a467d500f57dd6beb248a26ea6e162438">UftMocker::_PosItem::_details</a></div><div class="ttdeci">std::vector&lt; DetailInfo &gt; _details</div><div class="ttdoc">持仓明细列表</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01009">UftMocker.h:1009</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_a4b4a183110f59c809ad9ba88b53a9b96"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#a4b4a183110f59c809ad9ba88b53a9b96">UftMocker::_PosItem::_preavail</a></div><div class="ttdeci">double _preavail</div><div class="ttdoc">前一日可用持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00997">UftMocker.h:997</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_a517f864f670c9e787651b98b8d382a4a"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#a517f864f670c9e787651b98b8d382a4a">UftMocker::_PosItem::_newvol</a></div><div class="ttdeci">double _newvol</div><div class="ttdoc">当日持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00991">UftMocker.h:991</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_a527cc37fe66d31082889d268ffb89201"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#a527cc37fe66d31082889d268ffb89201">UftMocker::_PosItem::frozen</a></div><div class="ttdeci">double frozen() const</div><div class="ttdoc">获取冻结持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01045">UftMocker.h:1045</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_a6b4dc6151cd698ad5b5b8289c31bbad0"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#a6b4dc6151cd698ad5b5b8289c31bbad0">UftMocker::_PosItem::_newavail</a></div><div class="ttdeci">double _newavail</div><div class="ttdoc">当日可用持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01003">UftMocker.h:1003</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_a77e01932fa045349d2c626f42267aedd"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#a77e01932fa045349d2c626f42267aedd">UftMocker::_PosItem::volume</a></div><div class="ttdeci">double volume() const</div><div class="ttdoc">获取总持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01038">UftMocker.h:1038</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_aa43d54f785352752053be6e95fbfec7c"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#aa43d54f785352752053be6e95fbfec7c">UftMocker::_PosItem::_dynprofit</a></div><div class="ttdeci">double _dynprofit</div><div class="ttdoc">浮动盈亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00979">UftMocker.h:979</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_aabd6cea7cdfcb46fc78881afecd27416"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#aabd6cea7cdfcb46fc78881afecd27416">UftMocker::_PosItem::_closeprofit</a></div><div class="ttdeci">double _closeprofit</div><div class="ttdoc">平仓盈亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00973">UftMocker.h:973</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__PosItem_html_ab0c72ae56c149e4a2235920d1da3a080"><div class="ttname"><a href="structUftMocker_1_1__PosItem.html#ab0c72ae56c149e4a2235920d1da3a080">UftMocker::_PosItem::_prevol</a></div><div class="ttdeci">double _prevol</div><div class="ttdoc">前一日持仓量</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00985">UftMocker.h:985</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFactInfo_html_a1e5095209d21343aa059cbeba9dc8b0b"><div class="ttname"><a href="structUftMocker_1_1__StraFactInfo.html#a1e5095209d21343aa059cbeba9dc8b0b">UftMocker::_StraFactInfo::_remover</a></div><div class="ttdeci">FuncDeleteUftStraFact _remover</div><div class="ttdoc">删除策略工厂的函数指针</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00748">UftMocker.h:748</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFactInfo_html_a275caaf80fd6d84140bf65fe92bb1591"><div class="ttname"><a href="structUftMocker_1_1__StraFactInfo.html#a275caaf80fd6d84140bf65fe92bb1591">UftMocker::_StraFactInfo::_module_inst</a></div><div class="ttdeci">DllHandle _module_inst</div><div class="ttdoc">动态链接库句柄</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00730">UftMocker.h:730</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFactInfo_html_a497600ec7f3950cc35188e2e4c5574a6"><div class="ttname"><a href="structUftMocker_1_1__StraFactInfo.html#a497600ec7f3950cc35188e2e4c5574a6">UftMocker::_StraFactInfo::_module_path</a></div><div class="ttdeci">std::string _module_path</div><div class="ttdoc">策略模块文件路径</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00724">UftMocker.h:724</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFactInfo_html_a9e8430e87a127c702e7e8e8e89732c5f"><div class="ttname"><a href="structUftMocker_1_1__StraFactInfo.html#a9e8430e87a127c702e7e8e8e89732c5f">UftMocker::_StraFactInfo::_fact</a></div><div class="ttdeci">IUftStrategyFact * _fact</div><div class="ttdoc">策略工厂接口指针</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00736">UftMocker.h:736</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFactInfo_html_ac8f06f9886f84533031bd8dad6fd6d17"><div class="ttname"><a href="structUftMocker_1_1__StraFactInfo.html#ac8f06f9886f84533031bd8dad6fd6d17">UftMocker::_StraFactInfo::_creator</a></div><div class="ttdeci">FuncCreateUftStraFact _creator</div><div class="ttdoc">创建策略工厂的函数指针</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l00742">UftMocker.h:742</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFundInfo_html_a47a46c2dcf1437e74271e28e4280bf46"><div class="ttname"><a href="structUftMocker_1_1__StraFundInfo.html#a47a46c2dcf1437e74271e28e4280bf46">UftMocker::_StraFundInfo::_total_dynprofit</a></div><div class="ttdeci">double _total_dynprofit</div><div class="ttdoc">总浮动盈亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01131">UftMocker.h:1131</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFundInfo_html_af030f8da92d1eae43249aa1302731d77"><div class="ttname"><a href="structUftMocker_1_1__StraFundInfo.html#af030f8da92d1eae43249aa1302731d77">UftMocker::_StraFundInfo::_total_fees</a></div><div class="ttdeci">double _total_fees</div><div class="ttdoc">总手续费</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01137">UftMocker.h:1137</a></div></div>
<div class="ttc" id="astructUftMocker_1_1__StraFundInfo_html_af1e40ea145db43d10cef779ea032d3c5"><div class="ttname"><a href="structUftMocker_1_1__StraFundInfo.html#af1e40ea145db43d10cef779ea032d3c5">UftMocker::_StraFundInfo::_total_profit</a></div><div class="ttdeci">double _total_profit</div><div class="ttdoc">总盈亏</div><div class="ttdef"><b>Definition</b> <a href="UftMocker_8h_source.html#l01125">UftMocker.h:1125</a></div></div>
<div class="ttc" id="astructWTSBarStruct_html"><div class="ttname"><a href="structWTSBarStruct.html">WTSBarStruct</a></div><div class="ttdoc">K线数据结构体</div><div class="ttdef"><b>Definition</b> <a href="WTSStruct_8h_source.html#l00101">WTSStruct.h:102</a></div></div>
<div class="ttc" id="atypes_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00295">types.h:295</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_e0a6b04728b7bc818baf88501da85ff3.html">WtBtCore</a></li><li class="navelem"><a class="el" href="UftMocker_8cpp.html">UftMocker.cpp</a></li>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
